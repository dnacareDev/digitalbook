<!doctype html>
<html lang="en" dir="ltr" xmlns:th="http://www.thymeleaf.org">
<head>
<style>
	.content-header{margin-top:30px;}
	.end-button
	{
		width:85px;
		height:40px;
		background-color:#768BF5;
		border:0px;
		margin-top:-15px;
	}
	.end{margin-left:10px;}
</style>
<!-- 공통 헤더 -->
<th:block th:include="@{/fragments/header.html}"></th:block>
</head>
<body class="layout-light top-menu overlayScroll">
	<div class="mobile-search"></div>
	<div class="mobile-author-actions"></div>
	<!-- 공통 topbar -->
	<th:block th:include="@{/fragments/topbar.html}"></th:block>
	<main class="main-content" style="background-color: #F9FBFD;">
		<div class="contents" style="background-color: #F9FBFD;">
		    <div class="container-fluid">
		    	<div class="row">
			        <div class="col-lg-12">
			        	<div class="breadcrumb-main" style="float: left;">
			        		<h4 class="text-capitalize breadcrumb-title">재배 프로토콜 등록</h4>
			        		<span class="ml-20 mt-1">프로토콜 - 재배 프로토콜 등록</span>
			        	</div>
			        </div>
		        </div>
		    	<div class="row">
			        <div class="col-lg-12">
			        	<div class="card">
			        		<div class="card-body">
		        				<div class="row">
		        					<div class="col-sm-2 d-flex aling-items-center">
		                            	<label for="input_title" class="col-form-label color-dark align-center">Method 명<span style="color: red;">*</span></label>
	                                </div>
	                                <div class="col-sm-5">
	                                   <input type="text" class="form-control" style="float: left; width: 465px;" id="input_title" readonly>
	                                   <button class="btn btn-primary" onclick="DivisionBtn();">항목 조회</button>
	                                </div>
		                         </div>
		                         <div class="row mt-3">
		        					<div class="col-sm-2 d-flex aling-items-center">
		                            	<label for="method_contents" class="color-dark align-center">Method 설명</label>
		                            </div>
		                            <div class="col-sm-5">
		                                <input type="text" class="form-control b-light" id="method_contents">
		                            </div>
		                    	</div>
		                    	<div class="row mt-3">
		        					<div class="col-sm-2 d-flex aling-items-center">
		                            	<label for="method_input" class="color-dark align-center">입력 단위</label>
		                            </div>
		                            <div class="col-sm-2">
		                                <select class="form-control b-light" id="method_input">
			                                <option value="">입력단위 선택</option>
			                                <option value="길이">길이</option>
			                                <option value="넓이">넓이</option>
			                                <option value="무게">무게</option>
			                                <option value="부피">부피</option>
			                                <option value="온도">온도</option>
			                                <option value="압력">압력</option>
			                                <option value="속도">속도</option>
			                                <option value="회전수">회전수</option>
			                                <option value="시간">시간</option>
			                                <option value="기타">기타</option>
		                                </select>
		                            </div>
		                            <div class="col-sm-2">
		                            	<select class="form-control b-light" id="method_eaches">
			                                <option value="">단위 종류 선택</option>
		                                </select>
		                            </div>
		                    	</div>
		                    	<div class="row mt-3">
		        					<div class="col-sm-2 d-flex aling-items-center">
		                            	<label for="machine_price" class="color-dark">Protocol</label>
		                            </div>
		                            <div class="col-sm-5">
		                                <textarea class="form-control" id="machine_price" rows="10" readonly></textarea>
		                            </div>
		                    	</div>
		                    	<div class="row mt-3">
		        					<div class="col-sm-2 d-flex aling-items-center">
		                            	<label for="machine_range" class="color-dark">기타</label>
		                            </div>
		                            <div class="col-sm-5">
		                                <textarea class="form-control b-light" id="machine_price" rows="5"></textarea>
		                            </div>
		                    	</div>
			        		</div>
			        	</div>
			        </div>
		        </div>
		        
				<div class="row mt-20">
					<div class="col-lg-12">
						<div class="card">
							<div class="card-body"> 
								<div class="row">
									<div class="col-lg-12">
										<span class="color-dark align-center" style="font-size: 20px;">Step 설정</span>
									</div>
								</div>
								<div class="row mt-4">
									<div class="col-lg-3">
										<div class="row">
											<input type="text" class="form-control b-light" id="method_contents">
										</div>
										<div class="row">
											<button class="btn btn-dark mt-2" onclick="InsertPopup();">조사방법 추가</button>
										</div>
										<div class="row">
											<div class="table-responsive mt-2">
												<table class="table">
													<thead>
														<tr>
															<th></th>
															<th>조사방법</th>
														</tr>
													</thead>
													<tbody class="research_table" id="research_list">
													</tbody>
												</table>
											</div>
										</div>
									</div>
									<div class="col-lg-1">
										<div class="d-flex justify-content-center" style="padding-top: 200px;">
											<div class="col-sm-12">
												<button onclick="CheckResearch();"><span data-feather="plus"></span></button>
											</div>
											<div class="col-sm12">
												<button onclick="aaa();"><span data-feather="minus"></span></button>
											</div>
										</div>
									</div>
									<div class="col-lg-8">
										<div class="table-responsive" style="min-height: 500px; background: #f4f5f7;">
											<table class="table">
												<tbody id="research_table">
												</tbody>
											</table>
										</div>
									</div>
								</div>
			        		</div>
			        	</div>
			        </div>
		        </div>
		        <div class="row">
					<div class="col-4">
						<div class="action-btn d-flex justify-content-frist mt-30">
							<button type="button" class="btn btn-primary end-button" onclick="pirnt();">인쇄</button>
						</div>
					</div>
					<div class="col-4">
						<div class="d-flex justify-content-center mt-30"></div>
					</div>
					<div class="col-4">
						<div class="action-btn d-flex justify-content-end mt-30">
							<a href="/method/list" class="btn btn-primary end-button end">목록</a>
							<button type="button" class="btn btn-primary end-button end" onclick="InsertBtn();">등록</button>
						</div>
					</div>
				</div>
		    </div>
		    
		    <div class="modal-basic modal fade show" id="divisionModal" tabindex="-1" role="dialog" aria-hidden="true">
			    <div class="modal-dialog modal-xl" role="document">
			        <div class="modal-content modal-bg-white">
			        	<div class="modal-header">
			        		<h6 class="modal-title">조사항목 조회</h6>
	                    	<button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                        	<span data-feather="x"></span>
	                        </button>
			        	</div>
			            <div class="modal-body">
			            	<div class="col-12">
		        				<div class="row">
			        				<div class="col-md-6 mb-25">
	                                    <label for="division_depth1" class="color-dark fw-500">대상작목</label>
	                                    <select class="form-control b-light select" id="division_depth1">
			                                <option value="0">대상 작목 선택</option>
			                                <th:block th:each="dvs : ${division}">
				                                <option th:value="${dvs.division_id}" th:text="${dvs.division}"></option>
			                                </th:block>
			                            </select>
	                                </div>
	                                <div class="col-md-6 mb-25">
	                                    <label for="division_depth2" class="color-dark fw-500">분류</label>
	                                    <select class="form-control b-light select" id="division_depth2">
			                                <option value="0">분류 선택</option>
			                            </select>
	                                </div>
	                            </div>
	                            <div class="row">
			        				<div class="col-md-6 mb-25">
	                                    <label for="division_depth3" class="color-dark fw-500">항목</label>
	                                    <select class="form-control b-light select" id="division_depth3">
			                                <option value="0">항목 선택</option>
			                            </select>
	                                </div>
	                                <div class="col-md-6 mb-25">
	                                    <label for="research_contents" class="color-dark fw-500">Method 명</label>
	                                    <input type="text" class="form-control b-deep" id="method_title">
	                                </div>
	                            </div>
			            		<div class="button-group d-flex justify-content-end">
				                   <button class="btn btn-primary btn-default btn-squared" id="titleBtn" onclick="TitleBtn();">사용</button>
				           		</div>
			            	</div>
			            </div>
			        </div>
			    </div>
			</div>

	        <div class="atbd-notice" id="success_popup" style="width:100vw; height:90vh; position:fixed; left:0px; top:0px; display:none; justify-content: center; align-items:center;">
	        	<div class="card card-default card-md mb-4" style="border:1px solid #eee; width: 20%; height: 25%;">
	        		<div class="card-body">
	        			<div class="atbd-notice__content">
	        				<div class="atbd-notice__top text-center">
	        					<div class="atbd-notice__icon bg-success">
	        						<i class="fas fa-check color-white"></i>
	        					</div>
	        					<div class="atbd-notice__text">
	        						<h4>등록이 완료되었습니다.</h4>
	        					</div>
	        					<div style="display: flex; justify-content: center; margin: 10% auto;">
	        						<a class="btn btn-default btn-success" href="/method/list" style="color: #FFFFFF;">확인</a>
	        					</div>
	        				</div>
	        			</div>
	        		</div>
	        	</div>
	        </div>
	        
	        <div class="modal-basic modal fade show" id="researchAddModal" tabindex="-1" role="dialog" aria-hidden="true">
			    <div class="modal-dialog modal-lg" role="document">
			        <div class="modal-content modal-bg-white">
			        	<div class="modal-header">
			        		<h6 class="modal-title">조사방법 등록</h6>
		                    	<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		                        	<span data-feather="x"></span>
		                        </button>
			        	</div>
			            <div class="modal-body">
			            	<div class="col-12">
			            		<div class="row">
			            			<div class="col-sm-2 d-flex aling-items-center">
		                            	<label for="storage_out_address" class="col-form-label color-dark align-center">조사방법<span style="color: red;">*</span></label>
	                                </div>
	                                <div class="col-sm-10">
		                                <input type="text" class="form-control b-light" id="research_contents">
		                            </div>
			            		</div>
			            		<div class="button-group d-flex justify-content-end mt-2">
				                   <button class="btn btn-primary btn-default btn-squared">추가</button>
				           		</div>
			            	</div>
			            </div>
			        </div>
			    </div>
			</div>
		    <!-- ends: .modal-Basic -->

	        
     	</div>
     </main>
     <!-- 공통 하단 -->
    <th:block th:include="@{/fragments/footer.html}"></th:block>
    <!-- 공통 js -->
    <th:block th:include="@{/fragments/commonjs.html}"></th:block>
<script type="text/javascript">
	// 항목 조회 Modal
	function DivisionBtn()
	{
		$("#divisionModal").modal("show");
		
		$("#titleBtn").prop("disabled", true);
	}
	
	// division 선택 이벤트
	$(".select").change(function()
	{
		var division_id = $(this).val();
		var division_depth = this.id.slice(14, 15);
		
		var data = {"division_id" : division_id, "division_depth" : division_depth};
		
		$.ajax(
		{
			url : 'selectDivision',
			method : 'POST',
			dataType : 'json',
			data : data,
			success : function(result)
			{
				var depth = (division_depth * 1) + 1;
				var depth_list = $("#division_depth" + depth);
				var add_list = "";
				
				if(depth == 2)
				{
					add_list += '<option value="0">분류 선택</option>';
				}
				else if(depth == 3)
				{
					add_list += '<option value="0">항목 선택</option>';
				}
				
				for(var i = 0; i < result.length; i++)
				{
					add_list += '<option value="' + result[i].division_id + '">' + result[i].division + '</option>';
				}
				
				depth_list.empty();
				depth_list.append(add_list);
			}
		});
	});
	
	// method명 사용 버튼 활성화
	$("#method_title").keyup(function()
	{
		var d1 = $("#division_depth1 option:checked");
		var d2 = $("#division_depth2 option:checked");
		var d3 = $("#division_depth3 option:checked");
		
		if(d1.val() != 0 || d2.val() != 0 || d3.val() != 0)
		{
			$("#titleBtn").prop("disabled", false);
		}
	});
	
	// method명 사용
	function TitleBtn()
	{
		var d1 = $("#division_depth1 option:checked");
		var d2 = $("#division_depth2 option:checked");
		var d3 = $("#division_depth3 option:checked");
		
		var method_title = $("#method_title").val();
		
		var data = {"division_id" : d3.val()};
		
		$.ajax(
		{
			url : 'selectResearch',
			method : 'POST',
			dataType : 'json',
			data : data,
			success : function(result)
			{
				var research_list = $("#research_list");
				var add_list = "";
				
				for(var i = 0; i < result.length; i++)
				{
					add_list += '<tr>';
					add_list += '<td><input type="checkbox" class="checkbox" name="chk_research" value="' + result[i].research_id + '"></td>';
					add_list += '<td>' + result[i].research_contents + '</td>';
					add_list += '</tr>';
				}
				
				research_list.empty();
				research_list.append(add_list);
				
				$("#input_title").val(d1.text() + " > " + d2.text() + " > " +  d3.text() + " > " +  method_title);
				$("#divisionModal").modal("hide");
			}
		});
	}
	
	// 입력단위 선택
	$("#method_input").change(function()
	{
		var method_input = $("#method_input").val();
		
		var data = {"eaches_type" : method_input};
		
		$.ajax(
		{
			url : 'selectEaches',
			method : 'POST',
			dataType : 'json',
			data : data,
			success : function(result)
			{
				var method_eaches = $("#method_eaches");
				var add_list = "";
				
				add_list += '<option value="">단위 종류 선택</option>';
				
				for(var i = 0; i < result.length; i++)
				{
					add_list += '<option value="'+ result[i].eaches_id + '">' + result[i].eaches_name + '</option>';
				}
				
				method_eaches.empty();
				method_eaches.append(add_list);
			}
		});
	});
	
	function InsertPopup()
	{
		$("#researchAddModal").modal("show");
	}
	
	function CheckResearch()
	{
		var research_table = $("#research_table");
		var add_list = "";
		
		$("input:checkbox[name=chk_research]:checked").each(function()
		{
			var research_id = $(this).val();
			var research_title = $(this).parent().parent().children()[1].innerHTML;
			
			console.log(research_id);
			console.log(research_title);
			
			add_list += '<tr>';
			add_list += '<td>' + research_title + '</td>';
			add_list += '</tr>';
		});
		
		research_table.empty();
		research_table.append(add_list);
	}
</script>
</body>
</html>