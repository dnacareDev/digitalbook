<!DOCTYPE html>
<html lang="en" dir="ltr"
	xmlns:th="http://www.thymeleaf.org">
<head>
<title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
<style type="text/css">
	table {
    border-top: 1px solid grey;
    
    border-collapse: collapse;
  	}
	th, td {
	border-bottom: 2px solid #E5E9F2;
	padding: 0 10px;
	text-align: center;
	font-weight: initial;
	}
	th {
	 font-size : 0.875em;
	 background-color: white;
	}
	.itemBoxHighlight { 
	border:solid 1px black; min-height: 80px; background-color:#768BF5; 
	}
	.main-content #storage_list .btn span, .main-content #storage_list .btn i{
		font-size:14px;
	}
	.main-content .content .pageBtn{
		justify-content: center;
	    clear: left;
	    display: block;
	    width: 50%;
	}
	.box_content{
	    -webkit-box-flex: 0;
	    -ms-flex: 0 0 66.66667%;
	    flex: 0 0 5%;
	    max-width: 5%;
	    display: flex;
	    justify-content: center;
	}
	.box_center li{
		margin-bottom: 20px;
	}
	.box_center li button{
		border-radius: 50%;
    	border: 2px solid #788DEE;
    	background-color: transparent;
    	padding: 0;
    	width: 38px;
    	height: 38px;
    	color: #788DEE;
	}
	
	.id_color1{
		background-color: #0064FF !important;
	}
	.id_color2{
		background-color: #B2FA5C !important;
	}
	.id_color3{
		background-color: #2CE0BC !important;
	}
	.id_color4{
		background-color: #FF6A89 !important;
	}
	.id_color5{
		background-color: #FF82FF !important;
	}
	.id_color6{
		background-color: #BE2457 !important;
	}
	.id_color7{
		background-color: #FFBE0A !important;
	}
	.id_color8{
		background-color: #D27328 !important;
	}
	.id_color9{
		background-color: #8B4F1D !important;
	}
	.id_color10{
		background-color: #CD0000 !important;
	}
	.breadcrumb-main {margin-top: 40px !important}
	.breadcrumb-title {font-size: 20px !important; padding: 2px 0 0 !important;}
	.wrapper {padding: 0px 0 50px !important;}
	
	.select-hide{
		display: none;
	}
	.select-show{
		display: block;
	    position: absolute;
	    z-index :10;
	    top: 42px;
	    width: 97.5%;
	    background-color: white;
	    border:1px solid;
	    border-radius: 5px;
	    cursor: pointer;
	    overflow-y: auto;
	    height: 150px;
	}
	
	.select > input[type="text"] {width: 100%;} 
	
	.select .select-show li{
	    padding:0 0 0 10px;
	    line-height: 30px;
	    text-align: left;
	}
	
</style>
<!-- 공통 헤더 -->
<th:block th:include="/../fragments/header.html"></th:block>
<link rel="stylesheet" href="/../assets/vendor_assets/css/plan-insert.css">

</head>
<body class="layout-light top-menu overlayScroll">
     
	<div class="mobile-search"></div>
	
	<div class="mobile-author-actions"></div>
	
	<!-- 공통 topbar -->
	<th:block th:include="/../fragments/topbar.html"></th:block>
	
	<main class="main-content" style="background-color: #F9FBFD;">
		
		<div class="contents" style="background-color: #F9FBFD;">
			
			<div class="container-fluid">
				 
			    <div class="wrapper clearfix">
			    	<div class="row">
				        <div class="col-lg-12">
				        	<div class="breadcrumb-main" style="justify-content: start;">
				        		<h4 class="text-capitalize breadcrumb-title">계획수립</h4>
				        		<span class="ml-20 mt-1">재배관리-계획수립</span>
				        	</div>
				        </div>
			        </div>
			        <section id="section">
			        
			            <div class="step" id="step1">
			                <div class="step_inner clearfix" id="step1_inner">
			                    <div class="title">
			                        <h3>Step 1. 포장선택<span></span></h3>
			                    </div>
			                    <div class="content clearfix">
			                    	<div class="row ml-4" style="float: left; margin-left: 15px;">
			        					<label class="color-dark align-center">포장</label>
			                            <input type="text" class="form-control b-light" id="storage_input" readonly="readonly" style="width: 300px; margin-left: 10px;">
			                    	</div>
			                        <div class="btn_ver">
			                            <button type="button" id="storageBtn">신규등록</button>
			                        </div>
			                        <div class="btn btn_new">
			                            
			                            <table id="table1" style="width:max-content">
			                                <thead>
			                                <tr class="title">
			                                    <th>위치ID</th>
	                            				<th>위치</th>
	                            				<th>구획구분</th>
			                                </tr>
			                                </thead>
			                                <tbody id="storage_list">
			                                	
			                                </tbody>
			                            </table>
			                            
			                        </div>
			                        <div class="content_right">
 			                            <div class="img_inner" id="map_regist" style="width:100%; height: 600px;">
											
 			                            </div>
			                        </div>
			                        <div class="row pageBtn" style="justify-content: center;">
			                        	<div id="pageNum" style="text-align:center; margin: 2% 0 0 0;"></div>
		                        	</div>
		                        	<div class="submit clearfix">
		                                <button type="button" id="step-1-btn" onclick="nextStep(2);">다음</button>
		                            </div>
			                    </div>
			                </div>
			            </div>
			            <div class="step" id="step2">
			                <div class="step_inner clearfix" id="step2_inner">
			                    <div class="title">
			                        <h3>Step 2. 과제 선택<span></span></h3>
			                    </div>
			                    <div class="content clearfix">
			                        <div class="btn btn_select1" style="display:block">
			                            <!-- <select class="form-control b-light department" id="select_view1" name="">
			                                <option th:value=0 disabled="disabled" selected="selected" hidden="hidden">과제 선택</option>
			                                <th:block th:each="report : ${report}">
			                                	<option th:value="${report.report_code}" th:text="${report.report_title +'('+ report.report_code} +')'"></option>
			                                </th:block>
			                            </select> -->
			                            <div class="select" data-role="selectBox" style="height: auto;">
	                                		<input type="text" data-value="optValue" onkeyup="filter();" data-code="" class="selected-option form-control" id="select_view1" placeholder="과제 선택" autocomplete="off">
	                                		<ul class="select-hide">
	                                			<th:block th:each="report : ${report}">
	                                				<li class="report_list">
	                                					<span class="report_text" th:data-id="${report.report_code}" th:text="${report.report_title +'('+ report.report_code} +')'"></span>
	                                				</li>
	                                			</th:block>
	                                		</ul>
	                                	</div>
			                            <div class="submit clearfix">
			                                <button type="button" id="step-2-btn" onclick="nextStep(3);">다음</button>
			                            </div>
			                        </div>
			                    </div>
			                </div>
			            </div>
			            <div class="step" id="step3">
			                <div class="step_inner clearfix" id="step3_inner">
			                    <div class="title">
			                        <h3>Step 3. 시험구배치<span></span></h3>
			                    </div>
			                    <div class="content clearfix">
			                        <span class="title">시험구배치 종류</span>
			                        <div class="btn btn2">
			                            <select id="grow_type" class="select_view" name="">
			                            	<option value="none" disabled="disabled" selected="selected" hidden="hidden">시험구배치 선택</option>
			                                <option value="0">완전임의배치</option>
			                                <option value="1">난괴법</option>
			                                <option value="2">분할구배치법</option>
			                                <option value="3">세세구배치법</option>
			                            </select>
			                        </div>
			                        <ul class="select_list clearfix"> <!-- select list -->
			                            <li class="btn sub_btn">
			                                <span class="sub_title">요인1</span>
			                                <select id="select_view2" class="select_view" data-index="1">
			                                    <option value="시험재료">시험재료</option>
				                                <option value="재식거리">재식거리</option>
				                                <option value="재식주수">재식주수</option>
				                                <option value="파종량">파종량</option>
				                                <option value="시비량">시비량</option>
				                                <option value="기타">기타</option>
			                                </select>
			                                <div class="btn_button">
			                                    <button class="setting">설정</button>
			                                </div>
			                                <div class="choi_select">
			                                    <div class="text_inner" id="text_inner1"></div>
			                                </div>
			                            </li>
			                            <li class="btn sub_btn">
			                                <span class="sub_title">요인2</span>
			                                <select id="select_view2" class="select_view" data-index="2">
			                                    <option value="시험재료">시험재료</option>
				                                <option value="재식거리">재식거리</option>
				                                <option value="재식주수">재식주수</option>
				                                <option value="파종량">파종량</option>
				                                <option value="시비량">시비량</option>
				                                <option value="기타">기타</option>
			                                </select>
			                                <div class="btn_button">
			                                    <button class="setting">설정</button>
			                                </div>
			                                <div class="choi_select">
			                                    <div class="text_inner" id="text_inner2"></div>
			                                </div>
			                            </li>
			                            <li class="btn sub_btn">
			                                <span class="sub_title">요인3</span>
			                                <select id="select_view2" class="select_view" data-index="3">
			                                    <option value="시험재료">시험재료</option>
				                                <option value="재식거리">재식거리</option>
				                                <option value="재식주수">재식주수</option>
				                                <option value="파종량">파종량</option>
				                                <option value="시비량">시비량</option>
				                                <option value="기타">기타</option>
			                                </select>
			                                <div class="btn_button">
			                                    <button class="setting">설정</button>
			                                </div>
			                                <div class="choi_select">
			                                    <div class="text_inner" id="text_inner3"></div>
			                                </div>
			                            </li>
			                        </ul>
			                        <div class="repeat">
			                            <h6><span class="red" style="color: #FF4141">*</span>반복</h6>
			                            <input type="text" id="plan_repeat" value="1">
			                        </div>
			                        <div class="submit clearfix">
			                            <button type="button" id="step-3-btn">다음</button>
			                        </div>
			                    </div>
			                </div>
			            </div>
			            <div class="step" id="step4">
			                <div class="step_inner clearfix" id="step4_inner">
			                    <div class="title">
			                        <h3>Step 4. 구획 설정<span></span></h3>
			                    </div>
			                    <div class="content clearfix">
			                        <div class="btn btn_new" id="copy-step-4">
		                            	<table id="table2">
			                                <thead>
			                                <tr class="title">
			                                    <th>구획번호</th>
			                                    <th>구획ID</th>
			                                    <th>처리종류</th>
			                                    <th>반복</th>
			                                    <th>처리포장면적(㎡)</th>
			                                </tr>
			                                </thead>
			                                <tbody class="step4-container container1">
			                                	
			                                </tbody>
			                            </table>
			                        </div>
			                        <div class="content_right">
			                            <div class="img_inner">
			                                <div class="top_btn-left">
			                                    <h6><span class="red" style="color: #FF4141">*</span>열의 갯수</h6>
			                                    <input type="text" value="10" id="mil2" style="border-radius: 5px 0 0 5px; width: 40%; margin-left: 10px;">
			                                    <button id="step4-columnBtn" style="height: 33px; border-radius: 0 5px 5px 0; ">적용</button>
			                                </div>
			                                <div class="top_btn-right clearfix">
			                                    <ul>
			                                        <li><button id="random01">요인 랜덤화</button></li>
			                                        <li><button id="random02">수준 랜덤화</button></li>
			                                    </ul>
			                                </div>
			                                <div class="background-wrap">
			                                    <ul id="step4-segment">
				                                    <template id='segmentComp'>
				                                    	<li>
				                                    		<div href="">A1-B1-1</div>
				                                            <div class="arrowMove">
				                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrows-move" viewBox="0 0 16 16">
				                                                  <path fill-rule="evenodd" d="M7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708l2-2zM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10zM.146 8.354a.5.5 0 0 1 0-.708l2-2a.5.5 0 1 1 .708.708L1.707 7.5H5.5a.5.5 0 0 1 0 1H1.707l1.147 1.146a.5.5 0 0 1-.708.708l-2-2zM10 8a.5.5 0 0 1 .5-.5h3.793l-1.147-1.146a.5.5 0 0 1 .708-.708l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L14.293 8.5H10.5A.5.5 0 0 1 10 8z"/>
				                                                </svg>
				                                            </div>
				                                            <div class="refresh">
				                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-repeat" viewBox="0 0 16 16">
				                                                  <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"/>
				                                                  <path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"/>
				                                                </svg>
				                                            </div>
				                                        </li>
				                                    </template>
			                                    </ul>
			                                </div>
			                            </div>
			                        </div>
			                        <div class="submit clearfix" style="margin-top: 20px;">
			                            <button type="button" id="step-4-btn" onclick="nextStep(5);">다음</button>
			                        </div>
			                    </div>
			                </div>
			            </div>
			            <div class="step" id="step5">
			                <div class="step_inner clearfix" id="step5_inner">
			                    <div class="title">
			                        <h3>Step 5. 조사 항목 선택<span></span></h3>
			                    </div>
			                    <div class="content clearfix">
			                        <div class="row">
					            		<div class="col-lg-5">
											<div class="row">
												<input type="text" onkeyup="filterMethod();" class="form-control b-light" id="searchMethod" placeholder="조사항목, 프로토콜명 검색"
														style="width: 100%; padding: 20px 20px;">
											</div>
											<div class="row">
												<div class="table-responsive">
													<table class="table">
														<thead>
															<tr>
																<th></th>
																<th>분류</th>
																<th>조사항목</th>
																<th>작목</th>
																<th>프로토콜 명</th>
																<th>프로토콜 설명</th>
															</tr>
														</thead>
														<tbody style="max-height: 500px; orverfolw-y: auto;" id="method_list">
															<tr class="method_tr" th:Each="m : ${method}">
																<td><input type="checkbox" name="chk_method" th:value="${m.method_id}"></td>
																<td class="d2_name" th:text="${m.d2_name}"></td>
																<td class="d3_name" th:text="${m.d3_name}"></td>
																<td class="d1_name" th:text="${m.d1_name}"></td>
																<td class="method_title" th:text="${m.method_title}"></td>
																<td class="method_contents" th:text="${m.method_contents}"></td>
															</tr>
														</tbody>
													</table>
												</div>
											</div>
										</div>
										<div class="box_content" style="justify-content: center;align-items: center;">
											<div class="box_center">
												<ul>
													<li><button onclick="PlusMethod();"><span data-feather="plus"></span></button></li>
													<li><button onclick="MinusMethod();"><span data-feather="minus"></span></button></li>
												</ul>
											</div>
										</div>
										<div class="col-lg-6">
											<ul class="list-group" id="method-container" style="min-height: 400px; max-height: 400px;
												overflow-y: auto; background-color: rgb(243, 243, 243) ">
												
											</ul>
										</div>
					            	</div>
			                        <div class="submit clearfix">
			                            <button type="button" id="step-5-btn" onclick="nextStep(6);">다음</button>
			                        </div>
			                    </div>
			                </div>
			            </div>
		            	<div class="step" id="step6">
			                <div class="step_inner clearfix" id="step6_inner">
			                    <div class="title">
			                        <h3>Step 6. 담당자 및 일정<span></span></h3>
			                    </div>
			                    <div class="content clearfix" id="step6_list">
			                        
			                    </div>
			                </div>
			            </div>
			            <div class="submit_btn">
			                <div class="submit_btn-inner">
			                    <button class="list" id="listBtn">목록</button>
			                    <button class="submit" id="planInsertBtn">등록</button>
			                </div>
			            </div>
			        </section>
			    </div>
			</div>
			
		</div>
		
		<div class="atbd-notice" id="success_popup" style="width:100vw; height:90vh; position:fixed; left:0px; top:0px; display:none; justify-content: center; align-items:center;">
        	<div class="card card-default card-md mb-4" style="border:1px solid #eee; width: 20%; height: 25%;">
        		<div class="card-body">
        			<div class="atbd-notice__content">
        				<div class="atbd-notice__top text-center">
        					<div class="atbd-notice__icon bg-success">
        						<i class="fas fa-check color-white"></i>
        					</div>
        					<div class="atbd-notice__text">
        						<h4>등록이 완료되었습니다.</h4>
        					</div>
        					<div style="display: flex; justify-content: center; margin: 10% auto;">
        						<a class="btn btn-default btn-success" href="/plan/list" style="color: #FFFFFF;">확인</a>
        					</div>
        				</div>
        			</div>
        		</div>
        	</div>
        </div>
	    <div class="atbd-notice" id="info_popup" style="z-index:999999999999999; width:100vw; height:90vh; position:fixed; left:0px; top:0px; display:none; justify-content: center; align-items:center;">
        	<div class="card card-default card-md mb-4" style="border:1px solid #eee; width: 20%; height: 25%;">
        		<div class="card-body">
        			<div class="atbd-notice__content">
        				<div class="atbd-notice__top text-center">
        					<div class="atbd-notice__icon bg-success">
        						<i class="fas fa-check color-white"></i>
        					</div>
        					<div class="atbd-notice__text">
        						<h4>구획 데이터를 작업중입니다.</h4>
        					</div>
        				</div>
        			</div>
        		</div>
        	</div>
        </div>
		
		<div class="modal-basic modal fade show" id="storageModal" tabindex="-1" role="dialog" aria-hidden="true">
		    <div class="modal-dialog modal-xl" role="document">
		        <div class="modal-content modal-bg-white">
		        	<div class="modal-header">
		        		<h6 class="modal-title">신규등록</h6>
                    	<button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        	<span data-feather="x"></span>
                        </button>
		        	</div>
		            <div class="modal-body">
		            	<div class="col-12">
			            	<form action="#" id="insertStorageForm" method="POST" enctype="multipart/form-data">
			            		<div class="row">
			            			<div class="col-sm-2 d-flex aling-items-center">
		                            	<label for="storage_name" class="col-form-label color-dark align-center">위치<span style="color: red;">*</span></label>
	                                </div>
	                                <div class="col-sm-10">
		                                <input type="text" class="form-control b-light" id="storage_name" name="storage_name">
		                            </div>
			            		</div>
			            		<div class="row mt-3">
			            			<div class="col-sm-2 d-flex aling-items-center">
		                            	<label for="storage_division" class="col-form-label color-dark align-center">구획구분</label>
	                                </div>
	                                <div class="col-sm-10">
		                                <input type="text" class="form-control b-light" id="storage_division" name="storage_division">
		                            </div>
			            		</div>
			            		<div class="row mt-3">
			            			<div class="col-sm-2 d-flex aling-items-center">
		                            	<label for="storage_size" class="col-form-label color-dark align-center">면적</label>
	                                </div>
	                                <div class="col-sm-5">
		                                <input type="text" class="form-control b-light" id="storage_size" name="storage_size">
		                            </div>
			            		</div>
			            		<div class="row mt-3">
			            			<div class="col-sm-2 d-flex aling-items-center">
		                            	<label for="storage_type" class="col-form-label color-dark align-center">장소유형<span style="color: red;">*</span></label>
	                                </div>
	                                <div class="col-sm-5">
		                                <select class="form-control b-light" id="storage_type" name="storage_type">
	                                		<option value="9">유형 선택</option>
	                                		<option value="0">작물 연구동</option>
	                                		<option value="1">가공이용 연구동</option>
	                                		<option value="2">연천 시험지</option>
	                                		<option value="3">외부 포장지</option>
		                                </select>
		                            </div>
			            		</div>
			            		<div class="row mt-3">
			            			<div class="col-sm-2 d-flex aling-items-center">
		                            	<label for="storage_contents" class="col-form-label color-dark align-center">Comment</label>
	                                </div>
	                                <div class="col-sm-10">
		                                <textarea class="form-control" id="storage_contents" name="storage_contents" rows="10"></textarea>
		                            </div>
			            		</div>
			            		<div class="row mt-3">
			            			<div class="col-sm-2 d-flex aling-items-center">
		                            	<label class="col-form-label color-dark align-center">지도</label>
	                                </div>
	                                <div class="col-sm-10" id="modal_map" style="height: 300px;">
		                                
		                            </div>
			            		</div>
			            		<div class="button-group d-flex justify-content-end mt-2">
			            			<input type="hidden" id="storage_location" name="storage_location">
			            			<button type="button" class="btn btn-primary btn-default btn-squared" onclick="insertStorage();">저장</button>
				           		</div>
			            	</form>
		            	</div>
		            </div>
		        </div>
		    </div>
		</div>
		
	    
	    <div class="modal-basic modal fade show" id="seedModal" tabindex="-1" role="dialog" aria-hidden="true">
		    <div class="modal-dialog modal-xl" role="document">
		        <div class="modal-content modal-bg-white">
		            <div class="modal-body">
		            	<div class="row">
			        		<div class="col-12">
			        			<h2 style="float: left;">시험 재료</h2>
					        	<div class="d-flex justify-content-end">
			                		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span data-feather="x"></span></button>
			                	</div>
			        		</div>
			        	</div>
		            	<div class="row mt-3">
		            		<div class="col-lg-5">
								<div class="row">
									<input type="text" onkeyup="filterSeed();" class="form-control b-light" id="searchSeed" placeholder="작목명, 품종명 검색"
											style="width: 100%; padding: 20px 20px;">
								</div>
								<div class="row">
									<div class="table-responsive">
										<table class="table">
											<thead>
												<tr>
													<th></th>
													<th>시료번호</th>
													<th>작목</th>
													<th>품종명</th>
													<th>품종 생산년도</th>
												</tr>
											</thead>
											<tbody style="max-height: 500px; orverfolw-y: auto;" id="seed_list">
												
											</tbody>
										</table>
									</div>
								</div>
							</div>
							<div class="box_content" style="justify-content: center;align-items: center;">
								<div class="box_center">
									<ul>
										<li><button onclick="PlusSeed();"><span data-feather="plus"></span></button></li>
										<li><button onclick="MinusSeed();"><span data-feather="minus"></span></button></li>
									</ul>
								</div>
							</div>
							<div class="col-lg-6">
								<ul class="list-group" id="step-container" style="min-height: 400px; max-height: 400px;
									overflow-y: auto; background-color: rgb(243, 243, 243) ">
									
								</ul>
							</div>
		            	</div>
			            
			            <div class="row" style="flex-direction:row-reverse; padding: 20px 17px;">
			            	<div class="input_submit">
				                <button type="button" id="useSeed" onclick="useSeed();">요인 사용</button>
				            </div>
			            </div>
		            </div>
		        </div>
		    </div>
		</div>
		
		<div class="modal-basic modal fade show" id="intervalModal" tabindex="-1" role="dialog" aria-hidden="true">
		    <div class="modal-dialog modal-xl" role="document">
		        <div class="modal-content modal-bg-white">
		            <div class="modal-body">
		            	<div class="row">
			        		<div class="col-12">
			        			<h2 style="float: left;">재식거리</h2>
					        	<div class="d-flex justify-content-end">
			                		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span data-feather="x"></span></button>
			                	</div>
			        		</div>
			        	</div>
		            	<div class="row mt-3">
		            		<div class="col-md-6">
		            			<div class="row">
		            				<div class="col-sm-4 d-flex aling-items-center">
	                            		<label class="color-dark align-center">재식거리<span style="color: red;">*</span></label>
		                            </div>
		                            <div class="col-sm-8">
	                                	<select id="intervalSelect" class="select_view">
		                                	<option value="none" disabled="disabled" selected="selected" hidden="hidden">재식거리 선택</option>
		                                    <option value="60x10">60x10</option>
			                                <option value="60x15">60x15</option>
			                                <option value="60x20">60x20</option>
			                                <option value="60x25">60x25</option>
			                                <option value="60x30">60x30</option>
			                                <option value="70x10">70x10</option>
			                                <option value="70x15">70x15</option>
			                                <option value="70x20">70x20</option>
			                                <option value="70x25">70x25</option>
			                                <option value="70x30">70x30</option>
			                                <option value="70x40">70x40</option>
			                                <option value="70x70">70x70</option>
			                                <option value="75x20">75x20</option>
			                                <option value="80x25">80x25</option>
			                                <option value="100x100">100x100</option>
			                                <option value="110(80+30)x15">110(80+30)x15</option>
			                                <option value="120(90+30)x30">120(90+30)x30</option>
			                                <option value="기타">기타</option>
		                                </select>
		                            </div>
		            			</div>
		            			<div class="row" id="intervaletcForm">
		            				<div class="col-md-3"></div>
		            			</div>
		            			<div class="row" style="flex-direction:row-reverse; padding: 20px 17px;">
					            	<div class="input_submit">
						                <button type="button" onclick="PlusInterval();">수준 추가</button>
						            </div>
					            </div>
		            		</div>
		            		<div class="col-md-6">
		            			<div class="row">
									<div class="table-responsive">
										<table class="table">
											<thead>
												<tr>
													<th colspan="2">재식거리</th>
												</tr>
											</thead>
											<tbody id="interval_body">
												
											</tbody>
										</table>
									</div>
								</div>
		            		</div>
		            	</div>
			            <div class="row" style="flex-direction:row-reverse; padding: 20px 17px;">
			            	<div class="input_submit">
				                <button type="button" id="useInterval">요인 사용</button>
				            </div>
			            </div>
		            </div>
		        </div>
		    </div>
		</div>
		
		<div class="modal-basic modal fade show" id="plantsModal" tabindex="-1" role="dialog" aria-hidden="true">
		    <div class="modal-dialog modal-xl" role="document">
		        <div class="modal-content modal-bg-white">
		            <div class="modal-body">
		            	<div class="row">
			        		<div class="col-12">
			        			<h2 style="float: left;">재식주수</h2>
					        	<div class="d-flex justify-content-end">
			                		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span data-feather="x"></span></button>
			                	</div>
			        		</div>
			        	</div>
		            	<div class="row mt-3">
		            		<div class="col-md-6">
		            			<div class="row">
		            				<div class="col-sm-4 d-flex aling-items-center">
	                            		<label class="color-dark align-center">재식주수<br>(포기당 식물체수)<span class="mt-4" style="color: red;">*</span></label>
		                            </div>
		                            <div class="col-sm-8">
	                                	<input type="text" class="form-control b-light" id="plants_text" style="width: 100%;">
		                            </div>
		            			</div>
		            			<div class="row" style="flex-direction:row-reverse; padding: 20px 17px;">
					            	<div class="input_submit">
						                <button type="button" onclick="PlusPlants();">수준 추가</button>
						            </div>
					            </div>
		            		</div>
		            		<div class="col-md-6">
		            			<div class="row">
									<div class="table-responsive">
										<table class="table">
											<thead>
												<tr>
													<th colspan="2">재식주수</th>
												</tr>
											</thead>
											<tbody id="plants_body">
												
											</tbody>
										</table>
									</div>
								</div>
		            		</div>
		            	</div>
			            <div class="row" style="flex-direction:row-reverse; padding: 20px 17px;">
			            	<div class="input_submit">
				                <button type="button" id="usePlants">요인 사용</button>
				            </div>
			            </div>
		            </div>
		        </div>
		    </div>
		</div>
		
		<div class="modal-basic modal fade show" id="amountModal" tabindex="-1" role="dialog" aria-hidden="true">
		    <div class="modal-dialog modal-xl" role="document">
		        <div class="modal-content modal-bg-white">
		            <div class="modal-body">
		            	<div class="row">
			        		<div class="col-12">
			        			<h2 style="float: left;">파종량</h2>
					        	<div class="d-flex justify-content-end">
			                		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span data-feather="x"></span></button>
			                	</div>
			        		</div>
			        	</div>
		            	<div class="row mt-3">
		            		<div class="col-md-6">
		            			<div class="row">
		            				<div class="col-sm-4 d-flex aling-items-center">
	                            		<label class="color-dark align-center">파종량<span style="color: red;">*</span></label>
		                            </div>
		                            <div class="col-sm-8">
	                                	<input type="text" class="form-control b-light" id="amount_text" style="width: 100%;">
		                            </div>
		            			</div>
		            			<div class="row" style="flex-direction:row-reverse; padding: 20px 17px;">
					            	<div class="input_submit">
						                <button type="button" onclick="PlusAmount();">수준 추가</button>
						            </div>
					            </div>
		            		</div>
		            		<div class="col-md-6">
		            			<div class="row">
									<div class="table-responsive">
										<table class="table">
											<thead>
												<tr>
													<th colspan="2">파종량</th>
												</tr>
											</thead>
											<tbody id="amount_body">
												
											</tbody>
										</table>
									</div>
								</div>
		            		</div>
		            	</div>
			            <div class="row" style="flex-direction:row-reverse; padding: 20px 17px;">
			            	<div class="input_submit">
				                <button type="button" id="useAmount">요인 사용</button>
				            </div>
			            </div>
		            </div>
		        </div>
		    </div>
		</div>
		
		<div class="modal-basic modal fade show" id="manureModal" tabindex="-1" role="dialog" aria-hidden="true">
		    <div class="modal-dialog modal-xl" role="document">
		        <div class="modal-content modal-bg-white">
		            <div class="modal-body">
		            	<div class="row">
			        		<div class="col-12">
			        			<h2 style="float: left;">시비량</h2>
					        	<div class="d-flex justify-content-end">
			                		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span data-feather="x"></span></button>
			                	</div>
			        		</div>
			        	</div>
		            	<div class="row mt-3">
		            		<div class="col-md-12" id="manure-form">
		            			<div class="row">
		        					<div class="col-sm-2 d-flex aling-items-center">
		                            	<label class="color-dark align-center">면적(m2)<span style="color: red;">*</span></label>
		                            </div>
		                            <div class="col-sm-10">
		                                <input type="text" class="form-control b-light" id="manure_area" style="width: 100%;">
		                            </div>
		                    	</div>
		                    	<div class="row mt-3">
		        					<div class="col-sm-2 d-flex aling-items-center">
		                            	<label for="method_input" class="color-dark align-center">비료 성분<span style="color: red;">*</span></label>
		                            </div>
		                            <div class="col-sm-5">
		                                <select class="form-control b-light" id="fert_1">
			                                <option th:value=0 disabled="disabled" selected="selected" hidden="hidden">비료성분 선택</option>
			                                <th:block th:each="fert : ${fert}">
			                                	<option th:value="${fert.fert_id}" th:text="${fert.fertilizer}"></option>
			                                </th:block>
			                                <option th:value="etc">기타(직접입력)</option>
		                                </select>
		                            </div>
		                            <div class="col-sm-5">
		                            	<select class="form-control b-light" id="fert_2">
			                                <option value="">비료종류 선택</option>
		                                </select>
		                            </div>
		                    	</div>
		                    	<div class="row mt-3" style="display: none;" id="etc_row">
		        					<div class="col-sm-2 d-flex aling-items-center">
		                            	
		                            </div>
		                            <div class="col-sm-5">
		                                <input type="text" class="form-control b-light" id="manure_etc1" placeholder="비료성분" style="width: 100%;">
		                            </div>
		                            <div class="col-sm-5">
		                                <input type="text" class="form-control b-light" id="manure_etc2" placeholder="비료종류" style="width: 100%;">
		                            </div>
		                    	</div>
		                    	<div class="row mt-3">
		        					<div class="col-sm-2 d-flex aling-items-center">
		                            	<label class="color-dark align-center">시비량(kg/10a)</label>
		                            </div>
		                            <div class="col-sm-10">
		                                <input type="text" class="form-control b-light" id="manure_amount" placeholder="시비량(kg/10a)" style="width: 100%;">
		                            </div>
		                    	</div>
		                    	<div class="row mt-3">
		        					<div class="col-sm-2 d-flex aling-items-center">
		                            	<label class="color-dark align-center">성분량(%)</label>
		                            </div>
		                            <div class="col-sm-10">
		                                <input type="text" class="form-control b-light" id="manure_percent" placeholder="성분량(%)" style="width: 100%;">
		                            </div>
		                    	</div>
		                    	<div class="row mt-3">
		        					<div class="col-sm-2 d-flex aling-items-center">
		                            	<label class="color-dark align-center">값(kg)</label>
		                            </div>
		                            <div class="col-sm-10">
		                                <input type="text" class="form-control b-light" id="manure_result" placeholder="값(kg)" style="width: 100%;" readonly="readonly">
		                            </div>
		                    	</div>
		            			<div class="row">
		            				<div class="d-flex justify-content-start">
						                <button type="button" onclick="PlusManure();" id="plusManure"><span data-feather="plus"></span></button> <!-- style 삭제 span 추가 11-02 수정 -->
						            </div>
					            </div>
		            		</div>
		            	</div>
		            	<div class="row mt-2" id="copy_form">
		            		<div class="col-lg-12 form_standard">
		            			<div class="table-responsive">
									<table class="table">
										<thead>
											<tr style="text-align: center;">
												<th>비료성분</th>
												<th>비료종류</th>
												<th>시비량(kg/10a)</th>
												<th>성분량(%)</th>
												<th>값(kg)</th>
												<th></th>
											</tr>
										</thead>
										<tbody id="manure_body">
											
										</tbody>
									</table>
								</div>
		            		</div>
		            	</div>
		            	<div class="row" style="flex-direction:row-reverse; padding: 20px 17px;">
				        	<button type="button" onclick="PlusManureLevel();" id="PlusManureLevel" style="width: 100px; height: 40px; font-size: small;">수준 추가</button>
			            </div>
			            <div class="row mt-2" id="copy_form_table">
			            	
			            </div>
			            <div class="row" style="flex-direction:row-reverse; padding: 20px 17px;">
			            	<div class="input_submit">
				                <button type="button" id="useManure">요인 사용</button>
				            </div>
			            </div>
		            </div>
		        </div>
		    </div>
		</div>
		
		<div class="modal-basic modal fade show" id="etcModal" tabindex="-1" role="dialog" aria-hidden="true">
		    <div class="modal-dialog modal-xl" role="document">
		        <div class="modal-content modal-bg-white">
		            <div class="modal-body">
		            	<div class="row">
			        		<div class="col-12">
			        			<h2 style="float: left;">기타</h2>
					        	<div class="d-flex justify-content-end">
			                		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span data-feather="x"></span></button>
			                	</div>
			        		</div>
			        	</div>
		            	<div class="row mt-3">
		            		<div class="col-md-6">
		            			<div class="row">
		            				<div class="col-sm-4 d-flex aling-items-center">
	                            		<label class="color-dark align-center">기타요인<span style="color: red;">*</span></label>
		                            </div>
		                            <div class="col-sm-8">
	                                	<select id="etc_type" class="select_view">
		                                	<option value="none" disabled="disabled" selected="selected" hidden="hidden">기타요인 선택</option>
		                                    <option value="온도">온도</option>
			                                <option value="관수">관수</option>
			                                <option value="상토">상토</option>
			                                <option value="육묘">육묘</option>
			                                <option value="피복">피복</option>
			                                <option value="차광">차광</option>
			                                <option value="재배지">재배지</option>
			                                <option value="병접종 시기">병접종 시기</option>
			                                <option value="병접종 방법">병접종 방법</option>
			                                <option value="사료">사료</option>
			                                <option value="비가림">비가림</option>
			                                <option value="휴립">휴립</option>
			                                <option value="기타">기타</option>
		                                </select>
		                            </div>
		            			</div>
		            			<div class="row mt-3">
		            				<div class="col-sm-4 d-flex aling-items-center">
	                            		<label class="color-dark align-center">값<span style="color: red;">*</span></label>
		                            </div>
		                            <div class="col-sm-8">
	                                	<input type="text" class="form-control b-light" id="etc_value" style="width: 100%;">
		                            </div>
		            			</div>
		            			<div class="row mt-3">
		            				<div class="col-sm-4 d-flex aling-items-center">
	                            		<label class="color-dark align-center">Comment</label>
		                            </div>
		                            <div class="col-sm-8">
	                                	<textarea rows="4" class="form-control b-light" id="etc_comment"></textarea>
		                            </div>
		            			</div>
		            			<div class="row" style="flex-direction:row-reverse; padding: 20px 17px;">
					            	<div class="input_submit">
						                <button type="button" onclick="PlusEtc();">수준 추가</button>
						            </div>
					            </div>
		            		</div>
		            		<div class="col-md-6">
		            			<div class="row">
									<div class="table-responsive">
										<table class="table">
											<thead>
												<tr>
													<th>기타요인</th>
													<th>값</th>
													<th>Comment</th>
													<th></th>
												</tr>
											</thead>
											<tbody id="etc_body">
												
											</tbody>
										</table>
									</div>
								</div>
		            		</div>
		            	</div>
			            <div class="row" style="flex-direction:row-reverse; padding: 20px 17px;">
			            	<div class="input_submit">
				                <button type="button" id="useEtc">요인 사용</button>
				            </div>
			            </div>
		            </div>
		        </div>
		    </div>
		</div>
		
	</main>
	
	 <!-- 공통 하단 -->
    <th:block th:include="/../fragments/footer.html"></th:block>
    <!-- 공통 js -->
    <th:block th:include="/../fragments/commonjs.html"></th:block>
    <script type="text/javascript" src="/../assets/vendor_assets/js/plan-segment.js"></script>
    <script type="text/javascript" src="/../assets/vendor_assets/js/plan-render.js"></script>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=	e93e65b3e9a407aa43d05f993408db95&libraries=clusterer,services"></script>
<script type="text/javascript" th:inline="javascript">

	var user = /*[[${user}]]*/ "null";

	//시험구 배치 데이터
	var data1 = new Object();
	var data2 = new Object();
	var data3 = new Object();
	
	var manureArray = new Array();
	var manureArray1 = new Array();
	var manureArray2 = new Array();
	var manureArray3 = new Array();
	var etcArray = new Array();
	var etcArray1 = new Array();
	var etcArray2 = new Array();
	var etcArray3 = new Array();
	
	//스케줄 등록할 객체 array
	let scheduleArray = new Array();
	
	//구획 등록할 객체 array
	let segment_array = new Array();
	
	let body = document.querySelector('body');
	let select = document.querySelector('[data-role="selectBox"]');
	let dataValue = select.querySelector('[data-value="optValue"]');
	let option = select.querySelector('ul');
	let opts = option.querySelectorAll('li');
	
	function selects(e){
		e.stopPropagation();
	    if(option.classList.contains('select-hide')){
	        option.classList.remove('select-hide');
	        option.classList.add('select-show');
	    }else{
	        option.classList.add('select-hide');
	        option.classList.remove('select-show');
	    }
	    selectOpt();
		
	}
	
	function hideSelect(){
	    if(option.classList.contains('select-show')){
	        option.classList.add('select-hide');
	        option.classList.remove('select-show');
	    }
	}
	
	/* 옵션선택 */
	function selectOpt(){
	    opts.forEach(opt=>{
	        const innerValue = opt.children[0].innerHTML;
	        const dataCode = opt.children[0].getAttribute('data-id');
	        function changeValue(){
	        	dataValue.value = innerValue;
	        	dataValue.setAttribute('data-code', dataCode); 
	        }
	        opt.addEventListener('click',changeValue)
	    });
	}
	
	select.addEventListener('click',selects);
	body.addEventListener('click',hideSelect);
	
	//과제 필터 함수
	function filter(){
		var search = $("#select_view1").val().toLowerCase();
		
		$(document).find(".report_list").each(function(index, item){
			var text = $(this).find(".report_text").text();
			
			if(text.toLowerCase().includes(search)){
				$(this).css("display", "flex");
			}else{
				$(this).css("display", "none");
			}
		});
		
	}//end 과제 필터 함수

	$("#listBtn").on("click", function(){
		window.location.href = "/plan/list";
	});
	
	$("#storageBtn").on("click", function(){
		$("#storageModal").modal("show");	
		
		setTimeout(() => {
			const options = { 
					center: new kakao.maps.LatLng(37.263599, 126.987598),
    			    level: 3
    			};
    		map2 = new kakao.maps.Map(modalContainer, options);	  
			kakao.maps.event.addListener(map2, 'click', function(mouseEvent) { 
			    // 마커 생성   
			    const coord = mouseEvent.latLng;
			    createMarker(coord.La, coord.Ma, map)    
			    
			    var clickPosition = mouseEvent.latLng; 
			    
			    // 지도 클릭이벤트가 발생했는데 다각형이 그려지고 있는 상태가 아니면
			    if (!drawingFlag) {
			        // 상태를 true로, 다각형을 그리고 있는 상태로 변경합니다
			        drawingFlag = true;
			        
			        // 지도 위에 다각형이 표시되고 있다면 지도에서 제거합니다
			        if (polygon) {  
			            polygon.setMap(null);      
			            polygon = null;  
			        }
			        
			        // 지도 위에 면적정보 커스텀오버레이가 표시되고 있다면 지도에서 제거합니다
			        if (areaOverlay) {
			            areaOverlay.setMap(null);
			            areaOverlay = null;
			        }
			    
			        // 그려지고 있는 다각형을 표시할 다각형을 생성하고 지도에 표시합니다
			        drawingPolygon = new kakao.maps.Polygon({
			            map: map2, // 다각형을 표시할 지도입니다
			            path: [clickPosition], // 다각형을 구성하는 좌표 배열입니다 클릭한 위치를 넣어줍니다
			            strokeWeight: 3, // 선의 두께입니다 
			            strokeColor: '#00a0e9', // 선의 색깔입니다
			            strokeOpacity: 1, // 선의 불투명도입니다 0에서 1 사이값이며 0에 가까울수록 투명합니다
			            strokeStyle: 'solid', // 선의 스타일입니다
			            fillColor: '#00a0e9', // 채우기 색깔입니다
			            fillOpacity: 0.2 // 채우기 불투명도입니다
			        }); 
			        
			        // 그리기가 종료됐을때 지도에 표시할 다각형을 생성합니다 
			        polygon = new kakao.maps.Polygon({ 
			            path: [clickPosition], // 다각형을 구성하는 좌표 배열입니다 클릭한 위치를 넣어줍니다 
			            strokeWeight: 3, // 선의 두께입니다 
			            strokeColor: '#00a0e9', // 선의 색깔입니다   
			            strokeOpacity: 1, // 선의 불투명도입니다 0에서 1 사이값이며 0에 가까울수록 투명합니다
			            strokeStyle: 'solid', // 선의 스타일입니다
			            fillColor: '#00a0e9', // 채우기 색깔입니다
			            fillOpacity: 0.2 // 채우기 불투명도입니다
			        });
			
			        
			    } else { // 다각형이 그려지고 있는 상태이면 
			        
			        // 그려지고 있는 다각형의 좌표에 클릭위치를 추가합니다
			        // 다각형의 좌표 배열을 얻어옵니다
			        var drawingPath = drawingPolygon.getPath();
			    
			        // 좌표 배열에 클릭한 위치를 추가하고
			        drawingPath.push(clickPosition);
			        
			        // 다시 다각형 좌표 배열을 설정합니다
			        drawingPolygon.setPath(drawingPath);
			        
			    
			        // 그리기가 종료됐을때 지도에 표시할 다각형의 좌표에 클릭 위치를 추가합니다
			        // 다각형의 좌표 배열을 얻어옵니다
			        var path = polygon.getPath();
			    
			        // 좌표 배열에 클릭한 위치를 추가하고
			        path.push(clickPosition);
			        
			        // 다시 다각형 좌표 배열을 설정합니다
			        polygon.setPath(path);
			    }
			
			});
			
			// 지도에 마우스무브 이벤트를 등록합니다
			// 다각형을 그리고있는 상태에서 마우스무브 이벤트가 발생하면 그려질 다각형의 위치를 동적으로 보여주도록 합니다
			kakao.maps.event.addListener(map2, 'mousemove', function (mouseEvent) {
			
			    // 지도 마우스무브 이벤트가 발생했는데 다각형을 그리고있는 상태이면
			    if (drawingFlag){
			
			        // 마우스 커서의 현재 위치를 얻어옵니다 
			        var mousePosition = mouseEvent.latLng; 
			        
			        // 그려지고있는 다각형의 좌표배열을 얻어옵니다
			        var path = drawingPolygon.getPath();
			        
			        // 마우스무브로 추가된 마지막 좌표를 제거합니다
			        if (path.length > 1) {
			            path.pop();
			        } 
			        
			        // 마우스의 커서 위치를 좌표 배열에 추가합니다
			        path.push(mousePosition);
			
			        // 그려지고 있는 다각형의 좌표를 다시 설정합니다
			        drawingPolygon.setPath(path);
			    }             
			});     
			
			// 지도에 마우스 오른쪽 클릭 이벤트를 등록합니다
			// 다각형을 그리고있는 상태에서 마우스 오른쪽 클릭 이벤트가 발생하면 그리기를 종료합니다
			kakao.maps.event.addListener(map2, 'rightclick', function (mouseEvent) {
			
			    // 지도 오른쪽 클릭 이벤트가 발생했는데 다각형을 그리고있는 상태이면
			    if (drawingFlag) {
			        
			        // 그려지고있는 다각형을  지도에서 제거합니다
			        drawingPolygon.setMap(null);
			        drawingPolygon = null;  
			        
			        // 클릭된 죄표로 그릴 다각형의 좌표배열을 얻어옵니다
			        var path = polygon.getPath();
			    
			        // 다각형을 구성하는 좌표의 개수가 3개 이상이면 
			        if (path.length > 2) {
			            
			            // 지도에 다각형을 표시합니다
			            polygon.setMap(map2); 
			
			            var area = Math.round(polygon.getArea()), // 다각형의 총면적을 계산합니다
			                // content = '<div class="info">총면적 <span class="number"> ' + area + '</span> m<sup>2</sup></div>'; // 커스텀오버레이에 추가될 내용입니다
			                
			            // 면적정보를 지도에 표시합니다
			            areaOverlay = new kakao.maps.CustomOverlay({
			                map: map2, // 커스텀오버레이를 표시할 지도입니다 
			                content: "",  // 커스텀오버레이에 표시할 내용입니다
			                xAnchor: 0,
			                yAnchor: 0,
			                position: path[path.length-1]  // 커스텀오버레이를 표시할 위치입니다. 위치는 다각형의 마지막 좌표로 설정합니다
			            });      
			            clearMarkers(true)
			            
			        } else { 
			            
			            // 다각형을 구성하는 좌표가 2개 이하이면 다각형을 지도에 표시하지 않습니다 
			            polygon = null;  
			            clearMarkers()
			        }
			        
			        // 상태를 false로, 그리지 않고 있는 상태로 변경합니다
			        drawingFlag = false;          
			    }  
			});
		}, 150)
	});
	
	//초기 step4 구획 테이블 숨기기
	/* $("#copy-step-4-none").css("display", "none"); */
	
	//시험구배치 요인 설정 버튼 이벤트
	$(document).on("click", ".setting", function(){
		
		var name = $(this).parent().prev().find("option:selected").val();
		var index = $(this).parent().prev().attr("data-index");
		
		if(name == "시험재료"){
			getSeedList(index);
		}else if(name == "재식거리"){
			getIntervalList(index);
		}else if(name == "재식주수"){
			getPlantsList(index);
		}else if(name == "파종량"){
			getAmountList(index);
		}else if(name == "시비량"){
			getManureList(index);
		}else if(name == "기타"){
			getEtcList(index);
		}
		
	});
	
	//seedList ajax 함수
	function getSeedList(index){
		
		var report_code = $("#select_view1").attr("data-code");
		
		var data = {"report_code" : report_code};
		
		if(report_code == ""){
			alert("과제를 선택해 주세요.");
		}else{
			
			$.ajax({
				url : "/plan/selectSeed",
				method : "GET",
				dataType : 'json',
				data : data,
				success : function(result){
					
					var seed_list = $("#seed_list");
					var add_list = "";
					
					for(var i = 0; i < result.length; i++){
						add_list += '<tr class="seed_tr">';
						
						add_list += '<td><input type="checkbox" class="checkbox" name="chk_seed" value="' + result[i].seed_id + '"></td>';
						add_list += '<td>'+result[i].seed_code+'</td>';
						add_list += '<td class="text_1">'+result[i].division+'</td>';
						add_list += '<td class="text_2">'+result[i].genetic+'</td>';
						add_list += '<td>'+result[i].seed_year+'</td>';
						add_list += '</tr>';
					}//end for
					
					seed_list.empty();
					seed_list.append(add_list);
					
					//시험재료 초기화
					$("#step-container").empty();
					
					var step_container = $("#step-container");
					var str = "";
					//인덱스에 맞게 기존 시험재료 그리기
					if(index == 1){
						if(Object.keys(data1).length != 0){
							var seed_ids = data1.content.split(",");
							
							for(var i = 0; i < seed_ids.length; i++){
								for(var j = 0; j < result.length; j++){
									if(seed_ids[i] == result[j].seed_id){
										str += '<div th:data-id='+result[j].seed_id+' class="list-group list-step">';
										str += '<li class="list-group-item-sm list-group-item">';
										str += '<div class="row">';
										
										str += '<div class="mb-1 col-4">';
										str += '<input type="checkbox" class="checkbox mr-2" name="mis_seed">';
										str += '<span>' + result[j].seed_code + '</span>';
										str += '</div>';
										
										str += '<div class="mb-1 col-2">';
										str += '<span class="list_division">'+result[j].division+'</span>';
										str += '</div>';
										
										str += '<div class="mb-1 col-4">';
										str += '<span class="list_genetic">'+result[j].genetic+'</span>';
										str += '</div>';
										
										str += '<div class="mb-1 col-2">';
										str += '<span>'+result[j].seed_year+'</span>';
										str += '</div>';
											
										str += '</div>';
										str += '</li>';
										str += '</div>';
									}
								}//end for2
							}//end for1
							step_container.append(str);
						}//end if
					}else if(index == 2){
						if(Object.keys(data2).length != 0){
							var seed_ids = data2.content.split(",");
							
							for(var i = 0; i < seed_ids.length; i++){
								for(var j = 0; j < result.length; j++){
									if(seed_ids[i] == result[j].seed_id){
										str += '<div th:data-id='+result[j].seed_id+' class="list-group list-step">';
										str += '<li class="list-group-item-sm list-group-item">';
										str += '<div class="row">';
										
										str += '<div class="mb-1 col-4">';
										str += '<input type="checkbox" class="checkbox mr-2" name="mis_seed">';
										str += '<span>' + result[j].seed_code + '</span>';
										str += '</div>';
										
										str += '<div class="mb-1 col-2">';
										str += '<span class="list_division">'+result[j].division+'</span>';
										str += '</div>';
										
										str += '<div class="mb-1 col-4">';
										str += '<span class="list_genetic">'+result[j].genetic+'</span>';
										str += '</div>';
										
										str += '<div class="mb-1 col-2">';
										str += '<span>'+result[j].seed_year+'</span>';
										str += '</div>';
											
										str += '</div>';
										str += '</li>';
										str += '</div>';
									}
								}//end for2
							}//end for1
							step_container.append(str);
						}//end if
					}else if(index == 3){
						if(Object.keys(data3).length != 0){
							var seed_ids = data3.content.split(",");
							
							for(var i = 0; i < seed_ids.length; i++){
								for(var j = 0; j < result.length; j++){
									if(seed_ids[i] == result[j].seed_id){
										str += '<div th:data-id='+result[j].seed_id+' class="list-group list-step">';
										str += '<li class="list-group-item-sm list-group-item">';
										str += '<div class="row">';
										
										str += '<div class="mb-1 col-4">';
										str += '<input type="checkbox" class="checkbox mr-2" name="mis_seed">';
										str += '<span>' + result[j].seed_code + '</span>';
										str += '</div>';
										
										str += '<div class="mb-1 col-2">';
										str += '<span class="list_division">'+result[j].division+'</span>';
										str += '</div>';
										
										str += '<div class="mb-1 col-4">';
										str += '<span class="list_genetic">'+result[j].genetic+'</span>';
										str += '</div>';
										
										str += '<div class="mb-1 col-2">';
										str += '<span>'+result[j].seed_year+'</span>';
										str += '</div>';
											
										str += '</div>';
										str += '</li>';
										str += '</div>';
									}
								}//end for2
							}//end for1
							step_container.append(str);
						}//end if
					}
					
					var seedModalUseBtn = $("#useSeed");
					seedModalUseBtn.attr('th:data-index', index);
					$("#seedModal").modal("show");
				}
			});//end ajax
		}//end else
		
		
	}//end seedList
	
	//seed 체크박스 추가
	function PlusSeed()
	{
		var step_container = $("#step-container");
		var length = $("#step-container").children().length;
		
		var add_list = "";
		
		
		$(document).find("input:checkbox[name=chk_seed]:checked").each(function()
		{
			var seed_id = $(this).val();
			var seed_code = $(this).parent().next().text();
			var division = $(this).parent().next().next().text();
			var genetic = $(this).parent().next().next().next().text();
			var seed_year = $(this).parent().next().next().next().next().text();
			
			if(length == 0){
				length = 1;
			}else {
				length++;
			}
			
			add_list += '<div th:data-id='+seed_id+' class="list-group list-step">';
			add_list += '<li class="list-group-item-sm list-group-item">';
			add_list += '<div class="row">';
			
			add_list += '<div class="mb-1 col-4">';
			add_list += '<input type="checkbox" class="checkbox mr-2" name="mis_seed">';
			add_list += '<span>' + seed_code + '</span>';
			add_list += '</div>';
			
			add_list += '<div class="mb-1 col-2">';
			add_list += '<span class="list_division">'+division+'</span>';
			add_list += '</div>';
			
			add_list += '<div class="mb-1 col-4">';
			add_list += '<span class="list_genetic">'+genetic+'</span>';
			add_list += '</div>';
			
			add_list += '<div class="mb-1 col-2">';
			add_list += '<span>'+seed_year+'</span>';
			add_list += '</div>';
				
			add_list += '</div>';
			add_list += '</li>';
			add_list += '</div>';
			
		});
		
		step_container.append(add_list);
		
	}//end 조사방법 체크박스 추가
	
	//seed 체크박스 삭제
	function MinusSeed()
	{
		
		var step_container = $("#step-container");
		var add_list = "";
		
		//체크박스 삭제
		$(document).find("input:checkbox[name=mis_seed]:checked").each(function()
		{	
			var del_div = $(this).parent().parent().parent().parent();
			del_div.remove();
		});
	}//end 조사방법 체크박스 삭제
	
	//jquery sortable 적용	
	$(document).find("#step-container").sortable({
		placeholder : "itemBoxHighlight",
		start : function(event, ui){
			
		},
		stop : function(event, ui){
			
		}
	});//end sortable
	
	//seedModal 요인 사용 버튼 이벤트
	function useSeed(){
		var index = $("#useSeed").attr("th:data-index");
		var type = "시험재료";
		var content = "";
		var text = "";
		
		var length = $(document).find(".list-step").length;
		
		$(document).find(".list-step").each(function(i, item){
			
			if(i == (length-1)){
				content += $(this).attr("th:data-id");
				text += $(this).find(".list_division").text() + " " + "(" + $(this).find(".list_genetic").text() + ")";
			}else{
				content += $(this).attr("th:data-id")+',';
				text += $(this).find(".list_division").text() + " " + "(" + $(this).find(".list_genetic").text() + ")" +",";
			}
			
		});
		
		if(index == 1){
			data1.type = type;
			data1.content = content;
			data1.text = text;
			data1.type1 = "factor_seed";
			$("#text_inner1").text(text);
		}else if(index == 2){
			data2.type = type;
			data2.content = content;
			data2.text = text;
			data2.type1 = "factor_seed";
			$("#text_inner2").text(text);
		}else if(index == 3){
			data3.type = type;
			data3.content = content;
			data3.text = text;
			data3.type1 = "factor_seed";
			$("#text_inner3").text(text);
		}
		
		$("#seedModal").modal("hide");
	};
	
	//재식거리 함수
	function getIntervalList(index){
		$("#intervalModal").modal("show");
		
		//재식거리 셀렉트 박스 초기화
		$("#intervalSelect").val("none").attr("selected", true);
		$("#interval_body").empty();
		
		//기존 데이터 있을시 그려주기
		if(index == 1){
			if(Object.keys(data1).length != 0 && data1.type == "재식거리"){
				
				var body = $("#interval_body");
				var add_list = "";
				
				var intervals = data1.content.split(",");
				for(var i = 0; i < intervals.length; i++){
					add_list += '<tr class="interval_tr">';
					add_list += '<td class="interval_name">'+intervals[i]+'</td>';
					add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusInterval(this);">삭제</button></td>';
					add_list += '</tr>';
				}
				
				body.append(add_list);
			}//end if
		}else if(index == 2){
			if(Object.keys(data2).length != 0 && data2.type == "재식거리"){
				
				var body = $("#interval_body");
				var add_list = "";
				
				var intervals = data2.content.split(",");
				for(var i = 0; i < intervals.length; i++){
					add_list += '<tr class="interval_tr">';
					add_list += '<td class="interval_name">'+intervals[i]+'</td>';
					add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusInterval(this);">삭제</button></td>';
					add_list += '</tr>';
				}
				
				body.append(add_list);
			}//end if
		}else if(index == 3){
			if(Object.keys(data3).length != 0 && data3.type == "재식거리"){
				
				var body = $("#interval_body");
				var add_list = "";
				
				var intervals = data3.content.split(",");
				for(var i = 0; i < intervals.length; i++){
					add_list += '<tr class="interval_tr">';
					add_list += '<td class="interval_name">'+intervals[i]+'</td>';
					add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusInterval(this);">삭제</button></td>';
					add_list += '</tr>';
				}
				
				body.append(add_list);
			}//end if
		}
		
		var intervalModalUseBtn = $("#useInterval");
		intervalModalUseBtn.attr('th:data-index', index);
		
	}//emd 재식거리 함수
	
	//재식거리 요인 사용 함수
	$("#useInterval").on("click", function(){
		
		var index = $("#useInterval").attr("th:data-index");
		var type = "재식거리";
		var content = "";
		var text = "";
		
		var length = $(document).find(".interval_tr").length;
		
		$(document).find(".interval_tr").each(function(i, item){
			if(i == (length-1)){
				content += $(this).find(".interval_name").text();
				text += $(this).find(".interval_name").text();
			}else{
				content += $(this).find(".interval_name").text()+',';
				text += $(this).find(".interval_name").text()+',';
			}
		});
		
		if(index == 1){
			data1.type = type;
			data1.content = content;
			data1.type1 = "factor_interval";
			$("#text_inner1").text(text);
			$("#text_inner1").parent().css({"height" : "auto"});
		}else if(index == 2){
			data2.type = type;
			data2.content = content;
			data2.type1 = "factor_interval";
			$("#text_inner2").text(text);
		}else if(index == 3){
			data3.type = type;
			data3.content = content;
			data3.type1 = "factor_interval";
			$("#text_inner3").text(text);
		}
		
		$("#intervalModal").modal("hide");
		
		
	});
	
	//재식거리 기타 선택시 input 태그 추가 이벤트
	$("#intervalSelect").on("change", function(){
		var check = $(this).find("option:selected").val();
		var intervaletcForm = $("#intervaletcForm");
		
		if(check == "기타"){
			var add_list = "";
			add_list += '<div class="col-md-9" id="etc_form">';
			add_list += '<div class="form-group ml-2" style="position: relative; display: flex; flex-wrap: wrap;">';
			
			add_list += '<div class="pl-2" style="font-size: 0.75em; display: flex;">조간거리<br>(이량사이)</div>';
			add_list += '<input id="etc_text1" type="text" style="width: 80px; height: 20px;">';
			add_list += '<div class="pl-2" style="font-size: 0.75em; display: flex;"">주간거리<br>(포기사이)</div>';
			add_list += '<input id="etc_text2" type="text" style="width: 80px; height: 20px;">';
			
			add_list += '</div>';
			add_list += '</div>';
			
			intervaletcForm.append(add_list);
			
		}else{
			$(document).find("#etc_form").remove();
		}
	});
	
	//재식거리 수준 추가 버튼 이벤트
	function PlusInterval(){
		
		var interval = $("#intervalSelect option:selected").val();
		
		if(interval == "기타"){
			interval = $("#etc_text1").val() + "x" + $("#etc_text2").val();
		}
		
		var body = $("#interval_body");
		var add_list = "";
		
		add_list += '<tr class="interval_tr">';
		add_list += '<td class="interval_name">'+interval+'</td>';
		add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusInterval(this);">삭제</button></td>';
		add_list += '</tr>';
		
		body.append(add_list);
		
	}//end 재식거리 수준 추가
	
	//재식거리 수준 삭제 버튼 이벤트
	function MinusInterval(e){
		
		var del_div = $(e).parent().parent();
		del_div.remove();
	}//end 재식거리 수준 삭제
	
	//재식주수 함수
	function getPlantsList(index){
		$("#plantsModal").modal("show");
		
		//재식주수 입력창 초기화
		$("#plants_text").val("");
		$("#plants_body").empty();
		
		if(index == 1){
			if(Object.keys(data1).length != 0 && data1.type == "재식주수"){
				var body = $("#plants_body");
				var add_list = "";
				
				var plants = data1.content.split(",");
				for(var i = 0; i < plants.length; i++){
					add_list += '<tr class="plants_tr">';
					add_list += '<td class="plants_name">'+plants[i]+'</td>';
					add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusPlants(this);">삭제</button></td>';
					add_list += '</tr>';
				}
				
				body.append(add_list);
			}//end if
		}else if(index == 2){
			if(Object.keys(data2).length != 0 && data2.type == "재식주수"){
				var body = $("#plants_body");
				var add_list = "";
				
				var plants = data2.content.split(",");
				for(var i = 0; i < plants.length; i++){
					add_list += '<tr class="plants_tr">';
					add_list += '<td class="plants_name">'+plants[i]+'</td>';
					add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusPlants(this);">삭제</button></td>';
					add_list += '</tr>';
				}
				
				body.append(add_list);
			}//end if
		}else if(index == 3){
			if(Object.keys(data3).length != 0 && data3.type == "재식주수"){
				var body = $("#plants_body");
				var add_list = "";
				
				var plants = data3.content.split(",");
				for(var i = 0; i < plants.length; i++){
					add_list += '<tr class="plants_tr">';
					add_list += '<td class="plants_name">'+plants[i]+'</td>';
					add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusPlants(this);">삭제</button></td>';
					add_list += '</tr>';
				}
				
				body.append(add_list);
			}//end if
		}
		
		var plantsModalUseBtn = $("#usePlants");
		plantsModalUseBtn.attr('th:data-index', index);
	}
	
	//재식주수 수준 추가 버튼 이벤트
	function PlusPlants(){
		var plants = $("#plants_text").val();
		
		var body = $("#plants_body");
		var add_list = "";
		
		add_list += '<tr class="plants_tr">';
		add_list += '<td class="plants_name">'+plants+'</td>';
		add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusPlants(this);">삭제</button></td>';
		add_list += '</tr>';
		
		body.append(add_list);
	}//end 재식주수 수준 추가 버튼 이벤트
	
	//재식주수 수준 삭제 버튼 이벤트
	function MinusPlants(e){
		
		var del_div = $(e).parent().parent();
		del_div.remove();
	}//end 재식주수 수준 삭제
	
	//재식주수 요인 사용 클릭 이벤트
	$("#usePlants").on("click", function(){
		
		var index = $("#usePlants").attr("th:data-index");
		var type = "재식주수";
		var content = "";
		var text = "";
		
		var length = $(document).find(".plants_tr").length;
		
		$(document).find(".plants_tr").each(function(i, item){
			if(i == (length-1)){
				content += $(this).find(".plants_name").text();
				text += $(this).find(".plants_name").text();
			}else{
				content += $(this).find(".plants_name").text()+',';
				text += $(this).find(".plants_name").text()+',';
			}
		});
		
		if(index == 1){
			data1.type = type;
			data1.content = content;
			data1.type1 = "factor_plants";
			$("#text_inner1").text(text);
		}else if(index == 2){
			data2.type = type;
			data2.content = content;
			data2.type1 = "factor_plants";
			$("#text_inner2").text(text);
		}else if(index == 3){
			data3.type = type;
			data3.content = content;
			data3.type1 = "factor_plants";
			$("#text_inner3").text(text);
		}
		
		$("#plantsModal").modal("hide");
		
		
	});
	
	//파종량 함수
	function getAmountList(index){
		$("#amountModal").modal("show");
		
		
		//파종량 입력창 초기회
		$("#amount_text").val("");
		$("#amount_body").empty();
		
		if(index == 1){
			if(Object.keys(data1).length != 0 && data1.type == "파종량"){
				var body = $("#amount_body");
				var add_list = "";
				
				var amounts = data1.content.split(",");
				for(var i = 0; i < amounts.length; i++){
					add_list += '<tr class="amount_tr">';
					add_list += '<td class="amount_name">'+amounts[i]+'</td>';
					add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusAmount(this);">삭제</button></td>';
					add_list += '</tr>';
				}
				
				body.append(add_list);
			}
		}else if(index == 2){
			if(Object.keys(data2).length != 0 && data2.type == "파종량"){
				var body = $("#amount_body");
				var add_list = "";
				
				var amounts = data2.content.split(",");
				for(var i = 0; i < amounts.length; i++){
					add_list += '<tr class="amount_tr">';
					add_list += '<td class="amount_name">'+amounts[i]+'</td>';
					add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusAmount(this);">삭제</button></td>';
					add_list += '</tr>';
				}
				
				body.append(add_list);
			}
		}else if(index == 3){
			if(Object.keys(data3).length != 0 && data3.type == "파종량"){
				var body = $("#amount_body");
				var add_list = "";
				
				var amounts = data3.content.split(",");
				for(var i = 0; i < amounts.length; i++){
					add_list += '<tr class="amount_tr">';
					add_list += '<td class="amount_name">'+amounts[i]+'</td>';
					add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusAmount(this);">삭제</button></td>';
					add_list += '</tr>';
				}
				
				body.append(add_list);
			}
		}
		
		var amountModalUseBtn = $("#useAmount");
		amountModalUseBtn.attr('th:data-index', index);
	}//end 파종량 함수
	
	//파종량 수준 추가 버튼 이벤트
	function PlusAmount(){
		var plants = $("#amount_text").val();
		
		var body = $("#amount_body");
		var add_list = "";
		
		add_list += '<tr class="amount_tr">';
		add_list += '<td class="amount_name">'+plants+'</td>';
		add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusAmount(this);">삭제</button></td>';
		add_list += '</tr>';
		
		body.append(add_list);
	}//end 파종량 수준 추가 버튼 이벤트
	
	//파종량 수준 삭제 버튼 이벤트
	function MinusAmount(e){
		
		var del_div = $(e).parent().parent();
		del_div.remove();
	}//end 파종량 수준 삭제
	
	//파종량 요인사용 버튼 클릭 이벤트
	$("#useAmount").on("click", function(){
		
		var index = $("#useAmount").attr("th:data-index");
		var type = "파종량";
		var content = "";
		var text = "";
		
		var length = $(document).find(".amount_tr").length;
		
		$(document).find(".amount_tr").each(function(i, item){
			if(i == (length-1)){
				content += $(this).find(".amount_name").text();
				text += $(this).find(".amount_name").text();
			}else{
				content += $(this).find(".amount_name").text()+',';
				text += $(this).find(".amount_name").text()+',';
			}
		});
		
		if(index == 1){
			data1.type = type;
			data1.content = content;
			data1.type1 = "factor_amount";
			$("#text_inner1").text(text);
		}else if(index == 2){
			data2.type = type;
			data2.content = content;
			data2.type1 = "factor_amount";
			$("#text_inner2").text(text);
		}else if(index == 3){
			data3.type = type;
			data3.content = content;
			data3.type1 = "factor_amount";
			$("#text_inner3").text(text);
		}
		
		$("#amountModal").modal("hide");
	});//end 파종량 요인사용 버튼 클릭 이벤트
	
	//시비량 함수
	function getManureList(index){
		$("#manureModal").modal("show");
		
		//시비량 모달 비워주기
		$("#manure_area").val("");
		$("#fert_1").val(0).attr("selected", true);
		$("#fert_2").val(0).attr("selected", true);
		$("#manure_amount").val("");
		$("#manure_percent").val("");
		$("#manure_result").val("");
		$("#copy_form_table").empty();
		
		//선택한 데이터가 있는지 확인 후 모달 내용 변경
		if(index == 1){
			if(Object.keys(manureArray1).length != 0){
				
				var copy_form_table = $("#copy_form_table");
				var str = "";
				var str_inner1 = "";
				var str_inner2 = "";
				var str_inner3 = "";
				
				//수준 별 inner 내용 담기
				for(var i = 0; i < manureArray1.length; i++){
					if(manureArray1[i].manure_level == 1){
						str_inner1 += '<tr class="manure_tr">';
						str_inner1 += '<td class="manure_area">'+manureArray1[i].manure_area+'</td>';
						str_inner1 += '<td class="manure_type" th:data-type="'+manureArray1[i].manure_ingredient+'" th:data-fert-id="'+manureArray1[i].fert_id+'">'+manureArray1[i].manure_type+'</td>';
						str_inner1 += '<td class="manure_amount">'+manureArray1[i].manure_amount+'</td>';
						str_inner1 += '<td class="manure_percent">'+manureArray1[i].manure_percent+'</td>';
						str_inner1 += '<td class="manure_result">'+manureArray1[i].manure_result+'</td>';
						str_inner1 += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusManure(this);"><span class="minus"></span></button></td>';
						str_inner1 += '</tr>';
					}else if(manureArray1[i].manure_level == 2){
						str_inner2 += '<tr class="manure_tr">';
						str_inner2 += '<td class="manure_area">'+manureArray1[i].manure_area+'</td>';
						str_inner2 += '<td class="manure_type" th:data-type="'+manureArray1[i].manure_ingredient+'" th:data-fert-id="'+manureArray1[i].fert_id+'">'+manureArray1[i].manure_type+'</td>';
						str_inner2 += '<td class="manure_amount">'+manureArray1[i].manure_amount+'</td>';
						str_inner2 += '<td class="manure_percent">'+manureArray1[i].manure_percent+'</td>';
						str_inner2 += '<td class="manure_result">'+manureArray1[i].manure_result+'</td>';
						str_inner2 += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusManure(this);"><span class="minus"></span></button></td>';
						str_inner2 += '</tr>';
					}else if(manureArray1[i].manure_level == 3){
						str_inner3 += '<tr class="manure_tr">';
						str_inner3 += '<td class="manure_area">'+manureArray1[i].manure_area+'</td>';
						str_inner3 += '<td class="manure_type" th:data-type="'+manureArray1[i].manure_ingredient+'" th:data-fert-id="'+manureArray1[i].fert_id+'">'+manureArray1[i].manure_type+'</td>';
						str_inner3 += '<td class="manure_amount">'+manureArray1[i].manure_amount+'</td>';
						str_inner3 += '<td class="manure_percent">'+manureArray1[i].manure_percent+'</td>';
						str_inner3 += '<td class="manure_result">'+manureArray1[i].manure_result+'</td>';
						str_inner3 += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusManure(this);"><span class="minus"></span></button></td>';
						str_inner3 += '</tr>';
					}
				}//end for
				
				//각 manure 수준 array에 담기
				var check_level = "";
				var check_length = manureArray1.length;
				for(var i = 0; i < check_length; i++){
					check_level += manureArray1[i].manure_level+",";
				}//end for
				
				//수준 배열 중복 제거
				var check_level_array = check_level.slice(0, -1).split(",");
				var array_set = Array.from(new Set(check_level_array));
				
				//수준 배열만큼 실제 manure 내용 그려주기
				for(var i = 0; i < array_set.length; i++){
					if(array_set[i] == 1){
						str += '<div class="col-lg-12 copy-form-standard">';
						str += '<div class="level" th:data-level="'+1+'">수준 1</div>';
						str += '<div class="table-responsive">';
						str += '<table class="table">';
						str += '<thead>';
						str += '<tr style="text-align: center;">';
						str += '<th>비료성분</th>';
						str += '<th>비료종류</th>';
						str += '<th>시비량(kg/10a)</th>';
						str += '<th>성분량(%)</th>';
						str += '<th>값(kg)</th>';
						str += '<th></th>';
						str += '</tr>';
						str += '</thead>';
						str += '<tbody id="manure_body">';
						str += str_inner1;
						str += '</tbody>';
						str += '</table>';
						str += '</div>';
						str += '</div>';
						str += '</div>';
					}else if(array_set[i] == 2){
						str += '<div class="col-lg-12 copy-form-standard">';
						str += '<div class="level" th:data-level="'+2+'">수준 2</div>';
						str += '<div class="table-responsive">';
						str += '<table class="table">';
						str += '<thead>';
						str += '<tr style="text-align: center;">';
						str += '<th>비료성분</th>';
						str += '<th>비료종류</th>';
						str += '<th>시비량(kg/10a)</th>';
						str += '<th>성분량(%)</th>';
						str += '<th>값(kg)</th>';
						str += '<th></th>';
						str += '</tr>';
						str += '</thead>';
						str += '<tbody id="manure_body">';
						str += str_inner2;
						str += '</tbody>';
						str += '</table>';
						str += '</div>';
						str += '</div>';
						str += '</div>';
					}else if(array_set[i] == 3){
						str += '<div class="col-lg-12 copy-form-standard">';
						str += '<div class="level" th:data-level="'+3+'">수준 3</div>';
						str += '<div class="table-responsive">';
						str += '<table class="table">';
						str += '<thead>';
						str += '<tr style="text-align: center;">';
						str += '<th>비료성분</th>';
						str += '<th>비료종류</th>';
						str += '<th>시비량(kg/10a)</th>';
						str += '<th>성분량(%)</th>';
						str += '<th>값(kg)</th>';
						str += '<th></th>';
						str += '</tr>';
						str += '</thead>';
						str += '<tbody id="manure_body">';
						str += str_inner3;
						str += '</tbody>';
						str += '</table>';
						str += '</div>';
						str += '</div>';
						str += '</div>';
					}
				}//end for
				copy_form_table.append(str);
			}//end if
		}else if(index == 2){
			if(Object.keys(manureArray2).length != 0){
				
				var copy_form_table = $("#copy_form_table");
				var str = "";
				var str_inner1 = "";
				var str_inner2 = "";
				var str_inner3 = "";
				
				//수준 별 inner 내용 담기
				for(var i = 0; i < manureArray2.length; i++){
					if(manureArray2[i].manure_level == 1){
						str_inner1 += '<tr class="manure_tr">';
						str_inner1 += '<td class="manure_area">'+manureArray2[i].manure_area+'</td>';
						str_inner1 += '<td class="manure_type" th:data-type="'+manureArray2[i].manure_ingredient+'" th:data-fert-id="'+manureArray2[i].fert_id+'">'+manureArray2[i].manure_type+'</td>';
						str_inner1 += '<td class="manure_amount">'+manureArray2[i].manure_amount+'</td>';
						str_inner1 += '<td class="manure_percent">'+manureArray2[i].manure_percent+'</td>';
						str_inner1 += '<td class="manure_result">'+manureArray2[i].manure_result+'</td>';
						str_inner1 += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusManure(this);"><span class="minus"></span></button></td>';
						str_inner1 += '</tr>';
					}else if(manureArray2[i].manure_level == 2){
						str_inner2 += '<tr class="manure_tr">';
						str_inner2 += '<td class="manure_area">'+manureArray2[i].manure_area+'</td>';
						str_inner2 += '<td class="manure_type" th:data-type="'+manureArray2[i].manure_ingredient+'" th:data-fert-id="'+manureArray2[i].fert_id+'">'+manureArray2[i].manure_type+'</td>';
						str_inner2 += '<td class="manure_amount">'+manureArray2[i].manure_amount+'</td>';
						str_inner2 += '<td class="manure_percent">'+manureArray2[i].manure_percent+'</td>';
						str_inner2 += '<td class="manure_result">'+manureArray2[i].manure_result+'</td>';
						str_inner2 += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusManure(this);"><span class="minus"></span></button></td>';
						str_inner2 += '</tr>';
					}else if(manureArray2[i].manure_level == 3){
						str_inner3 += '<tr class="manure_tr">';
						str_inner3 += '<td class="manure_area">'+manureArray2[i].manure_area+'</td>';
						str_inner3 += '<td class="manure_type" th:data-type="'+manureArray2[i].manure_ingredient+'" th:data-fert-id="'+manureArray2[i].fert_id+'">'+manureArray2[i].manure_type+'</td>';
						str_inner3 += '<td class="manure_amount">'+manureArray2[i].manure_amount+'</td>';
						str_inner3 += '<td class="manure_percent">'+manureArray2[i].manure_percent+'</td>';
						str_inner3 += '<td class="manure_result">'+manureArray2[i].manure_result+'</td>';
						str_inner3 += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusManure(this);"><span class="minus"></span></button></td>';
						str_inner3 += '</tr>';
					}
				}//end for
				
				//각 manure 수준 array에 담기
				var check_level = "";
				var check_length = manureArray2.length;
				for(var i = 0; i < check_length; i++){
					check_level += manureArray2[i].manure_level+",";
				}//end for
				
				//수준 배열 중복 제거
				var check_level_array = check_level.slice(0, -1).split(",");
				var array_set = Array.from(new Set(check_level_array));
				
				//수준 배열만큼 실제 manure 내용 그려주기
				for(var i = 0; i < array_set.length; i++){
					if(array_set[i] == 1){
						str += '<div class="col-lg-12 copy-form-standard">';
						str += '<div class="level" th:data-level="'+1+'">수준 1</div>';
						str += '<div class="table-responsive">';
						str += '<table class="table">';
						str += '<thead>';
						str += '<tr style="text-align: center;">';
						str += '<th>비료성분</th>';
						str += '<th>비료종류</th>';
						str += '<th>시비량(kg/10a)</th>';
						str += '<th>성분량(%)</th>';
						str += '<th>값(kg)</th>';
						str += '<th></th>';
						str += '</tr>';
						str += '</thead>';
						str += '<tbody id="manure_body">';
						str += str_inner1;
						str += '</tbody>';
						str += '</table>';
						str += '</div>';
						str += '</div>';
						str += '</div>';
					}else if(array_set[i] == 2){
						str += '<div class="col-lg-12 copy-form-standard">';
						str += '<div class="level" th:data-level="'+2+'">수준 2</div>';
						str += '<div class="table-responsive">';
						str += '<table class="table">';
						str += '<thead>';
						str += '<tr style="text-align: center;">';
						str += '<th>비료성분</th>';
						str += '<th>비료종류</th>';
						str += '<th>시비량(kg/10a)</th>';
						str += '<th>성분량(%)</th>';
						str += '<th>값(kg)</th>';
						str += '<th></th>';
						str += '</tr>';
						str += '</thead>';
						str += '<tbody id="manure_body">';
						str += str_inner2;
						str += '</tbody>';
						str += '</table>';
						str += '</div>';
						str += '</div>';
						str += '</div>';
					}else if(array_set[i] == 3){
						str += '<div class="col-lg-12 copy-form-standard">';
						str += '<div class="level" th:data-level="'+3+'">수준 3</div>';
						str += '<div class="table-responsive">';
						str += '<table class="table">';
						str += '<thead>';
						str += '<tr style="text-align: center;">';
						str += '<th>비료성분</th>';
						str += '<th>비료종류</th>';
						str += '<th>시비량(kg/10a)</th>';
						str += '<th>성분량(%)</th>';
						str += '<th>값(kg)</th>';
						str += '<th></th>';
						str += '</tr>';
						str += '</thead>';
						str += '<tbody id="manure_body">';
						str += str_inner3;
						str += '</tbody>';
						str += '</table>';
						str += '</div>';
						str += '</div>';
						str += '</div>';
					}
				}//end for
				copy_form_table.append(str);
			}//end if
		}else if(index == 3){
			if(Object.keys(manureArray3).length != 0){
				
				var copy_form_table = $("#copy_form_table");
				var str = "";
				var str_inner1 = "";
				var str_inner2 = "";
				var str_inner3 = "";
				
				//수준 별 inner 내용 담기
				for(var i = 0; i < manureArray3.length; i++){
					if(manureArray3[i].manure_level == 1){
						str_inner1 += '<tr class="manure_tr">';
						str_inner1 += '<td class="manure_area">'+manureArray3[i].manure_area+'</td>';
						str_inner1 += '<td class="manure_type" th:data-type="'+manureArray3[i].manure_ingredient+'" th:data-fert-id="'+manureArray3[i].fert_id+'">'+manureArray3[i].manure_type+'</td>';
						str_inner1 += '<td class="manure_amount">'+manureArray3[i].manure_amount+'</td>';
						str_inner1 += '<td class="manure_percent">'+manureArray3[i].manure_percent+'</td>';
						str_inner1 += '<td class="manure_result">'+manureArray3[i].manure_result+'</td>';
						str_inner1 += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusManure(this);"><span class="minus"></span></button></td>';
						str_inner1 += '</tr>';
					}else if(manureArray3[i].manure_level == 2){
						str_inner2 += '<tr class="manure_tr">';
						str_inner2 += '<td class="manure_area">'+manureArray3[i].manure_area+'</td>';
						str_inner2 += '<td class="manure_type" th:data-type="'+manureArray3[i].manure_ingredient+'" th:data-fert-id="'+manureArray3[i].fert_id+'">'+manureArray3[i].manure_type+'</td>';
						str_inner2 += '<td class="manure_amount">'+manureArray3[i].manure_amount+'</td>';
						str_inner2 += '<td class="manure_percent">'+manureArray3[i].manure_percent+'</td>';
						str_inner2 += '<td class="manure_result">'+manureArray3[i].manure_result+'</td>';
						str_inner2 += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusManure(this);"><span class="minus"></span></button></td>';
						str_inner2 += '</tr>';
					}else if(manureArray3[i].manure_level == 3){
						str_inner3 += '<tr class="manure_tr">';
						str_inner3 += '<td class="manure_area">'+manureArray3[i].manure_area+'</td>';
						str_inner3 += '<td class="manure_type" th:data-type="'+manureArray3[i].manure_ingredient+'" th:data-fert-id="'+manureArray3[i].fert_id+'">'+manureArray3[i].manure_type+'</td>';
						str_inner3 += '<td class="manure_amount">'+manureArray3[i].manure_amount+'</td>';
						str_inner3 += '<td class="manure_percent">'+manureArray3[i].manure_percent+'</td>';
						str_inner3 += '<td class="manure_result">'+manureArray3[i].manure_result+'</td>';
						str_inner3 += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusManure(this);"><span class="minus"></span></button></td>';
						str_inner3 += '</tr>';
					}
				}//end for
				
				//각 manure 수준 array에 담기
				var check_level = "";
				var check_length = manureArray3.length;
				for(var i = 0; i < check_length; i++){
					check_level += manureArray3[i].manure_level+",";
				}//end for
				
				//수준 배열 중복 제거
				var check_level_array = check_level.slice(0, -1).split(",");
				var array_set = Array.from(new Set(check_level_array));
				
				//수준 배열만큼 실제 manure 내용 그려주기
				for(var i = 0; i < array_set.length; i++){
					if(array_set[i] == 1){
						str += '<div class="col-lg-12 copy-form-standard">';
						str += '<div class="level" th:data-level="'+1+'">수준 1</div>';
						str += '<div class="table-responsive">';
						str += '<table class="table">';
						str += '<thead>';
						str += '<tr style="text-align: center;">';
						str += '<th>비료성분</th>';
						str += '<th>비료종류</th>';
						str += '<th>시비량(kg/10a)</th>';
						str += '<th>성분량(%)</th>';
						str += '<th>값(kg)</th>';
						str += '<th></th>';
						str += '</tr>';
						str += '</thead>';
						str += '<tbody id="manure_body">';
						str += str_inner1;
						str += '</tbody>';
						str += '</table>';
						str += '</div>';
						str += '</div>';
						str += '</div>';
					}else if(array_set[i] == 2){
						str += '<div class="col-lg-12 copy-form-standard">';
						str += '<div class="level" th:data-level="'+2+'">수준 2</div>';
						str += '<div class="table-responsive">';
						str += '<table class="table">';
						str += '<thead>';
						str += '<tr style="text-align: center;">';
						str += '<th>비료성분</th>';
						str += '<th>비료종류</th>';
						str += '<th>시비량(kg/10a)</th>';
						str += '<th>성분량(%)</th>';
						str += '<th>값(kg)</th>';
						str += '<th></th>';
						str += '</tr>';
						str += '</thead>';
						str += '<tbody id="manure_body">';
						str += str_inner2;
						str += '</tbody>';
						str += '</table>';
						str += '</div>';
						str += '</div>';
						str += '</div>';
					}else if(array_set[i] == 3){
						str += '<div class="col-lg-12 copy-form-standard">';
						str += '<div class="level" th:data-level="'+3+'">수준 3</div>';
						str += '<div class="table-responsive">';
						str += '<table class="table">';
						str += '<thead>';
						str += '<tr style="text-align: center;">';
						str += '<th>비료성분</th>';
						str += '<th>비료종류</th>';
						str += '<th>시비량(kg/10a)</th>';
						str += '<th>성분량(%)</th>';
						str += '<th>값(kg)</th>';
						str += '<th></th>';
						str += '</tr>';
						str += '</thead>';
						str += '<tbody id="manure_body">';
						str += str_inner3;
						str += '</tbody>';
						str += '</table>';
						str += '</div>';
						str += '</div>';
						str += '</div>';
					}
				}//end for
				copy_form_table.append(str);
			}//end if
		}
		
		//추가 버튼 비활성화
		$("#plusManure").attr("disabled", true);
		
		var manureModalUseBtn = $("#useManure");
		manureModalUseBtn.attr('th:data-index', index);
	}//end 시비량 함수
	
	//시비량 모달 내 비료 성분 체인지 이벤트
	$("#fert_1").on("change", function(){
		
		var fert_id = $(this).find("option:selected").val();
		
		if(fert_id == "etc"){
			var fert_2 = $("#fert_2");
			var add_list = "";
			add_list += '<option value="etc">기타(직접입력)</option>';
			fert_2.empty();
			fert_2.append(add_list);
			
			$("#etc_row").css("display", "");
			
		}else{
			$("#etc_row").css("display", "none");
			
			var data = {"fert_id" : fert_id};
			
			$.ajax({
				url : "/plan/selectFertilizer",
				method : "GET",
				dataType : 'json',
				data : data,
				success : function(result){
					
					var fert_2 = $("#fert_2");
					var add_list = "";
					
					add_list = '<option value="0">비료종류 선택</option>';
					
					for(var i = 0; i < result.length; i++){
						add_list += '<option value="' + result[i].fert_id + '" th:data-amount="'+result[i].fert_amount+'">' + result[i].fertilizer + '(' + result[i].fert_amount + '%' + ')' + '</option>';
					}
					
					fert_2.empty();
					fert_2.append(add_list);
				}//end success
			});//end ajax
		}
		
	});//시비량 모달 내 비료 성분 체인지 이벤트
	
	//시비량 모달 내 비료 종류 선택 이벤트
	$(document).on("change", "#fert_2", function(){
		
		var fert_id = $(this).find("option:selected").val();
		if(fert_id != "0"){
			var amount = $(this).find("option:selected").attr("th:data-amount");
			$("#manure_percent").val(amount);
			
			var manure_area = $("#manure_area").val();
			var manure_amount = $("#manure_amount").val();
			var manure_percent = amount;
			
			//시비량 값 계산
			if(manure_area != "" && manure_amount != "" && manure_percent != ""){
				var num = manure_area / 1000 * manure_amount * 100 / manure_percent;
				
				var result = num.toFixed(2);
				
				$("#manure_result").val(result);
				$("#plusManure").attr("disabled", false);
			}else{
				$("#manure_result").val("");
				$("#plusManure").attr("disabled", true);
			}
		}
		
	});
	
	//시비량 값 계산 함수
	$("#manure-form input").on("change", function(){
		var manure_area = $("#manure_area").val();
		var manure_amount = $("#manure_amount").val();
		var manure_percent = $("#manure_percent").val();
		
		
		if(manure_area != "" && manure_amount != "" && manure_percent != ""){
			var num = manure_area / 1000 * manure_amount * 100 / manure_percent;
			
			var result = num.toFixed(2);
			
			$("#manure_result").val(result);
			$("#plusManure").attr("disabled", false);
		}else {
			$("#manure_result").val("");
			$("#plusManure").attr("disabled", true);
		}
		
	});//end 시비량 값 계산 함수
	
	//시비량 추가 버튼 이벤트
	function PlusManure(){
		
		var fert_id = $("#fert_1").find("option:selected").val();
		
		if(fert_id == "etc" ){
			
			if($("#manure_etc1").val() == "" || $("#manure_etc2").val() == ""){
				alert("비료성분/종류를 입력해 주세요.");
			}else{
				
				fert_id = 0;
				var manure_area = $("#manure_area").val();
				var manure_type = $("#manure_etc2").val();
				var type = $("#manure_etc1").val();
				var manure_amount = $("#manure_amount").val();
				var manure_percent = $("#manure_percent").val();
				var manure_result = $("#manure_result").val();
				
				var body = $("#manure_body");
				var add_list = "";
				
				add_list += '<tr class="manure_tr">';
				add_list += '<td class="manure_area">'+manure_area+'</td>';
				add_list += '<td class="manure_type" th:data-type="'+type+'" th:data-fert-id="'+fert_id+'">'+manure_type+'</td>';
				add_list += '<td class="manure_amount">'+manure_amount+'</td>';
				add_list += '<td class="manure_percent">'+manure_percent+'</td>';
				add_list += '<td class="manure_result">'+manure_result+'</td>';
				add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusManure(this);"><span class="minus"></span></button></td>';
				add_list += '</tr>';
				
				body.append(add_list);
			}
			
		}else{
			
			var manure_area = $("#manure_area").val();
			var manure_type = $("#fert_2").find("option:selected").text();
			
			var type = $("#fert_1").find("option:selected").text();
			var manure_amount = $("#manure_amount").val();
			var manure_percent = $("#manure_percent").val();
			var manure_result = $("#manure_result").val();
			
			var body = $("#manure_body");
			var add_list = "";
			
			add_list += '<tr class="manure_tr">';
			add_list += '<td class="manure_area">'+manure_area+'</td>';
			add_list += '<td class="manure_type" th:data-type="'+type+'" th:data-fert-id="'+fert_id+'">'+manure_type+'</td>';
			add_list += '<td class="manure_amount">'+manure_amount+'</td>';
			add_list += '<td class="manure_percent">'+manure_percent+'</td>';
			add_list += '<td class="manure_result">'+manure_result+'</td>';
			add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusManure(this);"><span class="minus"></span></button></td>';
			add_list += '</tr>';
			
			body.append(add_list);
		}
		
		
	}//end 시비량 추가 버튼 이벤트
	
	//시비량 삭제 버튼 이벤트
	function MinusManure(e){
		
		var length = $(e).parent().parent().parent().find(".manure_tr").length;
		var check = $(e).parent().parent().parent().parent().parent().parent().hasClass("copy-form-standard");
		var del_div = $(e).parent().parent();
		
		if(check){
			if(length == 1){
				$(e).parent().parent().parent().parent().parent().parent().remove();
				$(document).find(".level").each(function(i, index){
					$(this).text("수준 " +(i+1));
				});
			}else{
				del_div.remove();
			}
		}else{
			del_div.remove();
		}
		
		
	}//end 시비량삭제
	
	//시비량 수준 추가 이벤트
	function PlusManureLevel(){
		
		var copy_form = $("#copy_form");
		var copy_form_table = $("#copy_form_table");
		var copy_form_inner = $("#copy_form").children(":first").html();
		
		var length = $("#copy_form_table").children().length;
		
		var str = "";
		str += '<div class="col-lg-12 copy-form-standard">';
		str += '<div class="level" th:data-level="'+(length+1)+'">수준 '+(length+1)+'</div>';
		str += copy_form_inner;
		str += '</div>';
		str += '</div>';
		
		copy_form_table.append(str);
		$("#copy_form").find(".manure_tr").remove();
		
	}//end 시비량 수준 추가 이벤트
	
	//시비량 요인사용 버튼 이벤트
	$("#useManure").on("click", function(){
		
		var index = $("#useManure").attr("th:data-index");
		var type = "시비량";
		var content = "";
		var text = "";
		var level = "";
		
		var length1 = $(document).find(".copy-form-standard").length;
		
		$(document).find(".copy-form-standard").each(function(i, item){
			
			content += '수준 ' + (i+1);
			
			if(i == 0){
				text += '수준 ' + (i+1);
				text += ' => ';
			}else{
				text += '<br>수준 ' + (i+1);
				text += ' => ';
			}
			
			
			if(i == (length1-1)){
				level += '수준'+(i+1)+'(시)';
			}else{
				level += '수준'+(i+1)+'(시),';
			}
			
			var length = $(this).find(".manure_tr").length;
			
			$(this).find(".manure_tr").each(function(i, item){
				var manure_result = $(this).find(".manure_result").text();
				var type = $(this).find(".manure_type").attr("th:data-type");
				
				if(i == (length-1)){
					content += ' ' + manure_result + 'kg/10a(' + type + ')' + '값(kg)';
					text += ' ' + manure_result + 'kg/10a(' + type + ')' + '값(kg)';
				}else{
					content += ' ' + manure_result + 'kg/10a(' + type + ')' + '값(kg),';
					text += ' ' + manure_result + 'kg/10a(' + type + ')' + '값(kg),';
				}
				
				var data = {
						"fert_id" : $(this).find(".manure_type").attr("th:data-fert-id"),
						"manure_area" : $(this).find(".manure_area").text(),
						"manure_ingredient" : $(this).find(".manure_type").attr("th:data-type"),
						"manure_type" : $(this).find(".manure_type").text(),
						"manure_amount" : $(this).find(".manure_amount").text(),
						"manure_percent" : $(this).find(".manure_percent").text(),
						"manure_result" : $(this).find(".manure_result").text(),
						"manure_level" : $(this).parent().parent().parent().parent().find(".level").attr("th:data-level")
				}
				
				manureArray.push(data);
				
			});//end ,manure_te each
			
		});//end copy-form-standard each
		console.log(manureArray);
		if(index == 1){
			manureArray1 = [];
			data1.type = type;
			data1.content = content;
			data1.level = level;
			data1.type1 = "manure_id";
			for(var i = 0; i < manureArray.length; i++){
				manureArray1.push(manureArray[i]);
			}
			manureArray = [];
			$("#text_inner1").html(text);
		}else if(index == 2){
			manureArray2 = [];
			data2.type = type;
			data2.content = content;
			data2.level = level;
			data2.type1 = "manure_id";
			for(var i = 0; i < manureArray.length; i++){
				manureArray2.push(manureArray[i]);
			}
			manureArray = [];
			$("#text_inner2").html(text);
		}else if(index == 3){
			manureArray3 = [];
			data3.type = type;
			data3.content = content;
			data3.level = level;
			data3.type1 = "manure_id";
			for(var i = 0; i < manureArray.length; i++){
				manureArray3.push(manureArray[i]);
			}
			manureArray = [];
			$("#text_inner3").html(text);
		}
		
		$("#manureModal").modal("hide");
		
	});//end 시비량 요인사용 버튼 이벤트
	
	
	//기타 함수
	function getEtcList(index){
		$("#etcModal").modal("show");
		
		//기타 양식 초기화
		$("#etc_type").val("none").attr("selected", true);
		$("#etc_value").val("");
		$("#etc_comment").val("");
		$("#etc_body").empty();
		
		var body = $("#etc_body");
		var add_list = "";
		
		if(index == 1){
			if(Object.keys(etcArray1).length != 0){
				for(var i = 0; i < etcArray1.length; i++){
					add_list += '<tr class="etc_tr">';
					add_list += '<td class="etc_type">'+etcArray1[i].etc_type+'</td>';
					add_list += '<td class="etc_value">'+etcArray1[i].etc_value+'</td>';
					add_list += '<td class="etc_comment">'+etcArray1[i].etc_comment+'</td>';
					add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusEtc(this);">삭제</button></td>';
					add_list += '</tr>';
				}
				body.append(add_list);
			}//end if
		}else if(index == 2){
			if(Object.keys(etcArray2).length != 0){
				for(var i = 0; i < etcArray2.length; i++){
					add_list += '<tr class="etc_tr">';
					add_list += '<td class="etc_type">'+etcArray2[i].etc_type+'</td>';
					add_list += '<td class="etc_value">'+etcArray2[i].etc_value+'</td>';
					add_list += '<td class="etc_comment">'+etcArray2[i].etc_comment+'</td>';
					add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusEtc(this);">삭제</button></td>';
					add_list += '</tr>';
				}
				body.append(add_list);
			}//end if
		}else if(index == 3){
			if(Object.keys(etcArray3).length != 0){
				for(var i = 0; i < etcArray3.length; i++){
					add_list += '<tr class="etc_tr">';
					add_list += '<td class="etc_type">'+etcArray3[i].etc_type+'</td>';
					add_list += '<td class="etc_value">'+etcArray3[i].etc_value+'</td>';
					add_list += '<td class="etc_comment">'+etcArray3[i].etc_comment+'</td>';
					add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusEtc(this);">삭제</button></td>';
					add_list += '</tr>';
				}
				body.append(add_list);
			}//end if
		}
			
		var etcModalUseBtn = $("#useEtc");
		etcModalUseBtn.attr('th:data-index', index);
		
	}//emd 재식거리 함수
	
	//기타 수준 추가 버튼 이벤트
	function PlusEtc(){
		var etc_type = $("#etc_type option:selected").val();
		var etc_value = $("#etc_value").val();
		var etc_comment = $("#etc_comment").val();
		
		var body = $("#etc_body");
		var add_list = "";
		
		add_list += '<tr class="etc_tr">';
		add_list += '<td class="etc_type">'+etc_type+'</td>';
		add_list += '<td class="etc_value">'+etc_value+'</td>';
		add_list += '<td class="etc_comment">'+etc_comment+'</td>';
		add_list += '<td><button type="button" class="btn btn-sm btn-danger" onclick="MinusEtc(this);">삭제</button></td>';
		add_list += '</tr>';
		
		body.append(add_list);
	}//end 기타 수준 추가 버튼 이벤트
	
	//기타 수준 삭제 버튼 이벤트
	function MinusEtc(e){
		
		var del_div = $(e).parent().parent();
		del_div.remove();
	}//end 기타 수준 삭제
	
	//기타 요인 사용 버튼 이벤트
	$("#useEtc").on("click", function(){
		var index = $("#useEtc").attr("th:data-index");
		var type = "기타";
		var content = "";
		var text = "";
		
		var length = $(document).find(".etc_tr").length;
		
		$(document).find(".etc_tr").each(function(i, item){
			
			var etc_value = $(this).find(".etc_value").text();
			var etc_type = $(this).find(".etc_type").text();
			
			if(i == (length-1)){
				content += etc_value + '(' + etc_type + ')';
				text += etc_value + '(' + etc_type + ')';
			}else{
				content += etc_value + '(' + etc_type + '),';
				text += etc_value + '(' + etc_type + '),';
			}
			
			var data = {
					"etc_type" : $(this).find(".etc_type").text(),
					"etc_value" : $(this).find(".etc_value").text(),
					"etc_comment" : $(this).find(".etc_comment").text()
			}
			
			etcArray.push(data);
			
		});
		
		
		if(index == 1){
			etcArray1 = [];
			data1.type = type;
			data1.content = content;
			data1.type1 = "etc_id";
			for(var i = 0; i < etcArray.length; i++){
				etcArray1.push(etcArray[i]);
			}
			etcArray = [];
			$("#text_inner1").text(text);
		}else if(index == 2){
			etcArray2 = [];
			data2.type = type;
			data2.content = content;
			data2.type1 = "etc_id";
			for(var i = 0; i < etcArray.length; i++){
				etcArray2.push(etcArray[i]);
			}
			etcArray = [];
			$("#text_inner2").text(text);
		}else if(index == 3){
			etcArray3 = [];
			data3.type = type;
			data3.content = content;
			data3.type1 = "etc_id";
			for(var i = 0; i < etcArray.length; i++){
				etcArray3.push(etcArray[i]);
			}
			etcArray = [];
			$("#text_inner3").text(text);
		}
		
		$("#etcModal").modal("hide");
	});//end 기타 요인 사용 버튼 이벤트
	
	//step3 btn 이벤트
	$("#step-3-btn").on("click", function(){
		
		var grow_type = $("#grow_type option:selected").val();
		
		var check1 = Object.keys(data1).length == 0;
		var check2 = Object.keys(data2).length == 0;
		var check3 = Object.keys(data3).length == 0;
		
		if(grow_type == "none"){
			alert("시험구배치 종류를 선택해주세요");
			$("#grow_type").focus();
		}else if(check1 && check2 && check3){
				alert("요인을 최소 하나 이상 설정해주세요.");
		}else{
			
			$("#step4 .content").slideDown();
			$("#step4 .title").addClass("active");
			
			/* $("#copy-step-4-none").css("display", ""); */
			
			gridFactors();
		}
	    
	    
	});//step3 btn 이벤트
	var resultArray = new Array();
	var factorArray = new Array();
	
	function gridFactors(){
		resultArray = [];
		factorArray = [];
		var factor1 = "";
		var factor2 = "";
		var factor3 = "";
		
		if(Object.keys(data1).length != 0){
			if(data1.type == "시비량"){
				factor1 = data1.level.split(",");
			}else if(data1.type == "시험재료"){
				factor1 = data1.text.split(",");
			}else{
				factor1 = data1.content.split(",");
			}
		}
		if(Object.keys(data2).length != 0){
			if(data2.type == "시비량"){
				factor2 = data2.level.split(",");
			}else if(data2.type == "시험재료"){
				factor2 = data2.text.split(",");
			}else{
				factor2 = data2.content.split(",");
			}
		}
		if(Object.keys(data3).length != 0){
			if(data3.type == "시비량"){
				factor3 = data3.level.split(",");
			}else if(data3.type == "시험재료"){
				factor3 = data3.text.split(",");
			}else{
				factor3 = data3.content.split(",");
			}
		}
		
		var plan_repeat = $("#plan_repeat").val();
		
		var grow_type = $("#grow_type option:selected").val();
		
		//구획 id 만들기 위한 변수들
		var num = 0;
		var num1 = 0;
		var level = 0;
		var id = "";
		var id1 = "";
		var id2 = "";
		var type = "";
		var type2 = "";
		var type3 = "";
		var repeat = "";
		
		//factor null 유무에 따라 factorArray 만들어 주기
		if(factor1 != "" && factor2 == "" && factor3 == ""){
			for(var i = 0; i < factor1.length; i++){
				id = "A"+(i+1);
				type = factor1[i];
				num++;
				var number = num;
				
				var data = {"num" : number, "id" : id, "type" : type};
				factorArray.push(data);
				
				id = "";
				type = "";
			}
		}else if(factor1 != "" && factor2 != "" && factor3 == ""){
			for(var i = 0; i < factor1.length; i++){
				id = "A"+(i+1);
				type = factor1[i];
				
				for(var j = 0; j < factor2.length; j++){
					id2 = id;
					id2 = id2 + '-B' + (j+1);
					type2 = type;
					type2 = type2 + ',' + factor2[j];
					num++;
					var number = num;
					
					var data = {"num" : number, "id" : id2, "type" : type2};
					factorArray.push(data);
				}
				id = "";
				type = "";
			}
		}else if(factor1 != "" && factor2 != "" && factor3 != ""){
			for(var i = 0; i < factor1.length; i++){
				id = "A"+(i+1);
				type = factor1[i];
				
				for(var j = 0; j < factor2.length; j++){
					id2 = id;
					id2 = id2 + '-B' + (j+1);
					type2 = type;
					type2 = type2 + ',' + factor2[j];
					
					for(var k = 0; k < factor3.length; k++){
						num++;
						var number = num;
						id3 = id2;
						id3 = id3 + '-C'+(k+1);
						type3 = type2;
						type3 = type3 + ',' + factor3[k];
						
						var data = {"num" : number, "id" : id3, "type" : type3};
						factorArray.push(data);
					}//end for3
					
				}//end for2
				id = "";
				type = "";
			}//end for1
		}
		
		if(grow_type == "0"){ //완전임의배치법
			
			//만들어준 factorArray를 가지고 최종 resultArray 만들어 주기
			for(var i = 0; i < plan_repeat; i++){
				level++;
				for(var j = 0; j < factorArray.length; j++){
					num1++;
					var number = num1;
					var data = {"num" : number, "id" : factorArray[j].id+"-"+level, "type" : factorArray[j].type, "repeat" : i+1};
					
					resultArray.push(data);
				}
			}//end for
			
			//임의 임의배치 컴포넌트
			var copy_step_4 = $("#copy-step-4");
			add_list = "";
			
			add_list += '<table id="table2">';
			add_list += '<thead>';
			add_list += '<tr class="title">';
			add_list += '<th>구획번호</th>';
			add_list += '<th>구획 ID</th>';
			add_list += '<th>처리종류</th>';
			add_list += '<th>반복</th>';
			add_list += '<th>처리포장면적(㎡)</th>';
			add_list += '</tr>';
			add_list += '</thead>';
			add_list += '<tbody class="step4-container container1">';
			
			for(var i = 0; i < resultArray.length; i++){
				add_list += '<tr class="table_content">';
			    add_list += '<td class="table_num">'+resultArray[i].num+'</td>';
			    add_list += '<td>'+resultArray[i].id+'</td>';
			    add_list += '<td>'+resultArray[i].type+'</td>';
			    add_list += '<td>'+resultArray[i].repeat+'</td>';
			    add_list += '<td><input type="text" id="mil" class="seg_area" value="0"></td>';
			    add_list += '</tr>';
			}
			
			add_list += '</tbody>';
			add_list += '</table>';
			
			
			copy_step_4.empty();
			var start = performance.now();
			copy_step_4.append(add_list);
			var duration = performance.now() - start;
			
			$("#info_popup").css("display", "flex");
			setTimeout(function(){
				
				$(document).find(".container1").sortable({
					placeholder : "itemBoxHighlight",
					start : function(event, ui){
						
					},
					stop : function(event, ui){//해당 구획 이동 완료 후 정렬
						
						//아이디 정렬해주기 위한 idarr 만들기
	 					var idArr = new Array();
						for(var i = 0; i < resultArray.length; i++){
							idArr.push(resultArray[i].id);
						}
						
						var num = 1;
	 					var targetNum = parseInt(ui.item[0].children[0].innerText)-1;
	 					reorder(num, idArr);
	 					var moveNum = parseInt(ui.item[0].children[0].innerText)-1;
						
						//순서 바꿔주기
						let item = resultArray.splice(targetNum, 1);
						resultArray.splice(moveNum, 0, item[0]);
						
						//id와 구획번호 재정렬
						for(var i = 0; i < resultArray.length; i++){
							resultArray[i].num = (i+1);
							resultArray[i].id = idArr[i];
						}
						console.log(resultArray);
						var getDataArr = [...resultArray];
						getDataResult(getDataArr);
					}
				});//end sortable
				
				$("#info_popup").css("display", "none");
			}, (duration*1000));
			
		}else if(grow_type == "1"){ //난괴법
			
			//만들어준 factorArray를 가지고 최종 resultArray 만들어 주기
			for(var i = 0; i < plan_repeat; i++){
				level++;
				num1= 0;
				for(var j = 0; j < factorArray.length; j++){
					num1++;
					var number = num1;
					var data = {"num" : number, "id" : factorArray[j].id+"-"+level, "type" : factorArray[j].type, "repeat" : i+1};
					
					resultArray.push(data);
				}
			}//end for
			
			var copy_step_4 = $("#copy-step-4");
			
			add_list = "";
			var add_div = "";
			var result_div = "";
			
			for(var i = 0; i < plan_repeat; i++){
				
				add_list += '<div class="copy-title">집구 '+(i+1)+'</div>';
				add_list += '<table id="table2">';
				add_list += '<thead>';
				add_list += '<tr class="title">';
				add_list += '<th>구획번호</th>';
				add_list += '<th>구획 ID</th>';
				add_list += '<th>처리종류</th>';
				add_list += '<th>반복</th>';
				add_list += '<th>처리포장면적(㎡)</th>';
				add_list += '</tr>';
				add_list += '</thead>';
				add_list += '<tbody class="step4-container container'+(i+1)+'">';
				
				
				for(var j = 0; j < resultArray.length; j++){
					
					if(resultArray[j].repeat == (i+1)){
						add_list += '<tr class="table_content">';
					    add_list += '<td class="table_num">'+resultArray[j].num+'</td>';
					    add_list += '<td>'+resultArray[j].id+'</td>';
					    add_list += '<td>'+resultArray[j].type+'</td>';
					    add_list += '<td>'+resultArray[j].repeat+'</td>';
					    add_list += '<td><input type="text" id="mil" class="seg_area" value="0"></td>';
					    add_list += '</tr>';
					}
				}//end for2
				
				add_list += '</tbody>';
				add_list += '</table>';
				
				result_div += add_list;
				
				add_list = "";
			}//end for1
			
			copy_step_4.empty();
			var start = performance.now();
			copy_step_4.append(result_div);
			var duration = performance.now() - start;
			
			//end 난괴법 컴포넌트
			$("#info_popup").css("display", "flex");
			setTimeout(function(){
				//jquery sortable 적용
				for(var i = 0; i < plan_repeat; i++){
					$(document).find(".container"+(i+1)).sortable({
						placeholder : "itemBoxHighlight",
						start : function(event, ui){
							
						},
						stop : function(event, ui){//해당 구획 이동 완료 후 정렬
							
							//아이디 정렬해주기 위한 idarr 만들기
		 					var idArr = new Array();
							for(var i = 0; i < resultArray.length; i++){
								idArr.push(resultArray[i].id);
							}
							
							//해당 로우의 반복수
							var num = parseInt(ui.item[0].children[3].innerText);
							
							//해당 집구의 테이블 로우 개수
							var standardNum = $(".container1 .table_content").length;
							var checkNum = (num-1) * standardNum;
							
							var targetNum = parseInt(ui.item[0].children[0].innerText)-1+checkNum;
		 					reorder(num, idArr);
		 					var moveNum = parseInt(ui.item[0].children[0].innerText)-1+checkNum;

							let item = resultArray.splice(targetNum, 1);
							resultArray.splice(moveNum, 0, item[0]);
							var plusNum = 0;
							for(var i = checkNum; i < (checkNum+standardNum); i++){
								plusNum++;
								resultArray[i].num = plusNum;
								resultArray[i].id = idArr[i];
							}
							console.log(resultArray);
							var getDataArr = [...resultArray];
							getDataResult(getDataArr);
						}
					});//end sortable
				}
				$("#info_popup").css("display", "none");
			}, (duration*1000));
			
		}else if(grow_type == "2"){ //분할구배치법
			
			//만들어준 factorArray를 가지고 최종 resultArray 만들어 주기
			for(var i = 0; i < plan_repeat; i++){
				level++;
				num1 = 0;
				for(var j = 0; j < factorArray.length; j++){
					num1++;
					var number = num1;
					var data = {"num" : number, "id" : factorArray[j].id+"-"+level, "type" : factorArray[j].type, "repeat" : i+1};
					
					resultArray.push(data);
				}
			}//end for
			
			//분할구배치법에서 그룹 나눠줄 id array
			var arr = new Array();
			for(var i = 0; i < resultArray.length; i++){
				arr[i] = resultArray[i].id.split("-")[0];
			}
			var idArray = Array.from(new Set(arr));
			
			var copy_step_4 = $("#copy-step-4");
			
			add_list = "";
			var add_div = "";
			var result_div = "";
			
			for(var i = 0; i < plan_repeat; i++){
				
				add_list += '<div class="copy-title">집구 '+(i+1)+'</div>';
				add_list += '<table id="table2">';
				add_list += '<thead>';
				add_list += '<tr class="title">';
				add_list += '<th>구획번호</th>';
				add_list += '<th>구획 ID</th>';
				add_list += '<th>처리종류</th>';
				add_list += '<th>반복</th>';
				add_list += '<th>처리포장면적(㎡)</th>';
				add_list += '</tr>';
				add_list += '</thead>';
				add_list += '<tbody class="step4-container container'+(i+1)+'">';
				
				for(var j = 0; j < resultArray.length; j++){
					
					if(resultArray[j].repeat == (i+1)){
						var checkId = resultArray[j].id.split("-")[0];
						for(var k = 0; k < idArray.length; k++){
							if(checkId == idArray[k]){
								add_list += '<tr data-id="'+idArray[k]+'" class="table_content '+idArray[k]+'">';
							}
						}
					    add_list += '<td class="table_num">'+resultArray[j].num+'</td>';
					    add_list += '<td>'+resultArray[j].id+'</td>';
					    add_list += '<td>'+resultArray[j].type+'</td>';
					    add_list += '<td>'+resultArray[j].repeat+'</td>';
					    add_list += '<td><input type="text" id="mil" class="seg_area" value="0"></td>';
					    add_list += '</tr>';
					}
				}//end for2
				
				add_list += '</tbody>';
				add_list += '</table>';
				
				result_div += add_list;
				
				add_list = "";
			}//end for1
			
			copy_step_4.empty();
			var start = performance.now();
			copy_step_4.append(result_div);
			var duration = performance.now() - start;
			
			$("#info_popup").css("display", "flex");
			setTimeout(function(){
				//jquery sortable 적용
				for(var i = 0; i < plan_repeat; i++){
					$(document).find(".container"+(i+1)).sortable({
						placeholder : "itemBoxHighlight",
						start : function(event, ui){
							
						},
						stop : function(event, ui){//해당 구획 이동 완료 후 정렬
							
							var checkId = ui.item[0].getAttribute("data-id");
							var checkLength = $(this).find("."+checkId).length;
							
							var elementEls = $(this).find(".table_content");
							elementEls = Array.prototype.slice.call(elementEls);
							var index = elementEls.indexOf(ui.item[0]);
							var prevItem = elementEls[index-1].getAttribute("data-id");
							var nextItem = elementEls[index+1].getAttribute("data-id");
							if(prevItem != checkId && nextItem != checkId){
								return false;
							}else{
								//아이디 정렬해주기 위한 idarr 만들기
			 					var idArr = new Array();
								for(var i = 0; i < resultArray.length; i++){
									idArr.push(resultArray[i].id);
								}
								
								//해당 로우의 반복수
								var num = parseInt(ui.item[0].children[3].innerText);
								
								//해당 집구의 테이블 로우 개수
								var standardNum = $(".container1 .table_content").length;
								var checkNum = (num-1) * standardNum;
								
								var targetNum = parseInt(ui.item[0].children[0].innerText)-1+checkNum;
			 					reorder(num, idArr);
			 					var moveNum = parseInt(ui.item[0].children[0].innerText)-1+checkNum;

								let item = resultArray.splice(targetNum, 1);
								resultArray.splice(moveNum, 0, item[0]);
								var plusNum = 0;
								for(var i = checkNum; i < (checkNum+standardNum); i++){
									plusNum++;
									resultArray[i].num = plusNum;
									resultArray[i].id = idArr[i];
								}
								console.log(resultArray);
								var getDataArr = [...resultArray];
								getDataResult(getDataArr);
							}
							
							
						}
					});//end sortable
				}
				$("#info_popup").css("display", "none");
			}, (duration*1000));
			
			//그룹별 색깔 적용해주기
			$(document).find(".table_content").each(function(i, item){
				
				// var segmentLi = $('#step4-segment > li  .segment');
				// console.log(idArray,'idArray');
				
				/* id_color9 */
				// !important 색상 10개이상 추가시 수정
				for(var j = 0; j < idArray.length; j++){
					if($(this).hasClass(idArray[j])){
						$(this).addClass("id_color"+(j+1));
					}
				}
				
			});
			
		}else if(grow_type == "3"){ //세세구배치법
			
			//만들어준 factorArray를 가지고 최종 resultArray 만들어 주기
			for(var i = 0; i < plan_repeat; i++){
				level++;
				num1 = 0;
				for(var j = 0; j < factorArray.length; j++){
					num1++;
					var number = num1;
					var data = {"num" : number, "id" : factorArray[j].id+"-"+level, "type" : factorArray[j].type, "repeat" : i+1};
					
					resultArray.push(data);
				}
			}//end for
			
			//분할구배치법에서 그룹 나눠줄 id array
			var arr = new Array();
			for(var i = 0; i < resultArray.length; i++){
				arr[i] = resultArray[i].id.split("-")[0]+"-"+resultArray[i].id.split("-")[1];
			}
			var idArray = Array.from(new Set(arr));
			
			var copy_step_4 = $("#copy-step-4");
			
			add_list = "";
			var add_div = "";
			var result_div = "";
			
			for(var i = 0; i < plan_repeat; i++){
				
				add_list += '<div class="copy-title">집구 '+(i+1)+'</div>';
				add_list += '<table id="table2">';
				add_list += '<thead>';
				add_list += '<tr class="title">';
				add_list += '<th>구획번호</th>';
				add_list += '<th>구획 ID</th>';
				add_list += '<th>처리종류</th>';
				add_list += '<th>반복</th>';
				add_list += '<th>처리포장면적(㎡)</th>';
				add_list += '</tr>';
				add_list += '</thead>';
				add_list += '<tbody class="step4-container container'+(i+1)+'">';
				
				for(var j = 0; j < resultArray.length; j++){
					
					if(resultArray[j].repeat == (i+1)){
						var checkId = resultArray[j].id.split("-")[0]+"-"+resultArray[j].id.split("-")[1];
						for(var k = 0; k < idArray.length; k++){
							if(checkId == idArray[k]){
								add_list += '<tr data-id="'+idArray[k]+'" class="table_content '+idArray[k]+'">';
							}
						}
					    add_list += '<td class="table_num">'+resultArray[j].num+'</td>';
					    add_list += '<td>'+resultArray[j].id+'</td>';
					    add_list += '<td>'+resultArray[j].type+'</td>';
					    add_list += '<td>'+resultArray[j].repeat+'</td>';
					    add_list += '<td><input type="text" id="mil" class="seg_area" value="0"></td>';
					    add_list += '</tr>';
					}
				}//end for2
				
				add_list += '</tbody>';
				add_list += '</table>';
				
				result_div += add_list;
				
				add_list = "";
			}//end for1
			
			copy_step_4.empty();
			var start = performance.now();
			copy_step_4.append(result_div);
			var duration = performance.now() - start;
			
			$("#info_popup").css("display", "flex");
			setTimeout(function(){
				//jquery sortable 적용
				for(var i = 0; i < plan_repeat; i++){
					$(document).find(".container"+(i+1)).sortable({
						placeholder : "itemBoxHighlight",
						start : function(event, ui){
							
						},
						stop : function(event, ui){//해당 구획 이동 완료 후 정렬
							
							//아이디 정렬해주기 위한 idarr 만들기
		 					var idArr = new Array();
							for(var i = 0; i < resultArray.length; i++){
								idArr.push(resultArray[i].id);
							}
							
							//해당 로우의 반복수
							var num = parseInt(ui.item[0].children[3].innerText);
							
							//해당 집구의 테이블 로우 개수
							var standardNum = $(".container1 .table_content").length;
							var checkNum = (num-1) * standardNum;
							
							var targetNum = parseInt(ui.item[0].children[0].innerText)-1+checkNum;
		 					reorder(num, idArr);
		 					var moveNum = parseInt(ui.item[0].children[0].innerText)-1+checkNum;

							let item = resultArray.splice(targetNum, 1);
							resultArray.splice(moveNum, 0, item[0]);
							var plusNum = 0;
							for(var i = checkNum; i < (checkNum+standardNum); i++){
								plusNum++;
								resultArray[i].num = plusNum;
								resultArray[i].id = idArr[i];
							}
							console.log(resultArray);
							var getDataArr = [...resultArray];
							getDataResult(getDataArr);
						}
					});//end sortable
				}
				$("#info_popup").css("display", "none");
			}, (duration*1000));
			
			//그룹별 색깔 적용해주기
			$(document).find(".table_content").each(function(i, item){
				/* id_color9 */
				for(var j = 0; j < idArray.length; j++){
					if($(this).hasClass(idArray[j])){
						$(this).addClass("id_color"+(j+1));
					}
				}
			});
			
		}
		
		//이곳에서 데이터 받아와야함 : important
		var getDataArr = [...resultArray];
		getDataResult(getDataArr);
		console.log(resultArray);
	}//end fridFactors

	//jquery sortable 적용	
	$(document).find("#step-container").sortable({
		placeholder : "itemBoxHighlight",
		start : function(event, ui){
			
		},
		stop : function(event, ui){
			
		}
	});//end sortable
	
	$(document).find("#method-container").sortable({
		placeholder : "itemBoxHighlight",
		start : function(event, ui){
			
		},
		stop : function(event, ui){
			
		}
	});//end sortable
	
	//번호 재입력 //numbering
	function reorder(num, idArr){
		
		$(document).find(".container"+num+" .table_content").each(function(i, item){
			$(this).find(".table_num").text((i+1));
			$(this).children().eq(1).text(idArr[i]);
		});
		
		
		
	}
	
	//구획정보 처리포장면적 이벤트
	$(document).on("keyup", ".container1 .table_content:eq(0) .seg_area", function(){
		var input_text = $(this).val();
		$(document).find(".seg_area").val(input_text);
	});
	
	//조사 항목 체크박스 추가 이벤트
	function PlusMethod(){
		
		var method_container = $("#method-container");
		var add_list = "";
		
		$(document).find("input:checkbox[name=chk_method]:checked").each(function(i, item){
			
			var method_id = $(this).val();
			var d2_name = $(this).parent().parent().find(".d2_name").text();
			var d3_name = $(this).parent().parent().find(".d3_name").text();
			var d1_name = $(this).parent().parent().find(".d1_name").text();
			var method_title = $(this).parent().parent().find(".method_title").text();
			var method_contents = $(this).parent().parent().find(".method_contents").text();
			
			add_list += '<div th:data-id='+method_id+' class="list-group method-step">';
			add_list += '<li class="list-group-item-sm list-group-item">';
			add_list += '<div class="row">';
			
			add_list += '<div class="mb-1 col-1">';
			add_list += '<input type="checkbox" class="checkbox mr-2" name="mis_method">';
			add_list += '</div>';
			
			add_list += '<div class="mb-1 col-2">';
			add_list += '<span class="d2_name">'+d2_name+'</span>';
			add_list += '</div>';
			
			add_list += '<div class="mb-1 col-2">';
			add_list += '<span class="d3_name">'+d3_name+'</span>';
			add_list += '</div>';
			
			add_list += '<div class="mb-1 col-2">';
			add_list += '<span class="d1_name">'+d1_name+'</span>';
			add_list += '</div>';
			
			add_list += '<div class="mb-1 col-2">';
			add_list += '<span class="method_title">'+method_title+'</span>';
			add_list += '</div>';
			
			add_list += '<div class="mb-1 col-3">';
			add_list += '<span class="method_contents">'+method_contents+'</span>';
			add_list += '</div>';
				
			add_list += '</div>';
			add_list += '</li>';
			add_list += '</div>';
			
			//선택 항목 숨기기
			$(this).parent().parent().css("display", "none");
			
			//체크 해제
			$(this).prop("checked", false);
			
		});
		
		method_container.append(add_list);
		gridStep6();
	}
	
	//조사항목 체크박스 삭제
	function MinusMethod(){
		
		var showArr = new Array();
		
		$(document).find("input:checkbox[name=mis_method]:checked").each(function()
		{	
			var del_div = $(this).parent().parent().parent().parent();
			del_div.remove();
			showArr.push($(this).parent().parent().parent().parent().attr("th:data-id"));
		});
		
		$(document).find("#method_list .method_tr").each(function(){
			
			for(var i = 0; i < showArr.length; i++){
				if(showArr[i] == $(this).find("input:checkbox[name=chk_method]").val()){
					$(this).css("display", "");
				}
			}
		});
		gridStep6();
	}
	
	//구획 등록
	function insertSegment(plan_id){
		segment_array = [];
		
		$(document).find(".table_content").each(function(index, item){
			
			var seg_data = {
				"plan_id" : plan_id,
				"segment_code" : $(this).children().eq(1).text(),
				"segment_index" : $(this).children().eq(0).text(),
				"segment_type" : $(this).children().eq(2).text(),
				"segment_repeat" : $(this).children().eq(3).text(),
				"segment_area" : $(this).find("input:text").val(),
				"individual_num" : 3
			};
			
			segment_array.push(seg_data);
			
		});
		
		console.log(segment_array);
		
		var cancel = new Array();
		
		$.ajax({
			url : "/plan/insertSegment?cancel="+cancel,
			method : "POST",
			contentType : "application/json; charset=utf-8",
			data : JSON.stringify(segment_array),
			success : function(result){
				
				if(result == 0){
					
				}else {
					
				}
			}
		});//end ajax
		
	}
	
	//등록 버튼 이벤트
	$("#planInsertBtn").on("click", function(){
		
		/* console.log("data!!!!!");
		console.log(data1);
		console.log(data2);
		console.log(data3);
		console.log("manure!!!!");
		console.log(manureArray);
		console.log(manureArray1);
		console.log(manureArray2);
		console.log(manureArray3);
		console.log("etc!!!!");
		console.log(etcArray);
		console.log(etcArray1);
		console.log(etcArray2);
		console.log(etcArray3); */
		
		if($("#grow_type option:selected").val() == "none"){
			alert("시험구배치 종류를 선택해주세요.");
			$("#grow_type").focus();
		}else if($("#storage_input").val() == ""){
			alert("포장을 선택해 주세요");
		}else if($("#select_view1").attr("data-code") == ""){
			alert("과제를 선택해 주세요");
		}else if(Object.keys(data1).length == 0 && Object.keys(data2).length == 0 && Object.keys(data3).length == 0){
			alert("시험구배치 요인을 선택해 주세요");
		}else {
			
			insertPlan().then(function(result){
				
				if(result == 0){
					alert("재배계획 등록에 실패했습니다. 다시 등록해 주세요.");
				}else{
					var plan_id = result;
					
					var checkSch = $(document).find(".input_manager_tr").length;
					
					//담당자 등록
					if(checkSch != 0){
						insertSchedule(plan_id);
					}
					
					//구획 등록
					insertSegment(plan_id);
					
					//시험구 요인 등록
					insertFactor(plan_id);
				}
				
			})//end inserPlan().then
		}//end else
		
		
	});
	
	//plan 등록 함수
	function insertPlan(){
		return new Promise(function(resolve){
			
			var plan_method = "";
			
			var length = $(document).find(".method-step").length;
			$(document).find(".method-step").each(function(index, item){
				var id = $(this).attr("th:data-id");
				
				if(index == (length-1)){
					plan_method += id;
				}else{
					plan_method += id+',';
				}
				
			});
			
			
			var report_code = $("#select_view1").attr("data-code");
			var grow_type = $("#grow_type option:selected").val();
			var plan_repeat = $("#plan_repeat").val();
			var plan_segment = $("#mil2").val();
			var storage_id = $("#storage_input").attr("th:data-storage-id");
			
			var data = {
					"storage_id" : storage_id,
					"report_code" : report_code,
					"grow_type" : grow_type,
					"plan_repeat" : plan_repeat,
					"plan_segment" : plan_segment,
					"plan_method" : plan_method
			};
			
			$.ajax({
				url : "/plan/insertPlan",
				method : "POST",
				dataType : 'json',
				data : data,
				success : function(result){
					if(result == 0){
						
					}else{
						resolve(result);
					}
				}
			});//end ajax
				
			
			
		});//end return
	}//end function
	
	//시험구 요인 등록
	async function insertFactor(plan_id){
		
		const dataArray = [];
		let inputdata = {};
		
		if(Object.keys(data1).length != 0){
			if(data1.type == "시험재료"){
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 1,
						"factor_type" : data1.type,
						"factor_seed" : data1.content
				};
				
			}else if(data1.type == "재식거리"){
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 1,
						"factor_type" : data1.type,
						"factor_interval" : data1.content
					};
			}else if(data1.type == "재식주수"){
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 1,
						"factor_type" : data1.type,
						"factor_plants" : data1.content
					};
			}else if(data1.type == "파종량"){
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 1,
						"factor_type" : data1.type,
						"factor_amount" : data1.content
					};
			}else if(data1.type == "시비량"){
				var manure_id = "";
				
				for(var i = 0; i < manureArray1.length; i++){
					manureArray1[i].plan_id = plan_id;
					manureArray1[i].factor_index = 1;
				}
				
				await insertManure(manureArray1).then(function(result){
					
					
					var length = result.length;
					for(var i = 0; i < length; i++){
						if(i == (length-1)){
							manure_id += result[i];
						}else{
							manure_id += result[i]+",";
						}
					}
					
				});//end insertEtc().then
				
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 1,
						"factor_type" : data1.type,
						"manure_id" : manure_id
					};
			}else if(data1.type == "기타"){
				var etc_id = "";
				
				for(var i = 0; i < etcArray1.length; i++){
					etcArray1[i].plan_id = plan_id;
					etcArray1[i].factor_index = 1;
				}
				
				await insertEtc(etcArray1).then(function(result){
					
					
					var length = result.length;
					for(var i = 0; i < length; i++){
						if(i == (length-1)){
							etc_id += result[i];
						}else{
							etc_id += result[i]+",";
						}
					}
					
				});//end insertEtc().then
				
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 1,
						"factor_type" : data1.type,
						"etc_id" : etc_id
				};
			}
			
			dataArray.push(inputdata);
		}
		if(Object.keys(data2).length != 0){
			if(data2.type == "시험재료"){
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 2,
						"factor_type" : data2.type,
						"factor_seed" : data2.content
					};
				
			}else if(data2.type == "재식거리"){
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 2,
						"factor_type" : data2.type,
						"factor_interval" : data2.content
					};
			}else if(data2.type == "재식주수"){
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 2,
						"factor_type" : data2.type,
						"factor_plants" : data2.content
					};
			}else if(data2.type == "파종량"){
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 2,
						"factor_type" : data2.type,
						"factor_amount" : data2.content
					};
			}else if(data2.type == "시비량"){
				
				var manure_id = "";
				
				for(var i = 0; i < manureArray2.length; i++){
					manureArray2[i].plan_id = plan_id;
					manureArray2[i].factor_index = 2;
				}
				
				await insertManure(manureArray2).then(function(result){
					
					
					var length = result.length;
					for(var i = 0; i < length; i++){
						if(i == (length-1)){
							manure_id += result[i];
						}else{
							manure_id += result[i]+",";
						}
					}
					
				});//end insertEtc().then
				
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 2,
						"factor_type" : data2.type,
						"manure_id" : manure_id
					};
				
			}else if(data2.type == "기타"){
				
				var etc_id = "";
				
				for(var i = 0; i < etcArray2.length; i++){
					etcArray2[i].plan_id = plan_id;
					etcArray2[i].factor_index = 2;
				}
				
				await insertEtc(etcArray2).then(function(result){
					
					
					var length = result.length;
					for(var i = 0; i < length; i++){
						if(i == (length-1)){
							etc_id += result[i];
						}else{
							etc_id += result[i]+",";
						}
					}
					
				});//end insertEtc().then
				
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 2,
						"factor_type" : data2.type,
						"etc_id" : etc_id
					};
			}
			
			dataArray.push(inputdata);
		}
		if(Object.keys(data3).length != 0){
			
			if(data3.type == "시험재료"){
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 3,
						"factor_type" : data3.type,
						"factor_seed" : data3.content
					};
				
			}else if(data3.type == "재식거리"){
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 3,
						"factor_type" : data3.type,
						"factor_interval" : data3.content
					};
			}else if(data3.type == "재식주수"){
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 3,
						"factor_type" : data3.type,
						"factor_plants" : data3.content
					};
			}else if(data3.type == "파종량"){
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 3,
						"factor_type" : data3.type,
						"factor_amount" : data3.content
					};
			}else if(data3.type == "시비량"){
				
				var manure_id = "";
				
				for(var i = 0; i < manureArray3.length; i++){
					manureArray3[i].plan_id = plan_id;
					manureArray3[i].factor_index = 3;
				}
				
				await insertManure(manureArray3).then(function(result){
					
					
					var length = result.length;
					for(var i = 0; i < length; i++){
						if(i == (length-1)){
							manure_id += result[i];
						}else{
							manure_id += result[i]+",";
						}
					}
					
				});//end insertEtc().then
				
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 3,
						"factor_type" : data3.type,
						"manure_id" : manure_id
					};
				
			}else if(data3.type == "기타"){
				
				var etc_id = "";
				
				for(var i = 0; i < etcArray3.length; i++){
					etcArray3[i].plan_id = plan_id;
					etcArray3[i].factor_index = 3;
				}
				
				await insertEtc(etcArray3).then(function(result){
					
					
					var length = result.length;
					for(var i = 0; i < length; i++){
						if(i == (length-1)){
							etc_id += result[i];
						}else{
							etc_id += result[i]+",";
						}
					}
					
				});//end insertEtc().then
				
				inputdata = {
						"plan_id" : plan_id,
						"factor_index" : 3,
						"factor_type" : data3.type,
						"etc_id" : etc_id
					};
			}
			
			dataArray.push(inputdata);
		}
		
		
		insertFactors(dataArray);
	}//end 시험구 요인 등록
	
	function insertFactors(dataArray){
		$.ajax({
			url : "/plan/insertFactor",
			method : "POST",
			contentType : "application/json; charset=utf-8",
			data : JSON.stringify(dataArray),
			success : function(result){
				if(result == 0){
					
				}else{
					$("#success_popup").css("display", "flex");
				}
			}
		});
	}
	
	//기타 요인 등록
	function insertEtc(array){
		return new Promise(function(resolve){
			
			$.ajax({
				url : "/plan/insertEtc",
				method : "POST",
				contentType : "application/json; charset=utf-8",
				data : JSON.stringify(array),
				success : function(result){
					if(result[0] == 0){
						alert("기타 요인 등록에 실패했습니다.");
					}else{
						resolve(result);
					}
				}
			});
			
		});//end return
	}//end function
	
	//시비량 등록
	function insertManure(array){
		return new Promise(function(resolve){
			
			$.ajax({
				url : "/plan/insertManure",
				method : "POST",
				contentType : "application/json; charset=utf-8",
				data : JSON.stringify(array),
				success : function(result){
					if(result[0] == 0){
						alert("시비량 등록에 실패했습니다.");
					}else{
						resolve(result);
					}
				}
			});
			
		})//end return
	}//end function
	var map2;
	const modalContainer = document.querySelector('#modal_map');
	//다음 버튼 이벤트 함수
	function nextStep(i){
		$("#step"+i+" .content").slideDown();
		$("#step3"+i+" .title").addClass("active");
		
	}
	
	//시험재료 검색 함수
	function filterSeed(){
		var search = $("#searchSeed").val().toLowerCase();
		
		$(document).find(".seed_tr").each(function(i, item){
			var text1 = $(this).find(".text_1").text();
			var text2 = $(this).find(".text_2").text();
			
			if(text1.toLowerCase().includes(search) || text2.toLowerCase().includes(search)){
				$(this).css("display", "");
			}else{
				$(this).css("display", "none");
			}
		});
		
	}
	
	//조사항목 검색 함수
	function filterMethod(){
		var search = $("#searchMethod").val().toLowerCase();
		
		$(document).find(".method_tr").each(function(i, item){
			var text1 = $(this).find(".d3_name").text();
			var text2 = $(this).find(".method_title").text();
			
			if(text1.toLowerCase().includes(search) || text2.toLowerCase().includes(search)){
				$(this).css("display", "");
			}else{
				$(this).css("display", "none");
			}
		});
		
	}
	
	//포장 선택 list
	$(document).ready(function(){
		SearchStorage(1);
	});
	
	function SearchStorage(e)
	{
		var data = {"page_num" : e};
		
		$.ajax(
		{
			url : '/plan/searchStorage',
			method : 'POST',
			dataType : 'json',
			data : data,
			success : function(result)
			{
				
				var storage_list = $("#storage_list");
				var add_list = "";
				
				var pageNum = $("#pageNum");
				var page_add = "";
				
				for(var i = 0; i < result.storage.length; i++)
				{
									
					add_list += `
					  <tr class='storage_tr' data-id='${result.storage[i].storage_id}' data-coord='${result.storage[i].storage_location}'>
						<td><span>${result.storage[i].storage_code}</span></td>
						<td><span class='storage_name'>${result.storage[i].storage_name}</span></td>
						<td><span>${result.storage[i].storage_division}</span></td>
					  </tr>';
					`
				}

				if(result.page_num > 10)
				{
					page_add += '<button class="atbd-pagination__link pagination-control" onclick="SearchStorage(' + (result.start_page - 10) + ')"><</button>';
				}
				
				for(var i = (result.start_page - 1); i < (result.start_page + 9); i++)
				{
					if(result.page_num == (i + 1))
					{
						page_add += '<button class="atbd-pagination__link active" onclick="SearchStorage(' + (i + 1) + ')">' + (i + 1) + '</button>';
					}
					else if(i >= result.end_page)
					{
						
					}
					else
					{
						page_add += '<button class="atbd-pagination__link pagination-control" onclick="SearchStorage(' + (i + 1) + ')">' + (i + 1) + '</button>';
					}
				}
				
				if(result.page_num < (result.end_page - 10))
				{
					page_add += '<button class="atbd-pagination__link pagination-control" onclick="SearchStorage(' + (result.start_page + 10) + ')">></button>';
				}
				
				storage_list.empty();
				storage_list.append(add_list);
				
				pageNum.empty();
				pageNum.append(page_add);
				
				$(".storage_tr").click(function(){
					const targetCoord = $(this).data('coord');
					const lat = targetCoord[0].lat;
					const lng = targetCoord[0].lng;
					const position = new kakao.maps.LatLng(lat, lng)
					map.panTo(position);
					__polygon?.setMap(null);

					const linePath = [];
					targetCoord.forEach((v, i) => {
						const position = new kakao.maps.LatLng(v.lat, v.lng);
						linePath.push(position);
					})

					// 지도에 표시할 선을 생성합니다
					
					const polyline = new kakao.maps.Polygon({
						path: linePath, // 선을 구성하는 좌표배열 입니다
						strokeWeight: 3, // 선의 두께입니다
						strokeColor: '#fff', // 선의 색깔입니다
						strokeOpacity: 0.2, // 선의 불투명도 입니다 1에서 0 사이의 값이며 0에 가까울수록 투명합니다
						strokeStyle: 'longdash', // 선의 스타일입니다
						fillColor: '#4347d9', // 채우기 색깔입니다
						fillOpacity: 0.5 // 채우기 불투명도 입니다
					});

					// 지도에 선을 표시합니다 
					polyline.setMap(map);
					__polygon = polyline;
					
					let storage_name = $(this).find(".storage_name").text();
					let storage_id = $(this).data('id');
					$("#storage_input").val(storage_name);
					$("#storage_input").attr("th:data-storage-id", storage_id);
					
				});
			}
		});
		
	}//end function SearchStorage
	
	//포장 등록 함수
	function insertStorage(){
		const coords_data = coords;		
		const location = $("#storage_location");
		location.val(JSON.stringify(coords_data));
		
		coords = [];
		
		var storage_name = $("#storage_name").val();
		var storage_type = $("#storage_type").val();
		var storage_location = $("#storage_location").val();
		
		if(storage_name == "")
		{
			alert("위치를 입력하세요.");
		}
		else if(storage_type == 9)
		{
			alert("장소유형을 입력하세요.");
		}
		else if(storage_location.length == 2)
		{
			alert("지도에서 영역을 정하세요.");
		}else{
		
			var insertStorageForm = $("#insertStorageForm").serialize();
			
			$.ajax({
				url : "/plan/insertStorage",
				method : "POST",
				dataType : "json",
				data : insertStorageForm,
				success : function(result){
					if(result == 0){
						
					}else {
						
						markers = [];
						coords = [];
						polygon.setMap(null);      
			            polygon = null;  
						
						$("#storageModal").modal("hide");
						SearchStorage(1);
					}
				}
			});//end ajax
			
		}
		
	}
	
	//datapicker 기본 옵션 설정
	$.datepicker.setDefaults({
		dateFormat: "yy-mm-dd",
      	/* duration: "medium",
      	changeMonth: true,
      	changeYear: true */
	});
	
	//담당자 그려주기
	function gridStep6(){
		
		$("#step6_list").empty();
		
		var step6_list = $("#step6_list");
		var length = $(document).find("#method-container .method-step").length;
		var add_list = "";
		
		$(document).find("#method-container .method-step").each(function(i, item){
			
			add_list += '<div class="top1">';
			add_list += '<span class="title_sub">[조사항목 : '+$(this).find(".method_title").text()+']</span>';
			
			add_list += '<div class="row">'; //row1
			add_list += '<div class="col-12">';
			add_list += '<ul>';
			
			add_list += '<li>';
			add_list += '<span><span class="red" style="color: #FF4141">*</span>담당자(정)</span>';
			add_list += '<select class="select_user1">';
			add_list += '<option value=0 disabled="disabled" selected="selected" hidden="hidden">담당자 선택</option>';
			for(var j = 0; j < user.length; j++){
				add_list += '<option value="'+user[j].user_id+'">'+user[j].user_name_k+'</option>';
			}
			add_list += '</select>';
			add_list += '</li>';
			
			add_list += '<li>';
			add_list += '<span>담당자(부)</span>';
			add_list += '<select class="select_user2">';
			add_list += '<option value=0 disabled="disabled" selected="selected" hidden="hidden">담당자 선택</option>';
			for(var j = 0; j < user.length; j++){
				add_list += '<option value="'+user[j].user_id+'">'+user[j].user_name_k+'</option>';
			}
			add_list += '</select>';
			add_list += '</li>';
			
			add_list += '</ul>';
			add_list += '</div>';
			add_list += '</div>'; //end row1
			
			add_list += '<div class="row">'; //row2
			add_list += '<div class="col-12">';
			add_list += '<ul>';
			add_list += '<li>';
			add_list += '<span style="float: left;">시작일</span>';
			add_list += '<input type="text" class="start_date" name="">';
			add_list += '<div class="cal">';
			add_list += '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar" viewBox="0 0 16 16">';
			add_list += '<path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>';
			add_list += '</svg>';
			add_list += '</div>';
			add_list += '</li>';
			
			add_list += '<li>';
			add_list += '<span style="float: left;">종료일</span>';
			add_list += '<input type="text" class="end_date" name="">';
			add_list += '<div class="cal">';
			add_list += '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar" viewBox="0 0 16 16">';
			add_list += '<path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>';
			add_list += '</svg>';
			add_list += '</div>';
			add_list += '</li>';
			add_list += '<li>';
			
			add_list += '</ul>';
			add_list += '</div>';
			add_list += '</div>'; //end row2
			
			add_list += '<div class="btn">';
			add_list += '<button type="button" class="add_manager">추가</button>';
			add_list += '</div>';
			add_list += '</div>'; //end top1
			
			add_list += '<div class="top1">';
			add_list += '<table>';
			add_list += '<thead>';
			add_list += '<tr class="mng_method" data-method="'+$(this).attr("th:data-id")+'">';
			add_list += '<th>담당자(정)</th>';
			add_list += '<th>담당자(부)</th>';
			add_list += '<th>시작일</th>';
			add_list += '<th>종료일</th>';
			add_list += '<th></th>';
			add_list += '</tr>';
			add_list += '</thead>';
			add_list += '<tbody class="input_manager">';
			
			add_list += '</tbody>';
			add_list += '</table>';
			add_list += '</div>';
			
		});
		
		step6_list.append(add_list);
		
		//동적 생성된 datepicker 클래스에 datepicker 이벤트 주기
		$(document).find(".start_date").each(function(index){
			$(this).datepicker();
			$(this).addClass(".start-datepicker"+index);
			$(this).find(".ui-datepicker-trigger").remove();
			$(".start-datepicker"+index).removeClass("hasDatepicker").datepicker();
		});
		
		$(document).find(".end_date").each(function(index){
			$(this).datepicker();
			$(this).addClass(".end-datepicker"+index);
			$(this).find(".ui-datepicker-trigger").remove();
			$(".end-datepicker"+index).removeClass("hasDatepicker").datepicker();
		});
		
	}//end 담당자 그려주기
	
	//담당자 추가 이벤트
	$(document).on("click", ".add_manager", function(){
		
		var manager1_id = $(this).parent().parent().find(".select_user1 option:selected").val();
		
		var manager1_text = $(this).parent().parent().find(".select_user1 option:selected").text();
		if(manager1_id == 0){
			manager1_text = "";
		}
		var manager2_id = $(this).parent().parent().find(".select_user2 option:selected").val();
		var manager2_text = $(this).parent().parent().find(".select_user2 option:selected").text();
		if(manager2_id == 0){
			manager2_text = "";
		}
		var start_date = $(this).parent().parent().find(".start_date").val();
		var end_date = $(this).parent().parent().find(".end_date").val();
		
		var input_manager = $(this).parent().parent().next().find(".input_manager");
		
		var checkId = $(this).parent().parent().next().find(".input_manager:eq(0)").find(".mng_input1").attr("data-id");
		console.log(checkId);
		
		if(checkId != undefined && checkId != manager1_id){
			alert("담당자(정)은 한명만 지정이 가능합니다.");
		}else{
			var str = "";
			
			str += '<tr class="input_manager_tr">';
			str += '<td class="mng_input1" data-id="'+manager1_id+'">'+manager1_text+'</td>';
			str += '<td class="mng_input2" data-id="'+manager2_id+'">'+manager2_text+'</td>';
			str += '<td class="mng_input3">'+start_date+'</td>';
			str += '<td class="mng_input4">'+end_date+'</td>';
			str += '<td><button type="button" class="del_manager">삭제</button></td>';
			str += '</tr>';
			
			input_manager.append(str);
			
		}
		
		
		
	});//end 담당자 추가 이벤트
	
	//담당자 삭제 이벤트
	$(document).on("click", ".del_manager", function(){
		$(this).parent().parent().remove();
	});
	
	//스케줄 등록 실행 함수
	function insertSchedule(plan_id){
		
		$(document).find(".input_manager_tr").each(function(i, index){
			var method_id = $(this).parent().prev().find(".mng_method").attr("data-method");
			var sch_supervisor = $(this).find(".mng_input1").attr("data-id");
			var sch_manager = $(this).find(".mng_input2").attr("data-id");
			var start_date = $(this).find(".mng_input3").text();
			var end_date = $(this).find(".mng_input4").text();
			
			let mng_data = {
					"plan_id" : plan_id,
					"method_id" : method_id,
					"sch_supervisor" : sch_supervisor,
					"sch_manager" : sch_manager,
					"start_date" : start_date,
					"end_date" : end_date
			};
			scheduleArray.push(mng_data);
		});
		
		
		$.ajax({
			url : "/plan/insertSchedule",
			method : "POST",
			contentType : "application/json; charset=utf-8",
			data : JSON.stringify(scheduleArray),
			success : function(result){
				if(result == 0){
					
				}else {
					
				}
			}
		});//end ajax
	}
	
	

</script>

<script type="text/javascript">

	let section = document.getElementById("section"),
	step = section.children,  
	n = 0;
	
	
	let slideUp = (title, target, duration=500) => {
	    title.classList.remove("active");
	    target.style.transitionProperty = 'height, margin, padding';
	    target.style.transitionDuration = duration + 'ms';
	    target.style.boxSizing = 'border-box';
	    target.style.height = target.offsetHeight + 'px';
	    target.offsetHeight;
	    target.style.overflow = 'hidden';
	    target.style.height = 0;
	    target.style.paddingTop = 0;
	    target.style.paddingBottom = 0;
	    target.style.marginTop = 0;
	    target.style.marginBottom = 0;
	    window.setTimeout( () => {
	        target.style.display = 'none';
	        target.style.removeProperty('height');
	        target.style.removeProperty('padding-top');
	        target.style.removeProperty('padding-bottom');
	        target.style.removeProperty('margin-top');
	        target.style.removeProperty('margin-bottom');
	        target.style.removeProperty('overflow');
	        target.style.removeProperty('transition-duration');
	        target.style.removeProperty('transition-property');
	    }, duration);
	}
	let slideDown = (title, target, duration=500) => {
	    target.style.removeProperty('display');
	    let display = window.getComputedStyle(target).display;
	    if (display === 'none')
	    display = 'block';
	    title.classList.add("active");
	    target.style.display = display;
	    let height = target.offsetHeight;
	    target.style.overflow = 'hidden';
	    target.style.height = 0;
	    target.style.paddingTop = 0;
	    target.style.paddingBottom = 0;
	    target.style.marginTop = 0;
	    target.style.marginBottom = 0;
	    target.offsetHeight;
	    target.style.boxSizing = 'border-box';
	    target.style.transitionProperty = "height, margin, padding";
	    target.style.transitionDuration = duration + 'ms';
	    target.style.height = height + 'px';
	    target.style.removeProperty('padding-top');
	    target.style.removeProperty('padding-bottom');
	    target.style.removeProperty('margin-top');
	    target.style.removeProperty('margin-bottom');
	    window.setTimeout( () => {
	        target.style.removeProperty('height');
	        target.style.removeProperty('overflow');
	        target.style.removeProperty('transition-duration');
	        target.style.removeProperty('transition-property');
	    }, duration);
	}
	let slideToggle = (title, target, duration = 500) => {
	    if (window.getComputedStyle(target).display === 'none') {
	        return slideDown(title, target, duration);
	    } else {
	        return slideUp(title, target, duration);
	    }
	}
	
	// 카카오맵
	const container = document.querySelector('#map_regist');
	let map; 
	let markers = [];
	let coords = [];
	let __polygon;
	
	
	function createMarker(lng, lat, map){
	    const markerPosition  = new kakao.maps.LatLng(lat, lng); 
	
	    // 마커를 생성합니다
	    const marker = new kakao.maps.Marker({
	        position: markerPosition
	    });
	
	    marker.setMap(map2);
	    markers.push(marker);
	    coords.push({ lat, lng })
	}	  
	
	function clearMarkers(isRequest) {
	    for (var i = 0; i < markers.length; i++) {
	        markers[i].setMap(null);
	    }            
	
	    markers = [];
// 	    coords = [];
// 	    if (isRequest) {
// 	        requestServer();
// 	        markers = [];
// 	//         coords = [];
// 	    } else {
// 	        markers = [];
// 	        coords = [];
// 	    }
	}
	
	// 이벤트 관련 변수들
	let drawingFlag = false; 
	let drawingPolygon; 
	let polygon; 
	let areaOverlay; 
	
	for(let i=0; i<step.length; i++){
	    let stepInner = step[i].children;
	    for(let k=0; k<stepInner.length; k++){
	        let [title, content] = stepInner[k].children;
	        
	        title.addEventListener("click", function(e){
	        	if (k === 0) {
	        		setTimeout(() => {        			
	        			
	        			const options = { 
	        				center: new kakao.maps.LatLng(37.263599, 126.987598),
	        			    level: 3
	        			};
	        			map = new kakao.maps.Map(container, options);	        			
	        			
	        			
	        		}, [])
	        	}
	            slideToggle(title, content);
	        });
	        
	    }
	}
	
	//등록화면 접속시 step1 열어주기
	setTimeout(function(){
		var eventList = document.createEvent("MouseEvent");
	    eventList.initEvent("click");
	    document.querySelector("#step1 .title").dispatchEvent(eventList);
	}, 1);
	
</script>

</body>    
</html>