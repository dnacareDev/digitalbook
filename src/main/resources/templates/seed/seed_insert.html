<!doctype html>
<html lang="en" dir="ltr"
	xmlns:th="http://www.thymeleaf.org">

<head>

<!-- 공통 헤더 -->
<th:block th:include="@{/fragments/header.html}"></th:block>

</head>

<body class="layout-light top-menu overlayScroll">
	<div class="mobile-search"></div>
	
	<div class="mobile-author-actions"></div>
	
	<!-- 공통 topbar -->
	<th:block th:include="@{/fragments/topbar.html}"></th:block>
	
	<main class="main-content" style="background-color: #fafef5;">
	
		<div class="contents" style="background-color: #fafef5;">
    
		    <div class="container-fluid">
		    	<div class="row">
			        <div class="col-lg-12">
			        	<div class="breadcrumb-main" style="float: left;">
			        		<h4 class="text-capitalize breadcrumb-title">종자(시료)</h4>
			        		<span class="ml-20 mt-1">기초정보-종자(시료)</span>
			        	</div>
			        	<div class="d-flex justify-content-end mt-20">
		               		<button class="btn btn-lg btn-primary" id="excelBtn"><span data-feather="upload"></span>엑셀 등록</button>
		                </div>
			        </div>
		        </div>
		    	<div class="row">
			        <div class="col-lg-12">
			        	<form action="#">
				        	<div class="card">
				        		<div class="card-body">
				        			<div class="row">
				        				<div class="col-sm-2 checkbox-theme-default custom-checkbox">
				        					<input type="checkbox" id="not_report" class="checkbox">
				        					<label for="not_report">
				        						<span class="checkbox-text color-dark">과제 비연계</span>
				        					</label>
				        				</div>
				        			</div>
			        				<div class="row">
			        					<div class="col-sm-2 d-flex aling-items-center">
			                                   <label for="report_year" class="col-form-label color-dark align-center">과제명</label>
		                                </div>
		                                <div class="col-sm-8">
		                                   <select class="form-control b-light" id="report_id">
			                                <option th:value=0>과제 선택</option>
			                                <th:block th:each="report : ${report}">
			                                	<option th:value="${report.report_id}" th:text="${report.report_title}"></option>
			                                </th:block>
			                               </select>
		                                </div>
			                         </div>
			                         <div class="row mt-3">
			        					<div class="col-sm-2 d-flex aling-items-center">
			                            	<label for="seed_report" class="color-dark align-center">과제설명</label>
			                            </div>
			                            <div class="col-sm-8">
			                                <textarea class="form-control" id="seed_report" rows="5"></textarea>
			                            </div>
			                    	</div>
				        		</div>
				        	</div>
				        	<div class="card mt-4">
				        		<div class="card-body">
				        			<div class="columnGrid-wrapper">
					        			<div class="row">
				        					<div class="col-12">
				        						<div class="card card-bordered">
					        						<div class="card-body ml-2 mt-3">
					        							<div class="col-12 ml-1">
													        <div class="row">
													        	<div style="font-size: 17px; color: initial;">종자 및 시료관리</div>
													        </div>
												        </div>
					        							<div class="col-12">
					        								<div class="row mt-1">
					        									<div class="col-md-2 mb-25 d-flex aling-items-center">
					        										<label class="color-dark fw-500 align-center mt-1">품종/유전자원정보<span style="color: red;">*</span></label>
					        									</div>
					        									<div class="col-md-4 mb-25">
					        										<input type="text" class="form-control b-light" id="genetic" style="float: left; width: 365px;">
					        										<label class="btn btn-light" for="genetic">조회</label>
					        									</div>
					        									<div class="col-md-2 mb-25 d-flex aling-items-center">
								                                    <label for="seed_manager" class="color-dark fw-500 align-center">담당자<span style="color: red;">*</span></label>
								                                </div>
								                                <div class="col-md-4 mb-25">
					        										<select class="form-control b-light" id="seed_manager">
										                                <option disabled="disabled" selected="selected" hidden="hidden">담당자 선택</option>
										                                <th:block th:each="user : ${user}">
										                                	<option th:value="${user.user_id}" th:text="${user.user_name}"></option>
										                                </th:block>
										                            </select>
					        									</div>
					        								</div>
					        								<div class="row">
					        									<div class="col-md-2 mb-25 d-flex aling-items-center">
					        										<label for="seed_area" class="color-dark fw-500 align-center mt-1">생산지역<span style="color: red;">*</span></label>
					        									</div>
					        									<div class="col-md-4 mb-25">
					        										<input type="text" class="form-control b-light" id="seed_area">
					        									</div>
					        									<div class="col-md-2 mb-25 d-flex aling-items-center">
								                                    <label for="seed_year" class="color-dark fw-500 align-center">생산연도<span style="color: red;">*</span></label>
								                                </div>
								                                <div class="col-md-4 mb-25">
					        										<input type="number" class="form-control b-light" id="seed_year">
					        									</div>
					        								</div>
					        								<div class="row">
					        									<div class="col-md-2 mb-25 d-flex aling-items-center">
					        										<label for="seed_method" class="color-dark fw-500 align-center mt-1">생산방법</label>
					        									</div>
					        									<div class="col-md-4 mb-25">
					        										<select class="form-control b-light" name="seed_method">
										                                <option value="">생산 방법 선택</option>
										                                <option value="시험연구">시험연구</option>
										                                <option value="증식">증식</option>
										                                <option value="구매">구매</option>
										                                <option value="외부농가">외부농가</option>
										                            </select>
					        									</div>
					        									<div class="col-md-2 mb-25 d-flex aling-items-center">
								                                    <label for="seed_amount" class="color-dark fw-500 align-center">수량(개수)<span style="color: red;">*</span></label>
								                                </div>
								                                <div class="col-md-2 mb-25">
					        										<input type="number" class="form-control b-light" id="seed_amount">
					        									</div>
					        									<div class="col-md-2 mb-25">
					        										<select class="form-control b-light" name="each" id="eaches_id">
										                                <option disabled="disabled" selected="selected" hidden="hidden">단위 선택</option>
										                                <th:block th:each="eaches : ${eaches}">
										                                	<option th:value="${eaches.eaches_id}" th:text="${eaches.eaches_name}"></option>
										                                </th:block>
										                            </select>
					        									</div>
					        								</div>
					        								<div class="row">
					        									<div class="col-md-2 mb-25 d-flex aling-items-center">
					        										<label for="ware_id" class="color-dark fw-500 align-center mt-1">저장장소<span style="color: red;">*</span></label>
					        									</div>
					        									<div class="col-md-4 mb-25">
					        										<select class="form-control b-light" name="ware_id" id="ware_id">
										                                <option disabled="disabled" selected="selected" hidden="hidden">저장 장소 선택</option>
										                                <th:block th:each="ware : ${warehouse}">
										                                	<option th:value="${ware.ware_id}" th:text="${ware.warehouse}"></option>
										                                </th:block>
										                            </select>
					        									</div>
					        									<div class="col-md-2 mb-25 d-flex aling-items-center">
								                                    <label for="ware_condition" class="color-dark fw-500 align-center">저장조건</label>
								                                </div>
								                                <div class="col-md-4 mb-25">
					        										<input type="text" class="form-control b-light" id="ware_condition" readonly="readonly">
					        									</div>
					        								</div>
					        								<div class="row">
					        									<div class="col-md-2 mb-25 d-flex aling-items-center">
					        										<label for="seed_comment" class="color-dark fw-500 align-center">Comment</label>
					        									</div>
					        									<div class="col-md-10 mb-25">
					        										<textarea class="form-control" id="seed_comment" rows="5"></textarea>
					        									</div>
					        								</div>
					        							</div>
					        							<div class="col-12 ml-1">
													        <div class="row">
													        	<div style="font-size: 17px; color: initial;">기타정보</div>
													        </div>
												        </div>
												        <div class="col-12">
					        								<div class="row mt-1">
					        									<div class="col-md-2 mb-25 d-flex aling-items-center">
								                                    <label for="seed_sender" class="color-dark fw-500 align-center">발송인 정보</label>
								                                </div>
								                                <div class="col-md-4 mb-25">
					        										<select class="form-control b-light" name="seed_sender" id="seed_sender">
										                                <option th:value=0>발송인 선택</option>
										                                <th:block th:each="user : ${user}">
										                                	<option th:value="${user.user_id}" th:text="${user.user_name}"></option>
										                                </th:block>
										                            </select>
					        									</div>
					        									<div class="col-md-2 mb-25 d-flex aling-items-center">
					        										<label for="seed_receiver" class="color-dark fw-500 align-center mt-1">수취인 정보</label>
					        									</div>
					        									<div class="col-md-4 mb-25">
					        										<input type="text" class="form-control b-light" id="seed_receiver">
					        									</div>
					        								</div>
					        								<div class="row">
					        									<div class="col-md-2 mb-25 d-flex aling-items-center">
								                                    <label for="send_date" class="color-dark fw-500 align-center">발송일자</label>
								                                </div>
								                                <div class="col-md-4 mb-25">
					        										<input type="text" class="form-control b-light" id="send_date">
					        									</div>
					        									<div class="col-md-2 mb-25 d-flex aling-items-center">
					        										<label class="color-dark fw-500 align-center mt-1">수취일자</label>
					        									</div>
					        									<div class="col-md-4 mb-25">
					        										<input type="text" class="form-control b-light" id="receive_date" readonly="readonly">
					        									</div>
					        								</div>
					        							</div>
					        						</div>
					        					</div>
				        					</div>
			                        	</div>
			                    	</div>
				        		</div>
				        		<div class="d-flex justify-content-end mr-20 mb-20">
				                	<a href="#" class="btn btn-default btn-success">+추가</a>
				                </div>
				        	</div>
			        	</form>
			        	<div class="d-flex justify-content-end mt-20">
		                	<a href="/data/seed" class="btn btn-light btn-default btn-primary mr-10">목록</a>
		                	<a href="#" class="btn btn-default btn-primary" onclick="insertBtn();">등록</a>
		                </div>
			        </div>
		        </div>
		        <div class="atbd-notice" id="success_popup" style="width:100vw; height:90vh; position:fixed; left:0px; top:0px; display:none; justify-content: center; align-items:center;">
		        	<div class="card card-default card-md mb-4" style="border:1px solid #eee; width: 30%; height: 40%;">
		        		<div class="card-body">
		        			<div class="atbd-notice__content">
		        				<div class="atbd-notice__top text-center">
		        					<div class="atbd-notice__icon bg-success">
		        						<i class="fas fa-check color-white"></i>
		        					</div>
		        					<div class="atbd-notice__text">
		        						<h4>등록이 완료되었습니다.</h4>
		        					</div>
		        					<div style="display: flex; justify-content: center; margin: 10% auto;">
		        						<a class="btn btn-default btn-success" href="/data/seed" style="color: #FFFFFF;">확인</a>
		        					</div>
		        				</div>
		        			</div>
		        		</div>
		        	</div>
		        </div>
		    </div>
			
			<div class="modal-basic modal fade show" id="seedModal" tabindex="-1" role="dialog" aria-hidden="true">
			    <div class="modal-dialog modal-md" role="document">
			        <div class="modal-content modal-bg-white">
			        	<div class="modal-header">
			        		<h6 class="modal-title">엑셀 업로드</h6>
		                    	<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		                        	<span data-feather="x"></span>
		                        </button>
			        	</div>
			            <div class="modal-body">
			            	<div class="col-12">
				            	<form action="#">
				            		<div class="row">
				            			<div class="col-sm-3 d-flex aling-items-center mt-4">
		                                    <label class="color-dark align-center">엑셀 파일</label>
		                                </div>
		                                <div class="col-sm-5 mb-2">
		                                	<label for="uploadFile"></label>
		                                    <input type="file" id="uploadFile">
		                                </div>
				            		</div>
				            		<div class="button-group d-flex justify-content-end">
					                   <button class="btn btn-primary btn-default btn-squared">업로드</button>
					           		</div>
				            	</form>
			            	</div>
			            </div>
			        </div>
			    </div>
			</div>
		    <!-- ends: .modal-Basic -->
		    
		    <!-- 품종/유전정보 선택 modal -->
		    <div class="modal-basic modal fade show" id="geneticModal" tabindex="-1" role="dialog" aria-hidden="true">
			    <div class="modal-dialog modal-xl" role="document">
			        <div class="modal-content modal-bg-white">
			        	<div class="modal-header">
			        		<h6 class="modal-title">품종/유전정보 선택</h6>
		                    	<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		                        	<span data-feather="x"></span>
		                        </button>
			        	</div>
			            <div class="modal-body">
			            	<div class="col-12">
				            	<div class="row">
				            		<div class="col-md-2 d-flex aling-items-center">
	                                    <label class="color-dark align-center">품종/유전정보 선택</label>
	                                </div>
				            		<div class="col-md-4">
					            		<div class="radio-horizontal-list d-flex">
					            			<div class="radio-theme-default custom-radio">
					            				<input class="radio" type="radio" name="radio" value=0 id="division_radio" checked="checked">
	                                            <label for="division_radio">
	                                                <span class="radio-text">품종</span>
	                                            </label>
					            			</div>
					            			<div class="radio-theme-default custom-radio">
					            				<input class="radio" type="radio" name="radio" value=1 id="genetic_radio">
	                                            <label for="genetic_radio">
	                                                <span class="radio-text">유전자원명</span>
	                                            </label>
					            			</div>
					            			<div class="radio-theme-default custom-radio">
					            				<input class="radio" type="radio" name="radio" value=2 id="etc_radio">
	                                            <label for="etc_radio">
	                                                <span class="radio-text">기타</span>
	                                            </label>
					            			</div>
					            		</div>
				            		</div>
				            	</div>
				            	<div class="row mt-2" id="division_row">
				            		<div class="col-md-2 mb-25 d-flex aling-items-center">
   										<label for="division_slt" class="color-dark fw-500 align-center mt-1">작목</label>
   									</div>
     								<div class="col-md-4 mb-25">
     									<select class="form-control b-light" name="division_slt" id="division_slt">
			                                <option value="0" disabled="disabled" selected="selected" hidden="hidden">작목명을 선택하세요</option>
			                                <th:block th:each="division : ${division}">
			                                	<option th:value="${division.division_id}" th:text="${division.division}"></option>
			                                </th:block>
		                            	</select>
     								</div>
     								<div class="col-md-6 d-flex" id="division_col">
	     								<div class="col-md-4 mb-25 d-flex aling-items-center">
	   										<label class="color-dark fw-500 align-center mt-1 genetic_title">품종</label>
	   									</div>
	     								<div class="col-md-8 mb-25">
	     									<select class="form-control b-light genetic_input">
				                                <option value="0">품종명을 선택하세요</option>
			                            	</select>
	     								</div>
     								</div>
     								<div class="col-md-6 d-flex" id="genetic_col">
	     								<div class="col-md-4 mb-25 d-flex aling-items-center">
	   										<label class="color-dark fw-500 align-center mt-1 genetic_title">유전자원명</label>
	   									</div>
	     								<div class="col-md-8 mb-25">
	     									<select class="form-control b-light genetic_input">
				                                <option value="0">유전자원명을 선택하세요</option>
			                            	</select>
	     								</div>
     								</div>
     								<div class="col-md-6 d-flex" id="etc_col">
	     								<div class="col-md-4 mb-25 d-flex aling-items-center">
	   										<label class="color-dark fw-500 align-center mt-1 genetic_title">기타</label>
	   									</div>
	     								<div class="col-md-8 mb-25">
	     									<select class="form-control b-light genetic_input">
				                                <option value="0">기타를 선택하세요</option>
			                            	</select>
	     								</div>
     								</div>
				            	</div>
				            	<div class="button-group d-flex justify-content-end">
				                   <button class="btn btn-primary btn-default btn-squared" id="input_btn">사용</button>
				           		</div>
			            	</div>
			            </div>
			        </div>
			    </div>
			</div>
		    <!-- ends: 품종/유전정보 선택 modal -->
     
     	</div>
     
     </main>
     
     <!-- 공통 하단 -->
    <th:block th:include="@{/fragments/footer.html}"></th:block>
    <!-- 공통 js -->
    <th:block th:include="@{/fragments/commonjs.html}"></th:block>

<script type="text/javascript">
	
	var division_col = $("#division_col");
	var genetic_col = $("#genetic_col");
	var etc_col = $("#etc_col");
	
	var division_row = $("#division_row");
	
	var col_arr = new Array();
	col_arr[0] = division_col;
	col_arr[1] = genetic_col;
	col_arr[2] = etc_col;
	
	//품종, 유전정보 모달에서 선택박스 선택 이벤트
	$("input:radio[name=radio]").on("change", function(){
		$("#division_slt").val(0).prop("selected",true);
		if($("#division_radio").is(':checked')){
			genetic_col.remove();
			etc_col.remove();
			var str = col_arr[0];
			division_row.append(str);
		}else if($("#genetic_radio").is(':checked')){
			division_col.remove();
			etc_col.remove();
			var str = col_arr[1];
			division_row.append(str);
		}else if($("#etc_radio").is(':checked')){
			genetic_col.remove();
			division_col.remove();
			var str = col_arr[2];
			division_row.append(str);
		}
	});//end 품종, 유전정보 선택 이벤트
	
	//작목명 선택할때 마다 품종 리스트 변경
	$("#division_slt").on("change", function(){
		var division_id = $(this).val();
		var genetic_type = $("input:radio[name=radio]:checked").val();
		var data = {"division_id" : division_id, "genetic_type" : genetic_type};
		
		$.ajax({
			url : "/data/seed/selectGenetic",
			method : "POST",
			dataType : "json",
			data : data,
			success : function(genetic){
				
				var genetic_input = $(".genetic_input");
				var add_list = "";
				
				if($("input:radio[name=radio]:checked").val() == 0){
					add_list += '<option value="0">'+'품종명을 선택하세요'+'</option>';
				}else if($("input:radio[name=radio]:checked").val() == 1){
					add_list += '<option value="0">'+'유전자원명을 선택하세요'+'</option>';
				}else if($("input:radio[name=radio]:checked").val() == 2){
					add_list += '<option value="0">'+'기타를 선택하세요'+'</option>';
				}
				
				
				for(var i = 0; i < genetic.length; i++){
					add_list += '<option value="' + genetic[i].genetic_id + '">' + genetic[i].genetic + '</option>';
				}//end for
				
				genetic_input.empty();
				genetic_input.append(add_list);
				
			}//end success
		});//end ajax
		
	});//end 작목명 선택 이벤트
	
	//품종, 유전정보 등록 버튼 이벤트
	$("#input_btn").on("click", function(){
		var genetic_id = $(".genetic_input").val();
		var str1 = $("#division_slt option:selected").text();
		var str2 = $(".genetic_input option:selected").text();
		var str = str1 + " > " + str2;
		
		$("#genetic").val(str);
		$("#geneticModal").modal("hide");
	});
	
	//과제 비연계 이벤트
	$("#not_report").on("change", function(){
		if($("#not_report").is(':checked')){
			$("#report_id").val(0).prop("checked", true);
			$("#report_id").prop("disabled", true);
		}else{
			$("#report_id").prop("disabled", false);
		}
	});

	//modal show
	$("#excelBtn").on("click", function(){
		$("#seedModal").modal("show");
	});
	
	//품종, 유전자정보 모달 show
	$("#genetic").on("click", function(){
		$("#geneticModal").modal("show");
		genetic_col.remove();
		etc_col.remove();
	});
	
	//시료 등록
	function insertBtn(){
		
		var seed_manager = $.trim($("#seed_manager").val());
		var seed_area = $.trim($("#seed_area").val());
		var seed_year = $.trim($("#seed_year").val());
		var seed_method = $.trim($("#seed_method").val());
		var seed_amount = $.trim($("#seed_amount").val());
		var eaches_id = $.trim($("#eaches_id").val());
		var seed_comment = $.trim($("#seed_comment").val());
		var genetic_id = $.trim($(".genetic_input").val());
		var report_id = $.trim($("#report_id").val());
		var seed_report = $.trim($("#seed_report").val());
		var ware_id = $.trim($("#ware_id").val());
		var seed_sender = $.trim($("#seed_sender").val());
		var send_date = $.trim($("#send_date").val());
		var seed_receiver = $.trim($("#seed_receiver").val());
		
		if(genetic_id == 0){
			alert("품종/유전자 정보를 선택해주세요.");
			$("#genetic_id").focus();
		}else if(seed_manager == ""){
			alert("담당자를 선택해주세요.");
			$("#seed_manager").focus();
		}else if(seed_area == ""){
			alert("생산지역을 입력해주세요.");
			$("#seed_area").focus();
		}else if(seed_year == ""){
			alert("생산연도를 입력해주세요.");
			$("#seed_year").focus();
		}else if(seed_amount == ""){
			alert("수량을 입력해주세요.");
			$("#seed_amount").focus();
		}else if(ware_id == 0){
			alert("저장장소를 선택해주세요.");
			$("#ware_id").focus();
		}else{
			var data = {
						"seed_manager" : seed_manager,
						"seed_area" : seed_area,
						"seed_year" : seed_year,
						"seed_method" : seed_method,
						"seed_amount" : seed_amount,
						"eaches_id" : eaches_id,
						"seed_comment" : seed_comment,
						"genetic_id" : genetic_id,
						"report_id" : report_id,
						"seed_report" : seed_report,
						"ware_id" : ware_id,
						"seed_sender" : seed_sender,
						"send_date" : send_date,
						"seed_receiver" : seed_receiver
						};
			
			$.ajax({
				url : "/data/seed/insertSeed",
				method : "POST",
				dataType : "json",
				data : data,
				success : function(result){
					if(result == 0){
						
					}else {
						$("#success_popup").css("display", "flex");
					}
				}
			});//end ajax
		}//end else
		
	}//end 시료 등록
	
	//발송일자 datepicker
	$("#send_date").datepicker({
		dateFormat: "yy-mm-dd",
      	duration: "medium",
      	changeMonth: true,
      	changeYear: true,
      	yearRange: "2010:2030",
	});
	
</script>

</body>

</html>