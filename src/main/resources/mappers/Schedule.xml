<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.digitalBook.Mapper.ScheduleMapper">
	<!-- 전체 일정(사용자) -->
	<select id="SelectUserSchedule" parameterType="int" resultType="Schedule">
		SELECT s.sch_id, s.start_date, s.end_date, p.plan_id, p.plan_code, m.method_id, m.method_code, m.method_title, u1.user_name_k AS u1_supervisor, u2.user_name_k AS u2_manager
		FROM schedule s
		LEFT JOIN plan p ON s.plan_id = p.plan_id
		LEFT JOIN method m ON s.method_id = m.method_id
		LEFT JOIN user u1 ON s.sch_supervisor = u1.user_id
		LEFT JOIN user u2 ON s.sch_manager = u2.user_id
		WHERE s.sch_supervisor = #{user_id} OR s.sch_manager = #{user_id}
	</select>
	
	<!-- 전체 일정(사용자) -->
	<select id="SelectAdminSchedule" parameterType="User" resultType="Schedule">
		SELECT s.sch_id, s.start_date, s.end_date, p.plan_id, p.plan_code, m.method_id, m.method_code, m.method_title, u1.user_name_k AS u1_supervisor, u2.user_name_k AS u2_manager
		FROM schedule s
		LEFT JOIN plan p ON s.plan_id = p.plan_id
		LEFT JOIN method m ON s.method_id = m.method_id
		LEFT JOIN user u1 ON s.sch_supervisor = u1.user_id
		LEFT JOIN user u2 ON s.sch_manager = u2.user_id
		WHERE p.user_group = #{user_group}
	</select>
	
	<select id="SelectScheduleDetail" parameterType="int" resultType="Schedule">
		SELECT s.sch_id, s.start_date, s.end_date, p.plan_id, p.plan_code, m.method_id, m.method_code, m.method_title, u1.user_name_k AS u1_supervisor, u2.user_name_k AS u2_manager
		FROM schedule s
		LEFT JOIN plan p ON s.plan_id = p.plan_id
		LEFT JOIN method m ON s.method_id = m.method_id
		LEFT JOIN user u1 ON s.sch_supervisor = u1.user_id
		LEFT JOIN user u2 ON s.sch_manager = u2.user_id
		WHERE s.sch_id = #{sch_id}
	</select>
	
	<!-- 전달사항 갯수 조회 -->
	<select id="SearchBoardCount" resultType="int">
		SELECT count(*) FROM board
		WHERE user_group = #{user_group}
		<choose>
			<when test="!search_type.equals('none')">
				AND #{search_type} LIKE CONCAT('%', #{keyword}, '%')
			</when>
		</choose>
	</select>
	
	<!-- 전달사항 검색 -->
	<select id="SearchBoard" resultType="board">
		SELECT * FROM board b
		LEFT JOIN user u ON b.user_id = u.user_id
		LEFT JOIN department d ON b.user_group = d.depart_id
		WHERE b.user_group = #{user_group} 
		<choose>
			<when test="!search_type.equals('none')">
				AND #{search_type} LIKE CONCAT('%', #{keyword}, '%')
			</when>
		</choose>
	</select>
	
	<!-- 전달사항 공유인원 조회 -->
	<select id="SelectShareBoard" parameterType="int" resultType="User">
		SELECT user_id, user_name_k
		FROM user
		WHERE user_group = #{user_group} OR user_id = #{user_id}
	</select>
	
	<!-- 전달사항 조회 -->
	<select id="SelectBoard" resultType="board">
		SELECT * FROM board
		WHERE user_group = #{user_group} 
	</select>
	
	<!-- 전달사항 상세 조회 -->
	<select id="SelectBoardId" parameterType="int" resultType="Board">
		SELECT * FROM board
		where board_id = #{board_id}
	</select>
	
	<!-- 전달사항 등록 -->	
	<insert id="InsertBoard" parameterType="Board">
		INSERT INTO board
		(board_title, board_start,board_end, board_content, board_share, user_id, user_group, create_date, modify_date)
		VALUES
		(#{board_title}, #{board_start}, #{board_end}, #{board_content}, #{board_share}, #{user_id},#{user_group}, NOW(), NOW())
	</insert>

	<!-- 전달사항 수정 -->
	<update id="UpdateBoard" parameterType="Board">
		UPDATE board 
		SET board_title= #{board_title}, board_start = #{board_start}, board_end = #{board_end}, board_content = #{board_content}, board_share = #{board_share}, modify_date = NOW()
		WHERE board_id = #{board_id}
	</update>

	<!-- 전달사항 삭제 -->
	<delete id="DeleteBoard" parameterType="int">
		DELETE FROM board
		WHERE board_id = #{board_id}
	</delete>
</mapper>