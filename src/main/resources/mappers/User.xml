<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.digitalBook.Mapper.UserMapper">
	
	<!-- 사용자 검색 -->
	<select id="searchUser" resultType="User">
		SELECT u.*, d1.*, d2.*, d3.*, d4.*, d1.department as d1_department_name FROM user u
		LEFT JOIN department d1 ON u.depart_id = d1.depart_id
		LEFT JOIN department d2 ON d1.depart_parents = d2.depart_id
		LEFT JOIN department d3 ON d2.depart_parents = d3.depart_id
		LEFT JOIN department d4 ON d3.depart_parents = d4.depart_id
		WHERE 1=1
		<choose>
			<when test="search_type == null || search_type.equals('none')">
				
			</when>
			<otherwise>
				AND ${search_type} LIKE CONCAT('%', #{keyword}, '%')
			</otherwise>
		</choose>
		ORDER BY user_id DESC
		LIMIT #{offset}, #{limit}
	</select>
	
	<select id="searchUserCount" resultType="int">
		SELECT COUNT(*) FROM user u
		LEFT JOIN department d1 ON u.depart_id = d1.depart_id
		LEFT JOIN department d2 ON d1.depart_parents = d2.depart_id
		LEFT JOIN department d3 ON d2.depart_parents = d3.depart_id
		LEFT JOIN department d4 ON d3.depart_parents = d4.depart_id
		WHERE 1=1
		<choose>
			<when test="search_type == null || search_type.equals('none')">
				
			</when>
			<otherwise>
				AND ${search_type} LIKE CONCAT('%', #{keyword}, '%')
			</otherwise>
		</choose>
	</select>
	
</mapper>