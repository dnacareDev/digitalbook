<!DOCTYPE html>
<html lang="en" dir="ltr"
	xmlns:th="http://www.thymeleaf.org">
<head>
<title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<style>
.chart-wrap {
  width: 600px;
  height: 150px;
  font-family: sans-serif;
  font-size: 14px;
}
.chart-wrap .title {
  text-align: center;
}
.grid {
  width: 80%;
  height: 100%;
  display: flex;
  flex-direction: row;
  justify-content: center;
  border-bottom: 2px solid #aaa;
  background: repeating-linear-gradient(0deg, transparent, transparent 19.5%, rgba(170, 170, 170, 0.7) 20%);
}
.grid .bar {
  background-color: #F16335;
  width: 45px;
  height: var(--bar-value);
  align-self: flex-end;
  margin: 0 auto;
  border-radius: 3px 3px 0 0;
  position: relative;
}
.grid .bar.bar:hover {
  opacity: 0.7;
}
.grid .bar::after {
  content: attr(data-name);
  top: -3em;
  padding: 10px;
  display: inline-block;
  white-space: nowrap;
  position: absolute;
  transform: rotate(-45deg);
}
.grid.horizontal {
  flex-direction: column;
  border-bottom: none;
  border-left: 2px solid #aaa;
  background: repeating-linear-gradient(90deg, transparent, transparent 19.5%, rgba(170, 170, 170, 0.7) 20%);
}
.grid.horizontal .bar {
  height: 20px;
  width: var(--bar-value);
  align-self: flex-start;
  margin: auto 0 auto 0;
  border-radius: 0 3px 3px 0;
}
.grid.horizontal .bar::after {
  top: initial;
  left: 100%;
  padding: 0 10px;
  display: inline-block;
  white-space: nowrap;
  position: absolute;
  transform: rotate(0deg);
  line-height: 20px;
}
</style>
<style type="text/css">
	.id_color1 td {
		color : #fff !important;
	}
	.id_color6 td {
		color : #fff !important;
	}
	.id_color8 td {
		color : #fff !important;
	}
	.id_color9 td {
		color : #fff !important;
	}
	.id_color10 td {
		color : #fff !important;
	}
	.id_color1{
		color : #fff !important;
		background-color: #0064FF !important;
	}
	.id_color2{
		background-color: #B2FA5C !important;
	}
	.id_color3{
		background-color: #2CE0BC !important;
	}
	.id_color4{
		background-color: #FF6A89 !important;
	}
	.id_color5{
		background-color: #FF82FF !important;
	}
	.id_color6{
		color : #fff!important;
		background-color: #BE2457 !important;
	}
	.id_color7{
		background-color: #FFBE0A !important;
	}
	.id_color8{
		color : #fff!important;
		background-color: #D27328 !important;
	}
	.id_color9{
		color : #fff!important;
		background-color: #8B4F1D !important;
	}
	.id_color10{
		color : #fff!important;
		background-color: #CD0000 !important;
	}
	.font_sub_title{
		font-size: 15px !important;
	}
	
	.select-hide{
		display: none;
	}
	.select-show{
		display: block;
	    position: absolute;
	    z-index :10;
	    top: 45px;
	    width: 85%;
	    background-color: white;
	    border:1px solid;
	    border-radius: 5px;
	    cursor: pointer;
	    overflow-y: auto;
	    height: 125px;
	}
	
	/*.select {
		width: 700px;
	} */
	
	.select .select-show li{
	    padding:0 0 0 5px;
	    line-height: 30px;
	}
	.content-center{justify-content: start !important}
	[id *="_popup"]{
		width:100vw; 
		height:90vh; 
		position:fixed; 
		left:0px; 
		top:0px; 
		display:none; 
		justify-content: center; 
		align-items:center; 
		z-index: 999999;
	}
	[id *="_popup"] > .card.card-default.card-md.mb-4{
		border:1px solid #eee;
		width:400px;
		max-width: 400px;
	}
	
	.file-upload {
  background-color: #ffffff;
  width: 600px;
  margin: 0 auto;
  padding: 20px;
}

.file-upload-btn {
  width: 100%;
  margin: 0;
  color: #fff;
  background: #1FB264;
  border: none;
  padding: 10px;
  border-radius: 4px;
  border-bottom: 4px solid #15824B;
  transition: all .2s ease;
  outline: none;
  text-transform: uppercase;
  font-weight: 700;
}

.file-upload-btn:hover {
  background: #1AA059;
  color: #ffffff;
  transition: all .2s ease;
  cursor: pointer;
}

.file-upload-btn:active {
  border: 0;
  transition: all .2s ease;
}

.file-upload-content {
  display: none;
  text-align: center;
}

.file-upload-input {
  position: absolute;
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  outline: none;
  opacity: 0;
  cursor: pointer;
}

.image-upload-wrap {
  margin-top: 20px;
  border: 4px dashed #1FB264;
  position: relative;
}

.image-dropping,
.image-upload-wrap:hover {
  background-color: #1FB264;
  border: 4px dashed #ffffff;
}

.image-title-wrap {
  padding: 0 15px 15px 15px;
  color: #222;
}

.drag-text {
  text-align: center;
}

.drag-text h3 {
  font-weight: 100;
  text-transform: uppercase;
  color: #15824B;
  padding: 60px 0;
}

.file-upload-image {
  max-height: 200px;
  max-width: 200px;
  margin: auto;
  padding: 20px;
}

.remove-image {
  width: 200px;
  margin: 0;
  color: #fff;
  background: #cd4535;
  border: none;
  padding: 10px;
  border-radius: 4px;
  border-bottom: 4px solid #b02818;
  transition: all .2s ease;
  outline: none;
  text-transform: uppercase;
  font-weight: 700;
}

.remove-image:hover {
  background: #c13b2a;
  color: #ffffff;
  transition: all .2s ease;
  cursor: pointer;
}

.remove-image:active {
  border: 0;
  transition: all .2s ease;
}
</style>
<!-- 공통 헤더 -->
<th:block th:include="/../fragments/header.html"></th:block>
<link rel="stylesheet" href="/../assets/vendor_assets/css/plan-result.css">

<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>

</head>
<body class="layout-light top-menu overlayScroll">

    <div id="fl"></div>
    <div id="target">Right-click</div>
        
        
	<div class="mobile-search"></div>
	
	<div class="mobile-author-actions"></div>
	
	<!-- 공통 topbar -->
	<th:block th:include="/../fragments/topbar.html"></th:block>
	
	<main class="main-content" style="background-color: #F9FBFD;">
		
		<div class="contents" style="background-color: #F9FBFD; padding: 74px 0">
			
			<div class="container-fluid">
                
			    <div class="wrapper clearfix">
			    	<div class="row"> <!-- section 위에 -->
				        <div class="col-lg-12">
				        	<div class="breadcrumb-main" style="padding:0;">
				        		<h4 class="text-capitalize breadcrumb-title">결과입력</h4>
				        		<span class="ml-20 mt-1 font_sub_title">재배관리 - 결과입력</span>
				        	</div>
				        	<div id="qrcode" style="display: none;"></div>
				        	<button type="button" id="qrBtn">QR출력</button>
				        </div>
			       </div>
			        <section id="section" class="section_result">
			            <div class="step" id="step1">
			                <div class="step_inner clearfix" id="step1_inner">
			                    <div class="title">
			                        <h3>구획정보<span></span></h3>
			                    </div>
			                    <div class="content clearfix">
			                        <div class="left_content step4-container" id="segment_list" style="height:450px !important; overflow-y:auto !important;">
			                           
			                        </div>
			                        <div class="right_content">
			                            <div class="img_inner">
			                                <div class="background-wrap">
			                                    <ul id="step4-segment">
			                                        
			                                    </ul>
			                                </div>
			                            </div>
			                        </div>
			                        <div class="bottom_right-content clearfix" style="padding:20px 0"> <!-- 2021-11-01 추가  -->
			                        	<div class="left_type">
			                        		<span style="vertical-align:middle;"><span class="red">*</span>개채수</span>
				                            <input type="text" id="rowNum">
				                            <button type="button" onclick="addRow()">확인</button>
			                        	</div>
			                        	<div class="right_type">
			                        		<div class="right_type_cover">
			                        			<div class="select" style="height: auto;">
				                            		<input type="text" onkeyup="textfilter(this);" onclick="selectFilter(this);" name="select-input" data-select="" class="form-control" id="segment_option" placeholder="구획 선택" autocomplete="off">
				                            		<ul class="select-hide" style="width: 40% !important">
				                            			
				                            		</ul>
				                            	</div>
			                        			<!-- <select id="segment_option">
			                        				
				                        		</select> -->
				                        		<button type="button" onclick="checkSelectbox();">확인</button>
			                        		</div>
			                        	</div>
			                        </div>
			                        
			                        <div class="bottom_content" style="width: 100%; ">
					                     <h3 style="float:left;" id="result_title"></h3>
			               	 			<div style="width:100%;" id="grid"></div>
			                        </div>
			                        
			                        <div class="bottom_content" style="display:none; padding: 20px 0">
			                            <div class="title clearfix" style="padding: 20px 0;">
					                    </div>
			                            <table id="step1_table" style="width: max-content; min-width:500px;">
			                                
			                            </table>
			                        </div>
			                        
			                        <div class="submit_btn">
			                            <button class="type1" onclick="confirminsertResult();">저장</button>
			                        </div>
			                    </div>
			                </div>
			            </div>
			            <div class="step" id="step2">
			                <div class="step_inner clearfix" id="step2_inner">
			                    <div class="title">
			                        <h3>구획정보확인<span></span></h3>
			                    </div>
			                    <div class="content clearfix">
			                        <div class="content-center">
			                            <div class="content_box">
				                            <div class="bottom_right-content clearfix"> <!-- 2021-11-01 추가  -->
						                      	<div class="left_type" style="width:60%;">
						                      		<span><span class="red">*</span>기준개채수</span>
						                           	<input type="text" id="segment_num" value="10">
						                           	<button type="button" id="segment_check" style="width:90.88px">확인</button>
						                      	</div>
						                    </div>
			                                <ul class="sangtaeLi clearfix">
			                                    <li id="sangtae_list">
			                                        
			                                    </li>
			                                </ul>
			                            </div>
			                        </div>
			                        <div class="submit_btn">
			                            <button class="type1" onclick="confirminsertSegmentInfo();">저장</button>
			                        </div>
			                    </div>
			                </div>
			            </div>
			            <div class="step" id="step3">
			                <div class="step_inner clearfix" id="step3_inner">
			                    <div class="title">
			                        <h3>토양/기상 정보<span></span></h3>
			                    </div>
			                    <div class="content clearfix">
			                        <div class="content-center">
			                            <div class="content_box">
			                                <span class="sub_title-content bold_text">토양정보(수동조회)</span>
			                                <table>
			                                    <thead>
			                                        <tr>
			                                            <th>산도(ph)</th>
			                                            <th>유효인산(mg/kg)</th>
			                                            <th>유효규산(mg/kg)</th>
			                                            <th>유기물(g/kg)</th>
			                                            <th>마그네슘(cmol+/kg)</th>
			                                            <th>칼륨(cmol+/kg)</th>
			                                            <th>칼슘(cmol+/kg)</th>
			                                            <th>전기전도도(dS/m)</th>
			                                        </tr>
			                                    </thead>
			                                    <tbody>
			                                        <tr>
			                                            <td>6.6</td>
			                                            <td>28</td>
			                                            <td>1</td>
			                                            <td>1</td>
			                                            <td>1</td>
			                                            <td>1</td>
			                                            <td>1</td>
			                                            <td>1</td>
			                                        </tr>
			                                    </tbody>
			                                </table>
			                            </div>
			                            <div class="content_box">
			                                <span class="sub_title-content bold_text">토양정보(수동조회)</span>
			                                <table>
			                                    <thead>
			                                        <tr>
			                                            <th>강수량</th>
			                                            <th>증발량</th>
			                                            <th>풍속(150CM)</th>
			                                            <th>풍속(300CM)</th>
			                                            <th>결로시간</th>
			                                            <th>초상온도</th>
			                                            <th>습도(150CM)</th>
			                                            <th>습도(400CM)</th>
			                                        </tr>
			                                    </thead>
			                                    <tbody>
			                                        <tr>
			                                            <td>0.0mm</td>
			                                            <td>Xmm</td>
			                                            <td>3.0</td>
			                                            <td>3.0</td>
			                                            <td>0.0hr</td>
			                                            <td>-3.2℃</td>
			                                            <td>26.4%</td>
			                                            <td>26.4%</td>
			                                        </tr>
			                                    </tbody>
			                                </table>
			                            </div>
			                        </div>
			                        <div class="submit_btn">
			                            <button class="type1">저장</button>
			                        </div>
			                    </div>
			                </div>
			            </div>
			        </section>
			        <div class="row mt-3">
						<div class="col-lg-12" style="padding-left: 65px; padding-right: 65px;">
							<div class="card card-default" style="padding: 0 30px;">
								<div class="row ml-3 mt-3" style="margin:0 !important; padding: 35px 20px 22px 20px">
									<span class="color-dark align-center" style="font-weight: 700; color: #2c2c2c">변경 이력</span>
								</div>
								<div class="card-body" style="height: 325px; overflow-y: auto; padding-top: 0; padding-left:10px">
									<div class="row">
										<div class="col-lg-12" style="padding-left: 15px;">
											<ul>
												<th:block th:each="r : ${record}">
													<li class="mt-2">
														<span class="avatar avatar-success avatar-md avatar-circle" style="float: left;">
			                                                   <span class="avatar-icon" data-feather="check"></span>
			                                               </span>
														<div>
															<span class="font-weight-bold mb-0">생육조사계획 : </span>
															<span class="font-weight-bold mb-0" th:text="${r.record_type_code}"></span>
															<th:block th:switch="${r.record_status}">
																<span th:case="0" class="font-weight-bold mb-0">승인요청</span>
																<span th:case="1" class="font-weight-bold mb-0">수정요청</span>
																<span th:case="2" class="font-weight-bold mb-0">승인</span>
															</th:block>
														</div>
														<small th:text="${r.record_date}"></small>
													</li>
												</th:block>
											</ul>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
			    </div>
			</div>
		</div>
		
		<div class="atbd-notice" id="results_success_popup">
        	<div class="card card-default card-md mb-4">
        		<div class="card-body">
        			<div class="atbd-notice__content">
        				<div class="atbd-notice__top text-center">
        					<div class="atbd-notice__icon bg-success">
        						<i class="fas fa-check color-white"></i>
        					</div>
        					<div class="atbd-notice__text">
        						<h4>저장이 완료되었습니다.</h4>
        					</div>
        					<div style="display: flex; justify-content: center; margin: 10% auto;">
        						<button class="btn btn-default btn-success" onclick="confirmResults();" style="color: #FFFFFF;">확인</button>
        					</div>
        				</div>
        			</div>
        		</div>
        	</div>
        </div>
        
        <div class="atbd-notice" id="results_confirm_popup" >
        	<div class="card card-default card-md mb-4">
        		<div class="card-body">
        			<div class="atbd-notice__content">
        				<div class="atbd-notice__top text-center">
        					<div class="atbd-notice__icon bg-info">
        						<i class="fas fa-exclamation color-white"></i>
        					</div>
        					<div class="atbd-notice__text">
        						<h4>저장 하시겠습니까?</h4>
        					</div>
        					<div style="display: flex; justify-content: center; margin: 10% auto;">
        						<button class="btn btn-default btn-primary mr-10" onclick="insertResult();" style="color: #FFFFFF;">저장</button>
        						<button class="btn btn-default btn-danger" onclick="CancelBtn();" style="color: #FFFFFF;">취소</button>
        					</div>
        				</div>
        			</div>
        		</div>
        	</div>
        </div>
        
        <div class="atbd-notice" id="segmentInfo_success_popup">
        	<div class="card card-default card-md mb-4">
        		<div class="card-body">
        			<div class="atbd-notice__content">
        				<div class="atbd-notice__top text-center">
        					<div class="atbd-notice__icon bg-success">
        						<i class="fas fa-check color-white"></i>
        					</div>
        					<div class="atbd-notice__text">
        						<h4>저장이 완료되었습니다.</h4>
        					</div>
        					<div style="display: flex; justify-content: center; margin: 10% auto;">
        						<button class="btn btn-default btn-success" onclick="confirmSegmentInfo();" style="color: #FFFFFF;">확인</button>
        					</div>
        				</div>
        			</div>
        		</div>
        	</div>
        </div>
        
        <div class="atbd-notice" id="segmentInfo_confirm_popup">
        	<div class="card card-default card-md mb-4">
        		<div class="card-body">
        			<div class="atbd-notice__content">
        				<div class="atbd-notice__top text-center">
        					<div class="atbd-notice__icon bg-info">
        						<i class="fas fa-exclamation color-white"></i>
        					</div>
        					<div class="atbd-notice__text">
        						<h4>저장 하시겠습니까?</h4>
        					</div>
        					<div style="display: flex; justify-content: center; margin: 10% auto;">
        						<button class="btn btn-default btn-primary mr-10" onclick="insertSegmentInfo();" style="color: #FFFFFF;">저장</button>
        						<button class="btn btn-default btn-danger" onclick="CancelBtn();" style="color: #FFFFFF;">취소</button>
        					</div>
        				</div>
        			</div>
        		</div>
        	</div>
        </div>

        <div class="modal-basic modal fade show" id="chanModal2" tabindex="-1" role="dialog" aria-hidden="true" style="display: none">
		    <div class="modal-dialog modal-lg" role="document">
		        <div class="modal-content modal-bg-white">
		            <div class="modal-body">
		            	<div class="row">
			        		<div class="col-12">
			        			<h2 style="float: left;">측정 값</h2>
					        	<div class="d-flex justify-content-end">
			                		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span data-feather="x"></span></button>
			                	</div>
			        		</div>
			        	</div>
		            	<div class="row mt-3">
		            		<div class="col-md-12">
		            			<table>
                                    <thead>
                                    <tr>
                                        <th>일시</th>
                                        <th>색상</th>
                                        <th>기상정보</th>
                                        <th>토양정보</th>
                                        <th>위치정보</th>
                                        <th>사진</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                        <td>2021.08.06</td>
                                        <td>#FFFFCC</td>
                                        <td class="blue"><a href="">view</a></td>
                                        <td class="blue"><a href="">view</a></td>
                                        <td class="blue"><a href="">map</a></td>
                                        <td class="blue"><a href="">view</a></td>
                                    </tbody>
                                </table>
		            		</div>
		            	</div>
			            <div class="row" style="flex-direction:row-reverse; padding: 20px 17px;">
			            	<div class="submit_btn">
                                <ul>
                                    <li><button class="type2">사진 선택</button></li>
                                    <li><button class="type2">사진 선택</button></li>
                                </ul>
                            </div>
			            </div>
		            </div>
		        </div>
		    </div>
		</div>
		
	    <!-- ends: .modal-Basic -->
	    <div class="modal-basic modal fade show" id="imgModal" tabindex="-1" role="dialog" aria-hidden="true" style="display: none">
		    <div class="modal-dialog modal-lg" role="document">
		        <div class="modal-content modal-bg-white">
		            <div class="modal-body">
		            	<div class="row">
			        		<div class="col-12">
			        			<h2 style="float: left;">개체 사진</h2>
					        	<div class="d-flex justify-content-end">
			                		<button onclick='$("#imgShow").attr("src", null)' type="button" class="close" data-dismiss="modal" aria-label="Close"><span data-feather="x"></span></button>
			                	</div>
			        		</div>
			        	</div>
		            	<div class="row mt-3">
		            		<div class="col-md-12">
		            			<img id="imgShow" src="">
		            		</div>
		            	</div>
			            <div class="row" style="flex-direction:row-reverse; padding: 20px 17px;">
			            	<div class="submit_btn">
                                <ul>
                                    <li><a class="type2" href="javascript:0" onclick='$(imageTag).prev().trigger("click");'>저장</a></li>
                                    <li><a class="type2" href="javascript:0" onclick='$("#imgModal").modal("hide");'>확인</a></li>
                                    <li><a class="type2" id="downImg" href="">다운로드</a></li>
                                </ul>
                            </div>
			            </div>
		            </div>
		        </div>
		    </div>
		</div>
		
	    <!-- ends: .modal-Basic -->
	    <div class="modal-basic modal fade show" id="anlModal" tabindex="-1" role="dialog" aria-hidden="true" style="display: none">
		    <div class="modal-dialog modal-lg" role="document"  style="max-width: max-content;">
		        <div class="modal-content modal-bg-white">
		        	
		            <div class="modal-body" style="">
		            	<div class="row">
			        		<div class="col-12">
			        			<h2 style="float: left;">이미지 분석</h2>
					        	<div class="d-flex justify-content-end">
			                		<button onclick='' type="button" class="close" data-dismiss="modal" aria-label="Close"><span data-feather="x"></span></button>
			                	</div>
			        		</div>
			        	</div>
		            	<script class="jsbin" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
		            	<div class="file-upload">
							<button class="file-upload-btn" type="button" onclick="$('.file-upload-input').trigger( 'click' )">Add Image</button>
					
							<div class="image-upload-wrap">
								<input class="file-upload-input" type="file" onchange="readURL(this);" accept="image/*">
								<div class="drag-text">
									<h3>Drag and drop a file or select add Image</h3>
								</div>
							</div>
					
							<div class="file-upload-content">
								<img class="file-upload-image" id="face-image" src="#" alt="your image">
								<div class="image-title-wrap">
									<!--<button type="button" onclick="removeUpload()" class="remove-image">Remove
										<span class="image-title">Uploaded Image</span>
									</button> -->
									<a href="javascript:removeUpload();"><font size="3">Remove Upload file : <span class="image-title">Uploaded Image</span></font></a><font size="3"><br>
					
								</font></div><font size="3">
										<div>
										<center><br><button type="button" class="remove-image" onclick="init()">Run Machine Learning</button><br>
							</center></div><br>
								<div class="label-container" id="label-container"></div>
							</font></div><font size="3">
						</font>
						</div>			
					
		            </div>
		        </div>
		    </div>
		</div>
	    <!-- ends: .modal-Basic -->
	    
	</main>
	
	 <!-- 공통 하단 -->
    <th:block th:include="/../fragments/footer.html"></th:block>
    <!-- 공통 js -->
    <th:block th:include="/../fragments/commonjs.html"></th:block>
    <script type="text/javascript" src="/../assets/vendor_assets/js/plan-segment.js"></script>
    <script type="text/javascript" src="/../assets/vendor_assets/js/plan-render.js"></script>
    <script type="text/javascript" src="/../assets/vendor_assets/js/qrcode.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/eligrey/FileSaver.js/5ed507ef8aa53d8ecfea96d96bc7214cd2476fd2/FileSaver.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.js"></script>
 
<script type="text/javascript" th:inline="javascript">
	let plan = /*[[${plan}]]*/ "null";
	let plan_id = /*[[${plan_id}]]*/ "0";
	let method = /*[[${method}]]*/ "null";
	let sch = /*[[${sch}]]*/ "null";
	let results = /*[[${results}]]*/ "null";
	let resultPlan = /*[[${resultPlan}]]*/ "null";
	
	let segment = /*[[${segment}]]*/ "null";
	
	let segmentInfo = /*[[${segmentInfo}]]*/ "null";
	
	//로그인한 user 객체
	let user = /*[[${#authentication.principal}]]*/ "null";

	//시험구 배치 데이터
	let data1 = new Object();
	let data2 = new Object();
	let data3 = new Object();
	
	let resultArray = new Array();

	//결과입력 데이터
	let tableResultArray = new Array();
	
	//구획정보 데이터 
	let segmentResultArray = new Array();
	
	//결과입력 파일 데이터
	let file_array = new Array();
	
	//결과입력 삭제 데이터
	let cancelArr = new Array();
	
	//구획정보 데이터
	let segmentInfo_array = new Array();
	
	//구획정보 삭제 데이터
	let cancelInfo = new Array();
	
	let selectInputEls = document.querySelectorAll('input[name="select-input"]');
	let select_this;
	let select_prev;
	let select_id;
	
	var currentResultIndex = 0;
	var imageTag = null;
	var resultInputTag = null;

	var resultGrid = null;
	var curRow = "0";
	var columnkey = "";

	
	function updateResult(e){
		
	  	  let curColumnIndex = 0;
   	      let curColumnKey = columnkey.split("_")[0];
   	      let curRowArray = tableResultArray[currentResultIndex][curRow];
 	  	  let originData = resultGrid.dataManager.getOriginData()
 	  	 
   	      for(var i = 0;i<curRowArray.length;i++){
   	    	if(curRowArray[i].method_id == curColumnKey){
   	    		curColumnIndex = i;
   	    		break;
   	    	}
   	      }
 	  	  
   	   	  tableResultArray[currentResultIndex][curRow][curColumnIndex].content = e.getAttribute("title");
   	   	  originData[curRow][columnkey] = e.getAttribute("title");

   	      resultGrid.resetData(originData);
  		  $("#anlModal").modal("hide");
   	      
	}
	
	function readURL(input) {
		  if (input.files && input.files[0]) {

		    var reader = new FileReader();

		    reader.onload = function(e) {
		      $('.image-upload-wrap').hide();

		      $('.file-upload-image').attr('src', e.target.result);
		      $('.file-upload-content').show();

		      $('.image-title').html(input.files[0].name);
		    };

		    reader.readAsDataURL(input.files[0]);

		  } else {
		    removeUpload();
		  }
	}

	function removeUpload() {
		  $('.file-upload-input').replaceWith($('.file-upload-input').clone());
		  $('.file-upload-content').hide();
		  $('.image-upload-wrap').show();
		}
		$('.image-upload-wrap').bind('dragover', function () {
				$('.image-upload-wrap').addClass('image-dropping');
			});
			$('.image-upload-wrap').bind('dragleave', function () {
				$('.image-upload-wrap').removeClass('image-dropping');
	});

	
	function selection(){
		if(document.getSelection){
			var selection = document.getSelection();
			
			if(selection.focusNode != null){
				if(selection.focusNode.children != undefined){
					var length = selection.focusNode.children.length;
					if(length != 0){
						var check = selection.focusNode.children[0].name;
						var check2 = selection.focusOffset;
						if(check == "select-input" && check2 == "1"){
							selectFilter(selection.focusNode.children[0]);
						}
					}
				}
			}
			
		}
	}
	
	function selectFilter(e){
		
		var selection = document.getSelection();
		
		select_prev = select_this;
		select_this = e;
		select_id = e.id;
		
		let selectOptionWrapEls = document.querySelectorAll('.select ul');
		
		var currTarget = e;
		var delOption = currTarget.nextElementSibling;
		
		for(var i = 0 ; i < selectOptionWrapEls.length; i++){
			
			if(selectOptionWrapEls[i].classList.contains("select-show")){
				selectOptionWrapEls[i].classList.add('select-hide');
				selectOptionWrapEls[i].classList.remove('select-show');
			}
		}
		
		if(delOption.classList.contains('select-hide')){
			delOption.classList.remove('select-hide');
			delOption.classList.add('select-show');
		}
		
	}
	
	let body = document.querySelector('body');
	function hideSelect(e){
		
		let selectOptionWrapEls = document.querySelectorAll('.select ul');
		var target = e.target.name;
		
		if(target == "select-input"){
			if(select_prev != undefined && select_this != select_prev){
				var prev_attr = select_prev.getAttribute("value");
				var prev_text = select_prev.value;
				if(prev_attr != prev_text){
					select_prev.value = prev_attr;
					var prev_textEl = select_prev.parentNode.children[1].children;
					
					for(var i = 0; i < prev_textEl.length; i++){
						prev_textEl[i].style.display = "flex";
					}
					
					var textEl = select_this.parentNode.children[1].children;
					
					for(var i = 0; i < textEl.length; i++){
						textEl[i].style.display = "flex";
					}
				}
			}
		}
		
		if(target != "select-input"){
			if(select_this != undefined && select_this.value != null){
				var select_attr = select_this.getAttribute("value");
				var select_text = select_this.value;
				
				if(select_attr != select_text && select_this.id == select_id){
					select_this.value = select_attr;
					
					var textEl = select_this.parentNode.children[1].children;
					
					for(var i = 0; i < textEl.length; i++){
						textEl[i].style.display = "flex";
					}
				}
			}
			
			for(var i = 0 ; i < selectOptionWrapEls.length; i++){
				
				if(selectOptionWrapEls[i].classList.contains("select-show")){
					selectOptionWrapEls[i].classList.add('select-hide');
					selectOptionWrapEls[i].classList.remove('select-show');
				}
			}
		}
	}
	body.addEventListener('click',hideSelect);
	body.addEventListener('click', selection);
	
	/* 옵션선택 */
	function selectOpt(e){
	    var dataSelect = $(e).children().attr("data-value");
	    var text = $(e).children().text();
	    $(e).parent().prev().attr("data-select", dataSelect);
	    $(e).parent().prev().attr("value", text);
	    $(e).parent().attr("class", "select-hide");
	    
	}//end 옵션 선택
	
	//필터 함수
	function textfilter(e){
		
		var search = $(e).val().toLowerCase();
		var className = $(e).next().children().eq(0).attr('class');
		
		$(document).find("."+className).each(function(index, item){
			var text = $(this).children().text();
			
			if(text.toLowerCase().includes(search)){
				$(this).css("display", "flex");
			}else{
				$(this).css("display", "none");
			}
		});
		
	}//end 필터 함수
	//구획정보 기존 데이터 만들기 함수
	function loadSegment(){
		for(var i = 0; i < segment.length; i++){
			var result_data = {
				"id" : segment[i].segment_code,
				"num" : segment[i].segment_index,
				"repeat" : segment[i].segment_repeat,
				"type" : segment[i].segment_type,
				"order": segment[i].segment_order,
				"segmentId": segment[i].segment_grid_code,
				"segment_horizon": segment[i].segment_horizon,
				"segment_vertical": segment[i].segment_vertical,
				"segment_zindex": segment[i].segment_zindex,
				"segment_aspect": segment[i].segment_aspect,
				
			};
			resultArray.push(result_data);
		}
		//console.log(resultArray, segment);
		//구획정보 그리기 함수 실행
		gridSegment();
		
		var rowNum = segment[0].individual_num;
		$("#rowNum").val(rowNum);
		
		//결과입력 테이블 그리기 실행 함수
		
		
		//구획정보 첫번째에 active(선택) 이벤트 걸어주기
		$("#table_body").children(":first").addClass("active");
		$("#step4-segment").children(":first").addClass("active");
		
		//담당자 아닌경우 저장 버튼 숨기기
		var schId_arr = new Array();
		for(var i = 0; i < sch.length; i++){
			schId_arr.push(sch[i].sch_supervisor);
			schId_arr.push(sch[i].sch_manager);
		}

		console.log(schId_arr)
		if(schId_arr.includes(user.user_id) == false){
			$(".type1").css("display", "none");
		}
		
	}
	
	//기존 데이터 만드는 함수 실행
	loadSegment();
	
	//구획정보확인 셀렉트 박스 오픈 함수
	function loadSelectOption(){
		const contents = document.getElementsByClassName("sangtaeLi")[0],
        parentLi = contents.children;
		
		
	  for(let i=0; i<parentLi.length; i++){
		  let childeLi = parentLi[i].children[1].children;
		  
		  for(let k=0; k<childeLi.length; k++){
		      childeLi[k].idx = k;
		      
		      
		      childeLi[k].addEventListener("click", function(e){
		          e.preventDefault();
		          n=e.currentTarget.idx;
		          let select_line = childeLi[n].children[1];
		          for(let f=0; f<childeLi.length; f++){
		        	  let display = window.getComputedStyle(childeLi[f].children[1]).display;
		        	  childeLi[f].children[1].style.display="none";
		              childeLi[f].children[1].addEventListener("focusout", function(e){
		            	  if(display === "block"){
		            		  childeLi[f].children[1].style.display="none";
		            	  }
		              });
		          }
		          select_line.style.display="block";
		      });
		  }
		}
	}
	
	
	
	//구획정보 select 박스 그리기
	function gridSegmentSelect(){
		//select important
		segment_option = $("#segment_option").next();
		
		var add_list = "";
		
		for(var i = 0; i < resultArray.length; i++){
			add_list += '<li class="segment_option_list" onclick="selectOpt(this);">';
			add_list += '<span data-value="'+i+'">'+resultArray[i].id+'('+resultArray[i].type+'/'+resultArray[i].repeat+')'+'</span>';
			add_list += '</li>';
		}
		
		segment_option.append(add_list);
		
	}//end 구획정보  select 박스 그리기
	
	gridSegmentSelect();
	
	//사진선택 이벤트
	function fileFunction(e){
		$(e).next().trigger("click");
	}
	
	function openAnalyzeModal(e){
		$("#anlModal").modal("show");
	}
	
	//이미지 다운로드 이벤트
	function imgDownload(e){
		var file_name = $(e).attr("data-img");
		var src = "/upload/"+file_name;
		var href = "/plan/downloadImg?file_name="+file_name;
		imageTag = e;
		$("#downImg").css("display", "none");
		
		$("#imgModal").modal("show");
		if(file_name){
			$("#imgShow").attr("src", src);
			$("#downImg").css("display", "flex");
		}
		else if($(imageTag).prevUntil()[0].files.length == 0 && !file_name){
			$("#imgShow").attr("src", null);
			$("#downImg").css("display", "none");
		}
		else{
			changeEditedImage($(imageTag).prevUntil()[0]);
		}
		
		$("#downImg").attr("href", href);
	}
	
	function drawGrid(data) {
		
		var mapObject = {};
		var gridData = [];
		
		for(var i =0;i<data.length;i++){
			mapObject[data[i].method_title] = data[i];
		}
		
		var headerColumns = [];
		var headerCount = 0;
		
		for(var key in mapObject){
			headerColumns.push({
				header : mapObject[key].method_title,
				name : mapObject[key].method_id + "_" + headerCount++,
				'editor': 'text'
			});	
		}
		
		for(var i =0; i < tableResultArray[currentResultIndex].length ;i++){
			let savedData = tableResultArray[currentResultIndex][i];
			var gridRowData = {};
			for(var j=0;j<headerColumns.length;j++){
				gridRowData[headerColumns[j].name] = savedData[j].content;
			}
			gridData.push(gridRowData);
		}

		
        resultGrid = new tui.Grid({
            el: document.getElementById('grid'),
            columns: headerColumns, 
            scrollX: true,
            scrollY: true, 
            bodyHeight : 'auto',
			rowHeight : 'auto',
            editingEvent: 'click',
            contextMenu: ({ rowKey, columnName }) => (
       	    [
       	      [
       	        {
       	          name: '사진업로드',
       	          label: '사진업로드',
       	          action: (e) => {
       	        	  
 	   	        	  curRow = rowKey;
 	   	        	columnkey = columnName;
   	        	      
       	        	  console.log(tempGrid);
       	        	  console.log(rowKey);
       	        	  console.log(columnkey);
         	        	openAnalyzeModal(e);
         	        	
   	              }
       	        },
       	     	{
       	          name: '사진분석',
       	          label: '사진분석',
       	          action: () => {

   	   	        	  curRow = rowKey;
   	   	        	  columnkey = columnName;
   	        	      console.log(columnkey);
       	        	  openAnalyzeModal(this);
   	              }
         	    }
       	       ]
  	      	]),
            data: []
        });

        resultGrid.resetData(gridData);
        resultGrid.on('beforeChange', ev => {});
        resultGrid.on('afterChange', ev => {

        	if(ev.origin != "cell" && ev.origin != "paste")
        		return;
        	
			try{
				for(var i =0;i<ev.changes.length;i++){
            		let changeItem = ev.changes[i];
            		let list = gridData[changeItem.rowKey];
            		list[changeItem.columnName] = changeItem.value;
            		let curIndex = parseInt(changeItem.columnName.split("_")[1]);
            		tableResultArray[currentResultIndex][changeItem.rowKey][curIndex].content = changeItem.value;
            	}
			}
			catch(e){

			}
			
        });
        
        //Grid.applyTheme('striped'); 
    }
	
	function updateObjectSegmentRows(i,j,e){
		segmentResultArray[currentResultIndex][i][j].state = e.value;
		$(".sangtae li .lines").css({"display": "none"});
	}
	
	//결과입력 테이블 그리기
	function methodTableGrid(){
		$("#result_title").text("결과입력 : " + resultArray[0].id);
		
		/* console.log(method); */
		let step1_table = $("#step1_table");
		
		var length = $("#rowNum").val();
		
		//결과입력 데이터 만들어주기
		var dataArray = new Array();
		var data = new Object();

		//초기 구획정보확인 화면 만들어주기
		var segment_index = segment[currentResultIndex].segment_index;
		//해당 구획정보 데이터
		var segment_data = segment[currentResultIndex];
		var title = segment_data.segment_code;

		
		//붙여줄 부모 태그
		let sangtae_list = $("#sangtae_list");
		
		//입력한 개체수
		var rowNum = parseInt($("#rowNum").val());
		
		//기준 개체수
		var segment_num = parseInt($("#segment_num").val());
		
		var add_list = "";
		
		var length1 = parseInt(rowNum / segment_num);
		var length2 = parseInt(rowNum % segment_num);
		sangtae_list.empty();
		var str = '<span class="sub_title-content regular_text" data-index="'+segment_data.segment_index+'"><i class="bi bi-arrows-move"></i>'+title+'</span>';
		sangtae_list.append(str);
		
		
		
		for(var i = 0; i < length1; i++){
			add_list += '<ul class="clearfix sangtae">';
			for(var j = 0; j < segment_num; j++){
				add_list += '<li class="' + segmentResultArray[currentResultIndex][i][j].state + '"><a href="javascript:void(0);" ><img class="sangtae_img" src="../img/icons/' + segmentResultArray[currentResultIndex][i][j].state + '.png" alt="green"></a>';
				add_list += '<div class="lines">';
				add_list += '<select class="select_option" onchange="updateObjectSegmentRows(' + i + ',' +  j +', this)">';
				add_list += '<option value="none">상태선택</option>';
				add_list += '<option ' + (segmentResultArray[currentResultIndex][i][j] && segmentResultArray[currentResultIndex][i][j].state == 'red' ? "selected" : "") + ' class="s_red" value="red">관심개체</option>';
				add_list += '<option ' + (segmentResultArray[currentResultIndex][i][j] && segmentResultArray[currentResultIndex][i][j].state == 'blue' ? "selected" : "") + ' class="s_blue" value="blue">병</option>';
				add_list += '<option ' + (segmentResultArray[currentResultIndex][i][j] && segmentResultArray[currentResultIndex][i][j].state == 'yellow' ? "selected" : "") + ' class="s_yellow" value="yellow">시드름</option>';
				add_list += '<option ' + (segmentResultArray[currentResultIndex][i][j] && segmentResultArray[currentResultIndex][i][j].state == 'black' ? "selected" : "") + ' class="s_black" value="black">초장큼</option>';
				add_list += '<option ' + (segmentResultArray[currentResultIndex][i][j] && segmentResultArray[currentResultIndex][i][j].state == 'purple' ? "selected" : "") + ' class="s_purple" value="purple">초장작음</option>';
				add_list += '<option ' + (segmentResultArray[currentResultIndex][i][j] && segmentResultArray[currentResultIndex][i][j].state == 'etc' ? "selected" : "") + ' value="etc">기타</option>';
				add_list += '</select>';
				add_list += '</div>';
				add_list += '</li>';
			}
			add_list += '</ul>';
		}
		
		add_list += '<ul class="clearfix sangtae">';
		for(var i = 0; i < length2; i++){
			add_list += '<li class="' + segmentResultArray[currentResultIndex][length1][i].state + '"><a href="javascript:void(0);" ><img class="sangtae_img" src="../img/icons/' + segmentResultArray[currentResultIndex][length1][i].state + '.png" alt="green"></a>';
			add_list += '<div class="lines">';
			add_list += '<select class="select_option" onchange="updateObjectSegmentRows(' + length1 + ',' +  i +', this)">';
			add_list += '<option value="none">상태선택</option>';
			add_list += '<option ' + (segmentResultArray[currentResultIndex][length1][i] && segmentResultArray[currentResultIndex][length1][i].state == 'red' ? "selected" : "") + ' class="s_red" value="red">관심개체</option>';
			add_list += '<option ' + (segmentResultArray[currentResultIndex][length1][i] && segmentResultArray[currentResultIndex][length1][i].state == 'blue' ? "selected" : "") + ' class="s_blue" value="blue">병</option>';
			add_list += '<option ' + (segmentResultArray[currentResultIndex][length1][i] && segmentResultArray[currentResultIndex][length1][i].state == 'yellow' ? "selected" : "") + ' class="s_yellow" value="yellow">시드름</option>';
			add_list += '<option ' + (segmentResultArray[currentResultIndex][length1][i] && segmentResultArray[currentResultIndex][length1][i].state == 'black' ? "selected" : "") + ' class="s_black" value="black">초장큼</option>';
			add_list += '<option ' + (segmentResultArray[currentResultIndex][length1][i] && segmentResultArray[currentResultIndex][length1][i].state == 'purple' ? "selected" : "") + ' class="s_purple" value="purple">초장작음</option>';
			add_list += '<option ' + (segmentResultArray[currentResultIndex][length1][i] && segmentResultArray[currentResultIndex][length1][i].state == 'etc' ? "selected" : "") + ' value="etc">기타</option>';
			add_list += '</select>';
			add_list += '</div>';
			add_list += '</li>';
		}
		add_list += '</ul>';
			
		sangtae_list.append(add_list);
			
			
		
		$(".sangtae li").click(function(e){
			e.preventDefault();
			$(".sangtae li .lines").css({"display": "none"});
			$(this).children().eq(1).css({"display": "block"});
			
			$(this).children().eq(1).focusout(function(e){
				$(".sangtae li .lines").css({"display": "none"});
			});
		});
		//end 초기 구획정보확인 화면 만들어주기
		
		
		var newSegmentIndex = $(".regular_text").attr("data-index");
		
		$(document).find(".select_option").each(function(index, item){
			
			//segmentInfo_array
			for(var i = 0; i < segmentInfo_array.length; i++){
				
				if(newSegmentIndex == segmentInfo_array[i].segment_index){
					var data_arr = segmentInfo_array[i].segment_info;
					
					for(var j = 0; j < data_arr.length; j++){
						if(data_arr[j].info_index == (index+1) && data_arr[j].info_status != "" && data_arr[j].info_status != "none"){
							$(this).val(data_arr[j].info_status).prop("selected", true);//선택해주기
							$(this).parent().parent().addClass(data_arr[j].info_status);//색깔주기
							$(this).parent().parent().find(".sangtae_img").attr("src", "../img/icons/"+data_arr[j].info_status+".png");
						}
					}
					
				}//end if
				
			}//end for1
			
		});
		
	}//end 결과입력 테이블 그리기
	
	function changeEditedImage(e){
		var input = e;
	    var reader = new FileReader();
	    reader.onload = function(){
	      var dataURL = reader.result;
	      var output = document.getElementById('imgShow');
	      output.style.width = "inherit";
	      output.src = dataURL;
	    };
	    reader.readAsDataURL(input.files[0]);
	}
	
	function checkSelectbox(){
		var segmentOption = document.querySelector('#segment_option');
		let result_title =  segmentOption.getAttribute('value').split("(")[0];
		$("#result_title").text("결과입력 : " + result_title);
		var index = parseInt(segmentOption.getAttribute('data-select'), 10);
		
		var copy_tableResultArray = [...tableResultArray];
		
		//선택한 로우의 번호
		var num = (index + 1);
		
		//현재 개체수 개수
		var curentrowNum = $(".result_tr").length;
		
		//현재 결과입력 테이블의 로우 번호
		var currentDataNum = parseInt($(".result_list").attr("data-num"), 10);
		
		//console.log(curentrowNum, currentDataNum);
		
		var dataArray = new Array();

		let height = 0;
		let tableList = document.getElementsByClassName("box_content");
		for(var i =0;i<tableList.length;i++){
			height += $(tableList[i]).height();
			if(tableList[i].getElementsByClassName("table_id")[0].innerHTML == result_title){
			    $([document.getElementById("segment_list")]).animate({
			        scrollTop: height - $(tableList[i]).height()
			    }, 2000);
				tableList[i].getElementsByClassName("table_id")[0].click();
			    
				break;
			}
		}
		
		//정렬시키기
		tableResultArray.sort(function(a, b){
			return a.num - b.num;
		});
		file_array.sort(function(a, b){
			return a.segment_id - b.segment_id;
		});
		
		//구획정보 확인 실행하기
		checkSegment(index + 1);
	}
	//
	var segmentCont = document.querySelectorAll('#step4-segment li');
	segmentCont = Array.prototype.slice.call(segmentCont);
	$(document).on("click", "#step4-segment li", function(e){
		var target = e.currentTarget;
		var index = segmentCont.indexOf(target);
		let result_title =  $(this).find(".segment").text();
		$("#result_title").text("결과입력 : " + result_title);
		var segmentOption = document.querySelector('#segment_option');
		var segmentList = segmentOption.parentNode.children[1].children;
		
		segmentOption.setAttribute('value', segmentList[index].innerText);
		
		var copy_tableResultArray = [...tableResultArray];
		
		//선택한 로우의 번호
		var num = (index + 1);
		
		//현재 개체수 개수
		var curentrowNum = $(".result_tr").length;
		
		//현재 결과입력 테이블의 로우 번호
		var currentDataNum = $(".result_list").attr("data-num");
		
		var dataArray = new Array();
		
		let height = 0;
		let tableList = document.getElementsByClassName("box_content");
		for(var i =0;i<tableList.length;i++){
			height += $(tableList[i]).height();
			if(tableList[i].getElementsByClassName("table_id")[0].innerHTML == result_title + "-" + (parseInt($(this).find(".segment").css("z-index")) + 1)){
			    $([document.getElementById("segment_list")]).animate({
			        scrollTop: height - $(tableList[i]).height()
			    }, 2000);
				tableList[i].getElementsByClassName("table_id")[0].click();	
				let result_title =  $(tableList[i]).find(".table_id").text();
				let table_type =  $(tableList[i]).find(".table_type").text();
				let table_repeat =  $(tableList[i]).find(".table_repeat").text();
				document.getElementById("segment_option").value = result_title + "(" + table_type + "/" + table_repeat + ")";
				break;
			}
		}
		
		//구획정보 확인 실행하기
		checkSegment(index + 1);
	})
	
	//구획정보 테이블 로우 선택시 결과입력 테이블 그리기 이벤트
	var tableCont = document.querySelectorAll("#table_body .table_content");
	tableCont = Array.prototype.slice.call(tableCont);
	$(document).on("click", "#table_body .table_content", function(e){
		var target = e.currentTarget;
		var index = tableCont.indexOf(target);
		currentResultIndex = index;
		let result_title =  $(this).find(".table_id").text();
		let table_type =  $(this).find(".table_type").text();
		let table_repeat =  $(this).find(".table_repeat").text();
		$("#result_title").text("결과입력 : " + result_title);
		document.getElementById("grid").innerHTML = "";
		
		
		document.getElementById("segment_option").value = result_title + "(" + table_type + "/" + table_repeat + ")";
		
		drawGrid(method);
		methodTableGrid();
	});
	
	
	//결과입력 등록
	function insertResult(){
		
		//결과입력 데이터 만들어 주기
		var formData = new FormData();
		formData.append("rp_content", JSON.stringify(tableResultArray));
		formData.append("plan_id", plan_id);
		formData.append("rp_num", $("#rowNum").val());
		
		$.ajax({
			url : "/plan/insertResultPlan",
			type : "POST",
			processData : false,
			contentType : false,
			enctype: 'multipart/form-data',
			data : formData,
			cache: false,
			success : function(result){
				if(result == 0){}
				else{
					$("#results_confirm_popup").css("display", "none");
					$("#results_success_popup").css("display", "flex");
				}
			}
		});
		
	}
	
	
	//개체수 그리기 함수
	function addRow(){
		
		if(confirm("개체수 수정시 모든 개체 조사값이 초기화 됩니다.\n개체수를 초기화 하시겠습니까?")){
			
			let step1_table = $("#step1_table");
			
			var length = $("#rowNum").val();
			
			document.getElementById("grid").innerHTML = "";
			initResultArray();
			initSegmentArray();
			drawGrid(method);
		}
		
		var segment_index = $(document).find("#table_body .active").find(".table_num").text();
		checkSegment(segment_index);
	}
	
	//기준개체수 확인 버튼 이벤트
	$("#segment_check").on("click", function(){
		
		
		initSegmentArray();
		var segment_index = $(document).find("#table_body .active").find(".table_num").text();
		checkSegment(segment_index);
		
	});
	

	//구획정보 테이블 그리기
	function gridSegment(){
		
		//만들어준 데이터를 그려줄 부모 태그
		let segment_list = $("#segment_list");
		
		//기존 재배계획의 시험구 배치 종류
		let grow_type = plan.grow_type;
		
		var plan_repeat = plan.plan_repeat;
		
		setFactorData(resultArray);

		//시험구 배치 종류에 따라 분기 처리
		if(grow_type == "0"){	//완전임의배치
			
			//resultArray를 가지고 화면 그려주기
			var add_list = "";
			
			add_list += '<div class="box_content">';
			add_list += '<table style="width:max-content;">';
			add_list += '<thead>';
			add_list += '<tr>';
			add_list += '<th>구획번호</th>';
			add_list += '<th>구획ID</th>';
			add_list += '<th>처리종류</th>';
			add_list += '<th>반복</th>';
			add_list += '</tr>';
			add_list += '</thead>';
			add_list += '<tbody id="table_body">';
			
			for(var i = 0; i < resultArray.length; i++){
				add_list += '<tr class="table_content">';
			    add_list += '<td class="table_num">'+resultArray[i].num+'</td>';
			    add_list += '<td class="table_id">'+resultArray[i].id+'</td>';
			    add_list += '<td class="table_type">'+resultArray[i].type+'</td>';
			    add_list += '<td class="table_repeat">'+resultArray[i].repeat+'</td>';
			    add_list += '</tr>';
			}
			add_list += '</tbody>';
			add_list += '</table>';
			add_list += '</div>';
			
			segment_list.append(add_list);
		}else if(grow_type == "1"){	//난괴법
			
			//resultArray를 가지고 화면 그려주기
			var add_list = "";
			var result_add_list = "";
			
			for(var i = 0; i < plan_repeat; i++){
				
				add_list += '<div class="box_content">';
				add_list += '<span class="sub_title-content">집구'+(i+1)+'</span>'
				add_list += '<table style="width:max-content;">';
				add_list += '<thead>';
				add_list += '<tr>';
				add_list += '<th>구획번호</th>';
				add_list += '<th>구획ID</th>';
				add_list += '<th>처리종류</th>';
				add_list += '<th>반복</th>';
				add_list += '</tr>';
				add_list += '</thead>';
				add_list += '<tbody id="table_body">';
				
				for(var j = 0; j < resultArray.length; j++){
					
					if(resultArray[j].repeat == (i+1)){
						add_list += '<tr class="table_content">';
					    add_list += '<td class="table_num">'+resultArray[j].num+'</td>';
					    add_list += '<td class="table_id">'+resultArray[j].id+'</td>';
					    add_list += '<td class="table_type">'+resultArray[j].type+'</td>';
					    add_list += '<td class="table_repeat">'+resultArray[j].repeat+'</td>';
					    add_list += '</tr>';
					}
				}//end for2
				
				add_list += '</tbody>';
				add_list += '</table>';
				add_list += '</div>';
				
				result_add_list += add_list;
				
				add_list = "";
			}//end for1
			
			segment_list.append(result_add_list);
			
		}else if(grow_type == "2"){//분할구배치법
			
			var arr = new Array();
			for(var i = 0; i < resultArray.length; i++){
				arr[i] = resultArray[i].id.split("-")[0];
			}
			var idArray = Array.from(new Set(arr));
			
			add_list = "";
			var add_div = "";
			var result_div = "";
			
			for(var i = 0; i < plan_repeat; i++){
				
				add_list += '<div class="box_content">';
				add_list += '<span class="sub_title-content">집구'+(i+1)+'</span>'
				add_list += '<table style="width:max-content;">';
				add_list += '<thead>';
				add_list += '<tr>';
				add_list += '<th>구획번호</th>';
				add_list += '<th>구획ID</th>';
				add_list += '<th>처리종류</th>';
				add_list += '<th>반복</th>';
				add_list += '</tr>';
				add_list += '</thead>';
				add_list += '<tbody id="table_body">';
				
				
				for(var j = 0; j < resultArray.length; j++){
					
					if(resultArray[j].repeat == (i+1)){
						var checkId = resultArray[j].id.split("-")[0];
						for(var k = 0; k < idArray.length; k++){
							if(checkId == idArray[k]){
								add_list += '<tr class="table_content '+idArray[k]+'">';
							}
						}
					    add_list += '<td class="table_num">'+resultArray[j].num+'</td>';
					    add_list += '<td class="table_id">'+resultArray[j].id+'</td>';
					    add_list += '<td>'+resultArray[j].type+'</td>';
					    add_list += '<td>'+resultArray[j].repeat+'</td>';
					    add_list += '</tr>';
					}
				}//end for2
				
				add_list += '</tbody>';
				add_list += '</table>';
				
				result_div += add_list;
				
				add_list = "";
			}//end for1
			
			segment_list.append(result_div);
			
			var factor2 = 0;
			for(var i = 0; i < resultArray.length; i++){
				var idTemp = resultArray[i].segmentId;
				var splitA = idTemp.split("-")[1].split("B")[1];
			}
			
			//그룹별 색깔 적용해주기
			$(document).find(".table_content").each(function(i, item){
				
				/* id_color9 */
				for(var j = 0; j < idArray.length; j++){
					if($(this).hasClass(idArray[j])){
						$(this).addClass("id_color"+(j+1));
					}
				}
				
			});
			
		}else if(grow_type == "3"){//세세구배치법
			
			var arr = new Array();
			for(var i = 0; i < resultArray.length; i++){
				arr[i] = resultArray[i].id.split("-")[0]+"-"+resultArray[i].id.split("-")[1];
			}
			var idArray = Array.from(new Set(arr));
			
			add_list = "";
			var add_div = "";
			var result_div = "";
			
			for(var i = 0; i < plan_repeat; i++){
				
				add_list += '<div class="box_content">';
				add_list += '<span class="sub_title-content">집구'+(i+1)+'</span>'
				add_list += '<table style="width:max-content;">';
				add_list += '<thead>';
				add_list += '<tr>';
				add_list += '<th>구획번호</th>';
				add_list += '<th>구획ID</th>';
				add_list += '<th>처리종류</th>';
				add_list += '<th>반복</th>';
				add_list += '</tr>';
				add_list += '</thead>';
				add_list += '<tbody id="table_body">';
				
				
				for(var j = 0; j < resultArray.length; j++){
					
					if(resultArray[j].repeat == (i+1)){
						var checkId = resultArray[j].id.split("-")[0]+"-"+resultArray[j].id.split("-")[1];
						for(var k = 0; k < idArray.length; k++){
							if(checkId == idArray[k]){
								add_list += '<tr class="table_content '+idArray[k]+'">';
							}
						}
					    add_list += '<td class="table_num">'+resultArray[j].num+'</td>';
					    add_list += '<td class="table_id">'+resultArray[j].id+'</td>';
					    add_list += '<td>'+resultArray[j].type+'</td>';
					    add_list += '<td>'+resultArray[j].repeat+'</td>';
					    add_list += '</tr>';
					}
				}//end for2
				
				add_list += '</tbody>';
				add_list += '</table>';
				
				result_div += add_list;
				
				add_list = "";
			}//end for1
			
			segment_list.append(result_div);
			
			
			//그룹별 색깔 적용해주기
			$(document).find(".table_content").each(function(i, item){
				
				/* id_color9 */
				for(var j = 0; j < idArray.length; j++){
					if($(this).hasClass(idArray[j])){
						$(this).addClass("id_color"+(j+1));
					}
				}
				
			});
			
		}
		
		//이곳에서 데이터 받아와야함 : important
		var getDataArr = [...resultArray];
		getDataResult(getDataArr, grow_type, '', 'result');
		
	}//end gridFactors
	
	
	//구획정보 확인 그리기
	function checkSegment(segment_index){
		var segment_data = new Object();
	
		segment_data = segment[segment_index - 1];
		var title = segment_data.segment_code;
		
		
		var currentSegmentIndex = $(".regular_text").attr("data-index");
		
		//셀렉트박스 개수만큼 반복하여 
		$(document).find(".select_option").each(function(index, item){
			
			//segmentInfo_array
			for(var i = 0; i < segmentInfo_array.length; i++){
				
				if(currentSegmentIndex == segmentInfo_array[i].segment_index){
					var data_arr = segmentInfo_array[i].segment_info;
					
					for(var j = 0; j < data_arr.length; j++){
						if(data_arr[j].info_index == (index+1)){
							if($(this).find("option:selected").val() != "none"){
								data_arr[j].info_status = $(this).find("option:selected").val();
							}
						}
					}
					
					segmentInfo_array[i].segment_info = data_arr;
					
				}//end if
				
			}//end for1
			
		});
		
		//붙여줄 부모 태그
		let sangtae_list = $("#sangtae_list");
		
		//입력한 개체수
		var rowNum = parseInt($("#rowNum").val());
		
		//기준 개체수
		var segment_num = parseInt($("#segment_num").val());
		
		var add_list = "";
		
		if(rowNum <= segment_num){//개체수보다 기준개체수가 클때
			
			add_list += '<span class="sub_title-content regular_text" data-index="'+segment_data.segment_index+'"><i class="bi bi-arrows-move"></i>'+title+'</span>';
			add_list += '<ul class="clearfix sangtae">';
			
			for(var i = 0; i < rowNum; i++){
				add_list += '<li><a href="javascript:void(0);"><img class="sangtae_img" src="../img/icons/green.png" alt="green"></a>';
				add_list += '<div class="lines">';
				add_list += '<select class="select_option">';
				add_list += '<option value="none">상태선택</option>';
				add_list += '<option class="s_red" value="red">관심개체</option>';
				add_list += '<option class="s_blue" value="blue">병</option>';
				add_list += '<option class="s_yellow" value="yellow">시드름</option>';
				add_list += '<option class="s_black" value="black">초장큼</option>';
				add_list += '<option class="s_purple" value="purple">초장작음</option>';
				add_list += '<option value="etc">기타</option>';
				add_list += '</select>';
				add_list += '</div>';
				add_list += '</li>';
			}
			add_list += '</ul>';
			
			sangtae_list.empty();
			sangtae_list.append(add_list);
			
		}else {
			
			var length1 = parseInt(rowNum / segment_num);
			var length2 = parseInt(rowNum % segment_num);
			sangtae_list.empty();
			var str = '<span class="sub_title-content regular_text" data-index="'+segment_data.segment_index+'"><i class="bi bi-arrows-move"></i>'+title+'</span>';
			sangtae_list.append(str);
			
			for(var i = 0; i < length1; i++){
				add_list += '<ul class="clearfix sangtae">';
				for(var j = 0; j < segment_num; j++){
					add_list += '<li><a href="javascript:void(0);"><img class="sangtae_img" src="../img/icons/green.png" alt="green"></a>';
					add_list += '<div class="lines">';
					add_list += '<select class="select_option">';
					add_list += '<option value="none">상태선택</option>';
					add_list += '<option class="s_red" value="red">관심개체</option>';
					add_list += '<option class="s_blue" value="blue">병</option>';
					add_list += '<option class="s_yellow" value="yellow">시드름</option>';
					add_list += '<option class="s_black" value="black">초장큼</option>';
					add_list += '<option class="s_purple" value="purple">초장작음</option>';
					add_list += '<option value="etc">기타</option>';
					add_list += '</select>';
					add_list += '</div>';
					add_list += '</li>';
				}
				add_list += '</ul>';
			}
			
			add_list += '<ul class="clearfix sangtae">';
			for(var i = 0; i < length2; i++){
				add_list += '<li><a href="javascript:void(0);"><img class="sangtae_img" src="../img/icons/green.png" alt="green"></a>';
				add_list += '<div class="lines">';
				add_list += '<select class="select_option">';
				add_list += '<option value="none">상태선택</option>';
				add_list += '<option class="s_red" value="red">관심개체</option>';
				add_list += '<option class="s_blue" value="blue">병</option>';
				add_list += '<option class="s_yellow" value="yellow">시드름</option>';
				add_list += '<option class="s_black" value="black">초장큼</option>';
				add_list += '<option class="s_purple" value="purple">초장작음</option>';
				add_list += '<option value="etc">기타</option>';
				add_list += '</select>';
				add_list += '</div>';
				add_list += '</li>';
			}
			add_list += '</ul>';
			
			sangtae_list.append(add_list);
			
			
		}//end else
		/*loadSelectOption();*/
		$(".sangtae li").click(function(e){
			e.preventDefault();
			$(".sangtae li .lines").css({"display": "none"});
			$(this).children().eq(1).css({"display": "block"});
			
			$(this).children().eq(1).focusout(function(e){
				$(".sangtae li .lines").css({"display": "none"});
			});
		});
		
		
		//새로 만들어준 구획정보확인 화면에 기존 데이터 selected 해주기
		var newSegmentIndex = $(".regular_text").attr("data-index");
		$(document).find(".select_option").each(function(index, item){
			
			//segmentInfo_array
			for(var i = 0; i < segmentInfo_array.length; i++){
				
				if(newSegmentIndex == segmentInfo_array[i].segment_index){
					var data_arr = segmentInfo_array[i].segment_info;
					
					for(var j = 0; j < data_arr.length; j++){
						if(data_arr[j].info_index == (index+1) && data_arr[j].info_status != "" && data_arr[j].info_status != "none"){
							$(this).val(data_arr[j].info_status).prop("selected", true);//선택해주기
							$(this).parent().parent().addClass(data_arr[j].info_status);//색깔주기
							$(this).parent().parent().find(".sangtae_img").attr("src", "../img/icons/"+data_arr[j].info_status+".png");
						}
					}
					
				}//end if
				
			}//end for1
			
		});
		
		
	}//구획정보 확인 그리기
	
	
	//구획정보확인 데이터 저장
	function insertSegmentInfo(){
		
		var formData = new FormData();
		formData.append("rp_id", rp_id);
		formData.append("rp_segment", JSON.stringify(segmentResultArray));
		formData.append("rp_segment_count", document.getElementById("segment_num").value);
		formData.append("plan_id", plan_id);
		
		$.ajax({
			url : "/plan/updateResultPlan",
			type : "PUT",
			processData : false,
			contentType : false,
			enctype: 'multipart/form-data',
			data : formData,
			success : function(result){
				if(result > 0){
					$("#results_confirm_popup").css("display", "none");
					$("#segmentInfo_confirm_popup").css("display", "none");
					$("#segmentInfo_success_popup").css("display", "flex");
				}else{
					alert("저장 실패하였습니다.");
				}
			}
		});
		
	}//end 구획정보확인 데이터 저장
	
	//구획정보 상태 선택 이벤트
	$(document).on("change", ".select_option", function(){
		
		var color = $(this).find("option:selected").val();
		
		var li = $(this).parent().parent();
		if(color == "red"){
			li.removeClass('red blue yellow black purple');
			li.addClass("red");
			$(this).parent().parent().find(".sangtae_img").attr("src", "../img/icons/red.png");
		}else if(color == "blue"){
			li.removeClass('red blue yellow black purple');
			li.addClass("blue");
			$(this).parent().parent().find(".sangtae_img").attr("src", "../img/icons/blue.png");
		}else if(color == "yellow"){
			li.removeClass('red blue yellow black purple');
			li.addClass("yellow");
			$(this).parent().parent().find(".sangtae_img").attr("src", "../img/icons/yellow.png");
		}else if(color == "black"){
			li.removeClass('red blue yellow black purple');
			li.addClass("black");
			$(this).parent().parent().find(".sangtae_img").attr("src", "../img/icons/black.png");
		}else if(color == "purple"){
			li.removeClass('red blue yellow black purple');
			li.addClass("purple");
			$(this).parent().parent().find(".sangtae_img").attr("src", "../img/icons/purple.png");
		}
		
	});
	
	//qr important
	function createQrcode(){
		var url = window.location.href;
		/* var url = "/plan/insertResult?plan_id="+plan.plan_id; */
		
		var qrcode = new QRCode(document.getElementById("qrcode"), {
			width : 100,
			height : 100
		});
		
		qrcode.makeCode(url);
	}
	
	createQrcode();
	
	$("#qrBtn").on("click", function(){
		downloadURI('qrCode');
	});

	
	function setFactorData(data){
		var arr = data;
		var aGet = 1;
		var bGet = 1;
		var cGet = 1;
		
		for(var i = 0; i < arr.length; i++){
			var aSplit = arr[i].id.split("-B")[0].split("A")[1];
			var bSplit = arr[i].id.split("-C")[0].split("B")[1];
			var cSplit = arr[i].id.split("-C")[1].split("-")[0];
			
			if(aSplit > aGet){
				aGet = aSplit;
			}
			if(bSplit > bGet){
				bGet = bSplit;
			}
			if(cSplit > cGet){
				cGet = cSplit;
			}
		}
		factorLength1 = aGet;
		factorLength2 = bGet;
		factorLength3 = cGet;
		//setColorTable(data);
	}

	function setColorTable(data){
		
		var arr = data;
	   //id_color1 ~ 10
		var percentage = 0;
		var orderRen = 0;
		var allRen = 0;
		var repeat = 0;
		
		var re = 1;
		var tableEls = document.querySelectorAll(".table_content");
		
		for(var y = 0; y < data.length; y++){
			var ySplit = data[y].repeat;
			
			if(ySplit > re){
				re = ySplit;
			}
		}
		repeat = re;
		
		
		if(segmentType == "2"){
		
			percentage = factorLength1; 
			for(var f = 0; f < repeat; f++){
				for(var i = 0; i < percentage; i++){
					for(var t =  0; t < (factorLength2 * factorLength3); t++){
						var colorIndex = orderRen % 10;
						tableEls[allRen].classList.add("id_color"+ (colorIndex + 1));
						allRen++;
					}	
					orderRen++;				
				}
				orderRen = 0;
				//console.log(orderRen,"orderRen");
			}
			
		}else if(segmentType == "3"){
		
			percentage = factorLength1 * factorLength2; 
			for(var f = 0; f < repeat; f++){
				for(var i = 0; i < percentage; i++){
					for(var t =  0; t < factorLength3; t++){
						var colorIndex = orderRen % 10;
						tableEls[allRen].classList.add("id_color"+ (colorIndex + 1));
						allRen++;
					}
					orderRen++;
				}
				orderRen = 0;
				//console.log(orderRen,"orderRen");
			}
			
		}

	}
	
	
	function downloadURI(name){
		var canvas = document.querySelector('#qrcode canvas');
		var link = document.createElement("a");
		link.download = name;
		link.href = canvas.toDataURL("image/png");
		document.body.appendChild(link);
		link.click();
		link.delete;
	}
	
	
	//결과입력 등록 팝업
	function confirminsertResult(){
		$("#results_confirm_popup").css("display", "flex");
	}
	
	//결과입력 완료 팝업 닫기
	function confirmResults(){
		$("#results_success_popup").css("display", "none");
		window.location.reload();
	}
	
	function CancelBtn(){
		$("#results_confirm_popup").css("display", "none");
		$("#segmentInfo_confirm_popup").css("display", "none");
	}
	
	//구획정보확인 등록 팝업
	function confirminsertSegmentInfo(){
		$("#segmentInfo_confirm_popup").css("display", "flex");
	}
	
	//구획정보확인 완료 팝업 닫기
	function confirmSegmentInfo(){
		$("#segmentInfo_success_popup").css("display", "none");
		window.location.reload();
	}
	
	
</script>
     
<script>
	window.addEventListener("load", function(){ //javascript
	    let section = document.getElementById("section"),
	    step = section.children,  
	    n = 0;
	    
	    
	    let slideUp = (title, target, duration=500) => {
	        title.classList.remove("active");
	        target.style.transitionProperty = 'height, margin, padding';
	        target.style.transitionDuration = duration + 'ms';
	        target.style.boxSizing = 'border-box';
	        target.style.height = target.offsetHeight + 'px';
	        target.offsetHeight;
	        target.style.overflow = 'hidden';
	        target.style.height = 0;
	        target.style.paddingTop = 0;
	        target.style.paddingBottom = 0;
	        target.style.marginTop = 0;
	        target.style.marginBottom = 0;
	        window.setTimeout( () => {
	            target.style.display = 'none';
	            target.style.removeProperty('height');
	            target.style.removeProperty('padding-top');
	            target.style.removeProperty('padding-bottom');
	            target.style.removeProperty('margin-top');
	            target.style.removeProperty('margin-bottom');
	            target.style.removeProperty('overflow');
	            target.style.removeProperty('transition-duration');
	            target.style.removeProperty('transition-property');
	        }, duration);
	    }
	    let slideDown = (title, target, duration=500) => {
	        target.style.removeProperty('display');
	        let display = window.getComputedStyle(target).display;
	        if (display === 'none')
	        display = 'block';
	        title.classList.add("active");
	        target.style.display = display;
	        let height = target.offsetHeight;
	        target.style.overflow = 'hidden';
	        target.style.height = 0;
	        target.style.paddingTop = 0;
	        target.style.paddingBottom = 0;
	        target.style.marginTop = 0;
	        target.style.marginBottom = 0;
	        target.offsetHeight;
	        target.style.boxSizing = 'border-box';
	        target.style.transitionProperty = "height, margin, padding";
	        target.style.transitionDuration = duration + 'ms';
	        target.style.height = height + 'px';
	        target.style.removeProperty('padding-top');
	        target.style.removeProperty('padding-bottom');
	        target.style.removeProperty('margin-top');
	        target.style.removeProperty('margin-bottom');
	        window.setTimeout( () => {
	            target.style.removeProperty('height');
	            target.style.removeProperty('overflow');
	            target.style.removeProperty('transition-duration');
	            target.style.removeProperty('transition-property');
	        }, duration);
	    }
	    let slideToggle = (title, target, duration = 500) => {
	        if (window.getComputedStyle(target).display === 'none') {
	            return slideDown(title, target, duration);
	        } else {
	            return slideUp(title, target, duration);
	        }
	    }
	    
	    for(let i=0; i<step.length; i++){
	        let stepInner = step[i].children;
	        for(let k=0; k<stepInner.length; k++){
	            let [title, content] = stepInner[k].children;
	            
	            title.addEventListener("click", function(e){
	                slideToggle(title, content);
	                const left_content = document.getElementsByClassName("left_content")[0],
	                      back = document.getElementsByClassName("background-content")[0];
	                let height = left_content.offsetHeight;
	                //??? 확인//back.style.height= height + "px";
	            });
	        }
	    }
	   
	});
	
	
	//등록화면 접속시 step1 열어주기
	setTimeout(function(){
		var eventList = document.createEvent("MouseEvent");
	    eventList.initEvent("click");
	    document.querySelector("#step1 .title").dispatchEvent(eventList);
	}, 100);
	
	
</script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
<script type="text/javascript">
	// More API functions here:
	// https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image
	// the link to your model provided by Teachable Machine export panel
	//const URL = "https://teachablemachine.withgoogle.com/models/6gX8P0FCy/";
	const URL = "https://teachablemachine.withgoogle.com/models/P6ZEe568t/";
	let model, labelContainer, maxPredictions;
	// Load the image model and setup the webcam
	async function init() {
		const modelURL = URL + "model.json";
		const metadataURL = URL + "metadata.json";
		// load the model and metadata
		// Refer to tmImage.loadFromFiles() in the API to support files from a file picker
		// or files from your local hard drive
		// Note: the pose library adds "tmImage" object to your window (window.tmImage)
		model = await tmImage.load(modelURL, metadataURL);
		maxPredictions = model.getTotalClasses();
		labelContainer = document.getElementById("label-container");
		for (let i = 0; i < maxPredictions; i++) { // and class labels
			labelContainer.appendChild(document.createElement("div"));
		}
		predict();
	}
	
	// run the webcam image through the image model
	async function predict() {
		// predict can take in an image, video or canvas html element
			var image = document.getElementById("face-image");
			const prediction = await model.predict(image, false);		
			labelContainer.childNodes[0].innerHTML = "<div class='chart-wrap'><div class='grid horizontal'>" +
			"<div onclick='updateResult(this);' class='bar' style='--bar-value:"+prediction[0].probability.toFixed(2)*100+"%;' data-name='"+prediction[0].className+ "-"+Math.floor(prediction[0].probability.toFixed(2)*100)+"% "+"' title='"+prediction[0].className+prediction[0].probability.toFixed(2)+"'></div>" +
			"<div onclick='updateResult(this);' class='bar' style='--bar-value:"+prediction[1].probability.toFixed(2)*100+"%;' data-name='"+prediction[1].className+ "-"+Math.floor(prediction[1].probability.toFixed(2)*100)+"% "+"' title='"+prediction[1].className+prediction[1].probability.toFixed(2)+"'></div>" +
			"<div onclick='updateResult(this);' class='bar' style='--bar-value:"+prediction[2].probability.toFixed(2)*100+"%;' data-name='"+prediction[2].className+ "-"+Math.floor(prediction[2].probability.toFixed(2)*100)+"% "+"' title='"+prediction[2].className+prediction[2].probability.toFixed(2)+"'></div>" +
			"<div onclick='updateResult(this);' class='bar' style='--bar-value:"+prediction[3].probability.toFixed(2)*100+"%;' data-name='"+prediction[3].className+ "-"+Math.floor(prediction[3].probability.toFixed(2)*100)+"% "+"' title='"+prediction[3].className+prediction[3].probability.toFixed(2)+"'></div>" +
			"<div onclick='updateResult(this);' class='bar' style='--bar-value:"+prediction[4].probability.toFixed(2)*100+"%;' data-name='"+prediction[4].className+ "-"+Math.floor(prediction[4].probability.toFixed(2)*100)+"% "+"' title='"+prediction[4].className+prediction[4].probability.toFixed(2)+"'></div>" +
			"</div>" +
			"</div>";
	}

</script>
<script>

	function readURL(input) {
		if (input.files && input.files[0]) {
			var reader = new FileReader();
			reader.onload = function(e) {
				$('.image-upload-wrap').hide();
				$('.file-upload-image').attr('src', e.target.result);
				$('.file-upload-content').show();
				$('.image-title').html(input.files[0].name);
			};
			reader.readAsDataURL(input.files[0]);
		} else {
			removeUpload();
		}
	}


	function removeUpload() {
		$('.file-upload-input').replaceWith($('.file-upload-input').clone());
		$('.file-upload-content').hide();
		$('.label-container').html("");
		$('.image-upload-wrap').show();
	}
	$('.image-upload-wrap').bind('dragover', function() {
		$('.image-upload-wrap').addClass('image-dropping');
	});
	$('.image-upload-wrap').bind('dragleave', function() {
		$('.image-upload-wrap').removeClass('image-dropping');
	});


	function initResultArray(){
		tableResultArray = [];
		let num = document.getElementById("rowNum").value;
		
		for(var z =0;z<resultArray.length;z++){
			let resultRows = [];
			
			for(var i = 0;i<num;i++){
				let rows = [];
				for(var j=0;j<method.length;j++){
					let tempObject = {};
					tempObject.method_title = method[j].method_title;	
					tempObject.method_id = method[j].method_id;	
					tempObject.d3_name = method[j].d3_name;	
					tempObject.content = "";	
					tempObject.image = "";	
					rows.push(tempObject);
				}
				resultRows.push(rows);
			}
			
			tableResultArray.push(resultRows);
		}
		
		
	}
	
	function initSegmentArray(){
		segmentResultArray = [];
		
		let num = document.getElementById("rowNum").value;
		let segmentNum = document.getElementById("segment_num").value; 
		let maxCount = 0;
		
		for(var z =0;z<resultArray.length;z++){
			let resultSegmentRows = [];
	
			for(var i = 0;i<num;i++){
				let segmentRows = [];
				for(var j=0;j< segmentNum ;j++){
						let ob = { state : "green"};
						segmentRows.push(ob);
				}
				resultSegmentRows.push(segmentRows);
			}
			
			segmentResultArray.push(resultSegmentRows);	
		}
	}
	
	initSegmentArray();
	initResultArray();

	if(resultPlan && resultPlan.rp_content){
		rp_id = resultPlan.rp_id;
		tableResultArray = JSON.parse(resultPlan.rp_content);
		$("#rowNum").val(resultPlan.rp_num);
	}
	if(resultPlan && resultPlan.rp_segment){
		rp_id = resultPlan.rp_id;
		segmentResultArray = JSON.parse(resultPlan.rp_segment);
		$("#segment_num").val(resultPlan.rp_segment_count);
	}
	setTimeout(function(){ 	
		
		drawGrid(method); 
		methodTableGrid();
		
	},1000);
	
</script>
</body>    
</html>